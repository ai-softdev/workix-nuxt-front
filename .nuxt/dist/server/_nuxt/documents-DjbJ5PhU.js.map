{"version":3,"file":"documents-DjbJ5PhU.js","sources":["../../../../stores/documents.ts"],"sourcesContent":["import {defineStore, type PiniaCustomProperties} from \"pinia\";\r\nimport axios from \"~/composables/axios\";\r\nimport {toast} from \"vue3-toastify\";\r\nimport nuxtStorage from \"nuxt-storage/nuxt-storage\";\r\nimport type {Router} from \"vue-router\";\r\n\r\nexport const useDocumentStore = defineStore('document-store', {\r\n\r\n  state: () => ({\r\n    documentList: {},\r\n    documentItem: {},\r\n    userList: ref({}),\r\n    createChainForm: [],\r\n    showDepartment: [],\r\n    showUsersNode: [],\r\n    chainSchedule: {},\r\n    createForm: {\r\n      title: '',\r\n      description: '',\r\n      file: '',\r\n      src: '',\r\n      receiver_id: ''\r\n    },\r\n    draggableUser: null,\r\n    showContext: null,\r\n    showContextDepartment: null,\r\n    showWarn: false,\r\n    showCreateDoc: false,\r\n    showRejectedWarn: false\r\n  }),\r\n  getters: {\r\n    get_all_document: (state) => state.documentList\r\n  },\r\n  actions: {\r\n    async docSign(params: { id: number, second_password: string | number }): Promise<void> {\r\n      await axios.patch(`document/sign/${params.id}`, {\r\n        second_password: params.second_password\r\n      }, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(res => {\r\n        toast.success('Доступ разрешен', {autoClose: 1000, theme: 'auto'})\r\n      })\r\n    },\r\n    async loadAllDocument(params: { page: number, limit: number, type?: any, query?: any }): Promise<void> {\r\n      await axios.get(`document/list${params.type ? '/' + params.type : ''}${params.page ? '?page=' + params.page : ''}${params.limit ? '&limit=' + params.limit : ''}${params.query ? '&query=' + params.query : ''}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(res => {\r\n        this.documentList = res.data\r\n      })\r\n    },\r\n\r\n    async loadDocument(params: { slug: string[] | string}): Promise<void> {\r\n      await axios.get(`document/${params.slug}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(res => {\r\n        this.documentItem = res.data\r\n\r\n      })\r\n    },\r\n\r\n    async docCreate(params: { title: any, description: any, receiver_id: any, file: any }): Promise<void> {\r\n      let fd = new FormData()\r\n      fd.set('title', params.title)\r\n      fd.set('description', params.description)\r\n      fd.set('receiver_id', params.receiver_id)\r\n      if (typeof params.file !== 'string') {\r\n        fd.set('file', params.file)\r\n      }\r\n      await axios.post(`document/create`, fd, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(res => {\r\n        toast.success('Документ создан', {autoClose: 1000, theme: 'auto'})\r\n        this.loadAllDocument({ page: 1, limit: 10})\r\n        this.showCreateDoc = false\r\n      })\r\n    },\r\n\r\n    async setUsers(params: { slug: any, form: any }, router: Router): Promise<void> {\r\n\r\n      await axios.post(`document/set-users/${params.slug}`, {participants: params.form}, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(res => {\r\n        router.push(`/base/documents/signification/${params.slug}`).then(e=>{\r\n          toast.success('Цепь запущена!', {autoClose: 1000, theme: 'auto'})\r\n        })\r\n      })\r\n    },\r\n\r\n    async docUpdate(params: { title?: any, description?: any, users: any, id: any }): Promise<void> {\r\n      let fd = new FormData()\r\n      // fd.set('users', params.users)\r\n      // fd.set('title', params.title)\r\n      // fd.set('description', params.description)\r\n      await axios.patch(`document/update/${params.id}`, {\r\n        title: params.title,\r\n        description: params.description,\r\n        users: params.users,\r\n      }, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(res => {\r\n        toast.success('Успешный запуск', {autoClose: 1000, theme: 'auto'})\r\n      })\r\n    },\r\n\r\n    async documentSign(params: any, router: Router): Promise<void> {\r\n      await axios.patch(`document/sign/${params.slug}`, params.data, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(res => {\r\n        router.push(`/base/documents`).then(e=>{\r\n          toast.success('Успешная подпись!', {autoClose: 1000, theme: 'auto'})\r\n        })\r\n      })\r\n    },\r\n\r\n    async docDelete(params: { slug: string[] | string }) {\r\n      await axios.delete(`document/delete/${params.slug}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(res => {\r\n        toast.success('Успешно удалён', {theme: 'auto', autoClose: 1000})\r\n\r\n      })\r\n    }\r\n  }\r\n})"],"names":[],"mappings":"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"}