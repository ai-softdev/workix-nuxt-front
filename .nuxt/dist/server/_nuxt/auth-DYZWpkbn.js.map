{"version":3,"file":"auth-DYZWpkbn.js","sources":["../../../../node_modules/std-env/dist/index.mjs","../../../../stores/auth.ts"],"sourcesContent":["const r=Object.create(null),E=e=>globalThis.process?.env||import.meta.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?r:globalThis),s=new Proxy(r,{get(e,o){return E()[o]??r[o]},has(e,o){const i=E();return o in i||o in r},set(e,o,i){const g=E(!0);return g[o]=i,!0},deleteProperty(e,o){if(!o)return!1;const i=E(!0);return delete i[o],!0},ownKeys(){const e=E(!0);return Object.keys(e)}}),t=typeof process<\"u\"&&process.env&&process.env.NODE_ENV||\"\",p=[[\"APPVEYOR\"],[\"AWS_AMPLIFY\",\"AWS_APP_ID\",{ci:!0}],[\"AZURE_PIPELINES\",\"SYSTEM_TEAMFOUNDATIONCOLLECTIONURI\"],[\"AZURE_STATIC\",\"INPUT_AZURE_STATIC_WEB_APPS_API_TOKEN\"],[\"APPCIRCLE\",\"AC_APPCIRCLE\"],[\"BAMBOO\",\"bamboo_planKey\"],[\"BITBUCKET\",\"BITBUCKET_COMMIT\"],[\"BITRISE\",\"BITRISE_IO\"],[\"BUDDY\",\"BUDDY_WORKSPACE_ID\"],[\"BUILDKITE\"],[\"CIRCLE\",\"CIRCLECI\"],[\"CIRRUS\",\"CIRRUS_CI\"],[\"CLOUDFLARE_PAGES\",\"CF_PAGES\",{ci:!0}],[\"CODEBUILD\",\"CODEBUILD_BUILD_ARN\"],[\"CODEFRESH\",\"CF_BUILD_ID\"],[\"DRONE\"],[\"DRONE\",\"DRONE_BUILD_EVENT\"],[\"DSARI\"],[\"GITHUB_ACTIONS\"],[\"GITLAB\",\"GITLAB_CI\"],[\"GITLAB\",\"CI_MERGE_REQUEST_ID\"],[\"GOCD\",\"GO_PIPELINE_LABEL\"],[\"LAYERCI\"],[\"HUDSON\",\"HUDSON_URL\"],[\"JENKINS\",\"JENKINS_URL\"],[\"MAGNUM\"],[\"NETLIFY\"],[\"NETLIFY\",\"NETLIFY_LOCAL\",{ci:!1}],[\"NEVERCODE\"],[\"RENDER\"],[\"SAIL\",\"SAILCI\"],[\"SEMAPHORE\"],[\"SCREWDRIVER\"],[\"SHIPPABLE\"],[\"SOLANO\",\"TDDIUM\"],[\"STRIDER\"],[\"TEAMCITY\",\"TEAMCITY_VERSION\"],[\"TRAVIS\"],[\"VERCEL\",\"NOW_BUILDER\"],[\"VERCEL\",\"VERCEL\",{ci:!1}],[\"VERCEL\",\"VERCEL_ENV\",{ci:!1}],[\"APPCENTER\",\"APPCENTER_BUILD_ID\"],[\"CODESANDBOX\",\"CODESANDBOX_SSE\",{ci:!1}],[\"STACKBLITZ\"],[\"STORMKIT\"],[\"CLEAVR\"],[\"ZEABUR\"],[\"CODESPHERE\",\"CODESPHERE_APP_ID\",{ci:!0}],[\"RAILWAY\",\"RAILWAY_PROJECT_ID\"],[\"RAILWAY\",\"RAILWAY_SERVICE_ID\"]];function B(){if(globalThis.process?.env)for(const e of p){const o=e[1]||e[0];if(globalThis.process?.env[o])return{name:e[0].toLowerCase(),...e[2]}}return globalThis.process?.env?.SHELL===\"/bin/jsh\"&&globalThis.process?.versions?.webcontainer?{name:\"stackblitz\",ci:!1}:{name:\"\",ci:!1}}const l=B(),d=l.name;function n(e){return e?e!==\"false\":!1}const I=globalThis.process?.platform||\"\",T=n(s.CI)||l.ci!==!1,R=n(globalThis.process?.stdout&&globalThis.process?.stdout.isTTY),U=typeof window<\"u\",h=n(s.DEBUG),C=t===\"test\"||n(s.TEST),f=t===\"production\",v=t===\"dev\"||t===\"development\",m=n(s.MINIMAL)||T||C||!R,a=/^win/i.test(I),M=/^linux/i.test(I),V=/^darwin/i.test(I),Y=!n(s.NO_COLOR)&&(n(s.FORCE_COLOR)||(R||a)&&s.TERM!==\"dumb\"||T),_=(globalThis.process?.versions?.node||\"\").replace(/^v/,\"\")||null,y=Number(_?.split(\".\")[0])||null,W=globalThis.process||Object.create(null),c={versions:{}},w=new Proxy(W,{get(e,o){if(o===\"env\")return s;if(o in e)return e[o];if(o in c)return c[o]}}),A=globalThis.process?.release?.name===\"node\",L=!!globalThis.Bun||!!globalThis.process?.versions?.bun,D=!!globalThis.Deno,O=!!globalThis.fastly,S=!!globalThis.Netlify,N=!!globalThis.EdgeRuntime,u=globalThis.navigator?.userAgent===\"Cloudflare-Workers\",b=!!globalThis.__lagon__,F=[[S,\"netlify\"],[N,\"edge-light\"],[u,\"workerd\"],[O,\"fastly\"],[D,\"deno\"],[L,\"bun\"],[A,\"node\"],[b,\"lagon\"]];function G(){const e=F.find(o=>o[0]);if(e)return{name:e[1]}}const P=G(),K=P?.name||\"\";export{s as env,R as hasTTY,U as hasWindow,L as isBun,T as isCI,Y as isColorSupported,h as isDebug,D as isDeno,v as isDevelopment,N as isEdgeLight,O as isFastly,b as isLagon,M as isLinux,V as isMacOS,m as isMinimal,S as isNetlify,A as isNode,f as isProduction,C as isTest,a as isWindows,u as isWorkerd,t as nodeENV,y as nodeMajorVersion,_ as nodeVersion,I as platform,w as process,d as provider,l as providerInfo,K as runtime,P as runtimeInfo};\n","import {defineStore} from \"pinia\";\r\nimport axios from \"~/composables/axios\";\r\nimport {toast} from \"vue3-toastify\";\r\nimport {useUserStore} from \"~/stores/users\";\r\nimport type {Router} from \"vue-router\";\r\nimport nuxtStorage from \"nuxt-storage/nuxt-storage\";\r\nimport {isDevelopment, isProduction} from \"std-env\";\r\n\r\ninterface IUser {\r\n  user: object | unknown\r\n}\r\n\r\nexport const useAuthStore = defineStore('authUser', {\r\n  state: () => ({\r\n    current_user: {\r\n      id: null,\r\n      email: '',\r\n      password: '',\r\n      date_of_birth: '',\r\n      first_name: '',\r\n      last_name: '',\r\n      company_id: '',\r\n      phone: '',\r\n      photo: '',\r\n      position: '',\r\n      role: {},\r\n      status: '',\r\n      passport: '',\r\n      salary: {},\r\n      permissions: []\r\n    },\r\n    user: {} as IUser,\r\n    user_worker: {} as IUser,\r\n    permissions: [],\r\n    exam_active: false,\r\n    openNotification: false,\r\n    openSettings: false,\r\n    my_scroll: 0,\r\n    activeNav: false,\r\n  }),\r\n  getters: {\r\n    get_current_user(current_user) {\r\n      return this.current_user\r\n    },\r\n    get_user(user){\r\n      return this.user\r\n    },\r\n    get_server_domain(){\r\n      return 'https://test-api-buildwithus.ai-softdev.com'\r\n      // return 'https://192.168.1.2:8000'\r\n      // return 'http://192.168.152.169:8000'\r\n      // return 'https://f01d-94-158-60-209.ngrok-free.app'\r\n      // return 'https://api-buildwithus.ai-softdev.com'\r\n    }\r\n  },\r\n  actions: {\r\n    async authorize(params: { email: any, password: any }, router: Router) {\r\n      await axios.post('auth/login', {\r\n        email: params.email,\r\n        password: params.password,\r\n      }, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        nuxtStorage.localStorage.setData('token', response.data.access, isProduction ? 30 : 1200)\r\n        this.loadCurrentUser()\r\n        router.push('/base/companies').then(e=>{\r\n          toast.success('Успешная авторизация', {autoClose: 1500, theme: 'auto'},)\r\n        })\r\n      }).catch(e => {\r\n        router.push('/')\r\n        toast.error('Неверный логин или пароль', {autoClose: 1500, theme: \"auto\"})\r\n      })\r\n    },\r\n\r\n    async loadCurrentUserWorker() {\r\n      await axios.get('user/current-user-worker', {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(res => {\r\n        this.user_worker = res.data;\r\n      })\r\n    },\r\n\r\n    async loadCurrentUser() {\r\n     await axios.get('user/current-user', {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.user = response.data\r\n      })\r\n    },\r\n    async update_my(params: { user: any}) {\r\n      let fd = new FormData();\r\n      const originalUser = this.user\r\n      if(params.user.first_name !== originalUser.first_name) {\r\n        fd.set('first_name', params.user.first_name)\r\n      }\r\n      if(params.user.last_name !== originalUser.last_name) {\r\n        fd.set('last_name', params.user.last_name)\r\n      }\r\n      if(params.user.phone !== originalUser.phone) {\r\n        fd.set('phone', params.user.phone)\r\n      }\r\n      if(params.user.password !== originalUser.password) {\r\n        fd.set('password', params.user.password)\r\n      }\r\n      if(params.user.salary !== originalUser.salary) {\r\n        fd.set('salary', params.user.salary)\r\n      }\r\n      if(params.user.email !== originalUser.email) {\r\n        fd.set('email', params.user.email)\r\n      }\r\n      if(params.user.date_of_birth !== originalUser.date_of_birth) {\r\n        fd.set('date_of_birth', params.user.date_of_birth)\r\n      }\r\n      if(params.user.passport !== originalUser.passport) {\r\n        fd.set('password', params.user.password)\r\n      }\r\n      if(params.user.department_id !== originalUser.department_id) {\r\n        fd.set('department_id', params.user.department_id)\r\n      }\r\n      if(params.user.position.id !== originalUser.position.id) {\r\n        fd.set('position', params.user.position.id)\r\n      }\r\n      if (params.update_type !== 'current-user' && params.user.permissions_ids !== originalUser.permissions_id) {\r\n        fd.set('permissions_ids', params.permissions_ids)\r\n      }\r\n      if (params.update_type !== 'current-user' && params.user.role_id !== originalUser.role_id) {\r\n        fd.set('role_id', params.user.role_id)\r\n\r\n      }\r\n      if (typeof params.user.photo === 'string' && params.user.photo !== originalUser.photo) {\r\n        fd.set('photo', params.user.photo)\r\n      }\r\n      await axios.patch(`user/current-user`, fd, {\r\n        headers: {\r\n          Authorization: `Bearer ${nuxtStorage.localStorage.getData('token')}`\r\n        }\r\n      }).then(response => {\r\n        this.user = response.data\r\n        toast.success('Данные успешно обновлены', {autoClose: 1500, theme: 'auto'})\r\n      }).catch(e => {\r\n        toast.error(e, {autoClose: 1500, theme: 'auto'})\r\n      })\r\n    }\r\n  },\r\n})"],"names":["isProduction"],"mappings":"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","x_google_ignoreList":[0]}