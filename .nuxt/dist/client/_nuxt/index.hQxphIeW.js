import{_ as ee}from"./TheButton.vue.gJpUNod2.js";import{_ as te}from"./nuxt-link.CfP_OKzb.js";import{g as le,m as se,q as ae,l as o,s as ne,A as q,o as d,c as v,a as e,t as r,b as i,w as L,E as G,G as oe,h as a,H as N,d as u,n as b,F as H,r as Z,i as T,ae as re,j as ue,x as ie}from"./entry.Dos5mvIN.js";import{P as me}from"./vuejs-paginate-next.es.C8Kmb_O5.js";import{u as ce}from"./sales.B3a6nfTa.js";import{T as de}from"./ThePreloader.BJUDJ_6S.js";import{u as pe}from"./companies.CkXOzTuB.js";import{u as ge}from"./auth.aqacddpH.js";import{_ as j}from"./TheInput.vue.CR5iM2Pr.js";import{_ as _e}from"./TheModal.vue.D3hlHb3t.js";import"./nuxt-storage.Df5leMsQ.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const xe=""+globalThis.__publicAssetsURL("icons/export.svg"),ve=""+globalThis.__publicAssetsURL("icons/filters.svg"),f=""+globalThis.__publicAssetsURL("icons/table-arrow.svg"),be={class:"flex items-center justify-between max-[789px]:flex-col max-[789px]:items-start max-[789px]:gap-5"},fe={class:"dark:text-white text-3xl font-bold"},he={class:"ml-auto max-[789px]:ml-0 flex items-center gap-6 max-[465px]:flex-col"},we=e("img",{src:xe,alt:"export"},null,-1),ye={class:"text-azure font-medium"},ke=e("div",{class:"flex mt-10 max-[789px]:mt-4 items-center gap-x-4 max-md:flex-col max-md:items-start max-md:gap-y-4"},null,-1),Ce={class:"w-fit sales-up-table rounded-lg overflow-hidden"},Ve={class:"flex items-center justify-between gap-3 mb-4 max-[465px]:flex-col max-[465px]:items-start"},Ne=e("img",{src:ve,alt:"filters"},null,-1),$e={class:"w-4/12 max-md:w-full relative flex items-center"},Se=e("div",{class:"absolute rotate-90 ml-3"},[e("svg",{class:"dark:stroke-white stroke-black",width:"25px",height:"25px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M14.9536 14.9458L21 21M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z","stroke-width":"1.2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),qe={class:"w-full sales-table rounded-3xl bg-white overflow-hidden"},Le={key:0},Me={class:"bg-gray-200 dark:bg-bgWhite"},Ue=e("th",null," № ",-1),Be={key:1,class:"min-h-[300px] min-w-[89vw] bg-gray-200 dark:bg-bgWhite text-center flex items-center justify-center"},Te={key:2,class:"relative min-h-[400px] min-w-[89vw]"},je=e("div",{class:"bg-black w-full h-full absolute top-0 left-0 opacity-40 rounded-lg"},null,-1),Fe={class:"w-full flex items-center justify-end gap-4 pr-10 pb-5 pt-5 max-md:pr-3 max-md:flex-col max-md:items-end"},Re={class:"flex items-center gap-3"},Pe=e("p",null,"Строк на странице:",-1),Ae=["value"],Ie={class:"flex flex-col gap-5"},We=e("p",null," Фильтры: ",-1),tt=le({__name:"index",setup(ze){const M=ge(),R=pe(),p=se(),$=ae(),m=ce(),U=o(!1),g=o(Number(p.query.page)||1),c=o(Number(p.query.limit)||5),h=o(p.query.itemName||""),y=o(Number(p.query.min_price)||""),k=o(Number(p.query.max_price)||""),C=o(Number(p.query.min_count)||""),V=o(Number(p.query.max_count)||""),J=o([5,10,20,30,50]),w=o([]),B=o(""),S=()=>{$.push({query:{page:g.value,limit:c.value,itemName:h.value||void 0,min_price:y.value||"",max_price:k.value||"",min_count:C.value||"",max_count:V.value||"",order_by:B.value||""}})},K=s=>{g.value=s,S()},O=()=>{S()},X=()=>{g.value=1,S()},P=()=>{U.value=!U.value},A=o(0),_=s=>{const t=w.value.findIndex(n=>n===s||n===`-${s}`);t!==-1?w.value[t]=w.value[t].startsWith("-")?s:`-${s}`:w.value.push(s),S()},x=s=>w.value.includes(s)?"rotate-0":(w.value.includes(`-${s}`),"rotate-180"),Y=()=>{m.loadSalesListFile()};return ne(()=>{m.loadSalesList({page:g.value,limit:c.value,name:h.value,min_price:y.value,max_price:k.value,min_count:C.value,max_count:V.value,order_by:B.value})}),q(w.value,s=>{B.value=s.join(",")}),q(()=>m.sales,s=>{A.value=Math.ceil(m.sales.count/c.value)}),q(()=>p.query,s=>{g.value=Number(s.page)||1,c.value=Number(s.limit)||5,h.value=s.itemName||"",m.loadSalesList({page:g.value,limit:c.value,name:h.value,min_price:y.value,max_price:k.value,min_count:C.value,max_count:V.value,order_by:B.value})}),q(()=>M.user,s=>{var t,n;((n=(t=M==null?void 0:M.user)==null?void 0:t.role)==null?void 0:n.name_en)==="admin"&&(window.history.length>1?$.push("/base/profile"):$.push("/"))}),q(()=>R.company,s=>{var n;((n=R.company.modules)==null?void 0:n.find(F=>F.name_en==="sales"))||(window.history.length>1?$.push("/base/profile"):$.push("/"))}),(s,t)=>{var I,W,z,D,E;const n=ee,F=te;return d(),v("div",null,[e("div",be,[e("p",fe,r(s.$t("Страница продаж")),1),e("div",he,[e("button",{onClick:Y,class:"flex items-center gap-3"},[we,e("p",ye,r(s.$t("Экспортировать в файл")),1)]),i(F,{to:"/base/sales/item-create",class:"ml-auto"},{default:L(()=>[i(n,{class:"border border-golden bg-golden py-3 px-10 rounded-full !text-black dark:!text-white"},{default:L(()=>[u(" + Добавить товар ")]),_:1})]),_:1})])]),e("div",null,[ke,e("div",Ce,[e("div",Ve,[i(n,{onClick:P,class:"border bg-white flex items-center gap-1 p-3 rounded-full !text-black dark:!text-white max-md:shrink-0"},{default:L(()=>[Ne,u(" Фильтры ")]),_:1}),e("div",$e,[Se,G(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>N(h)?h.value=l:null),onInput:X,type:"text",class:"w-full rounded-full border dark:bg-gray-500 outline-none pl-12 h-[50px]",placeholder:"Найти товар..."},null,544),[[oe,a(h)]])])]),e("div",qe,[(W=(I=a(m).sales)==null?void 0:I.results)!=null&&W.length?(d(),v("table",Le,[e("thead",Me,[e("tr",null,[Ue,e("th",null,[e("button",{onClick:t[1]||(t[1]=l=>_("name")),class:"flex items-center gap-3"},[u(" Наименование "),e("img",{class:b(x("name")),src:f,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[2]||(t[2]=l=>_("sales_count")),class:"flex items-center gap-3"},[u(" Кол-во продаж "),e("img",{class:b(x("sales_count")),src:f,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[3]||(t[3]=l=>_("price_per_count")),class:"flex items-center gap-3"},[u(" Цена за единицу "),e("img",{class:b(x("price_per_count")),src:f,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[4]||(t[4]=l=>_("total")),class:"flex items-center gap-3"},[u(" Сумма "),e("img",{class:b(x("total")),src:f,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[5]||(t[5]=l=>_("vat")),class:"flex items-center gap-3"},[u(" НДС "),e("img",{class:b(x("vat")),src:f,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[6]||(t[6]=l=>_("total_with_vat")),class:"flex items-center gap-3"},[u(" Сумма с НДС "),e("img",{class:b(x("total_with_vat")),src:f,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[7]||(t[7]=l=>_("company_sale_to")),class:"flex items-center gap-3"},[u(" Наименование компании "),e("img",{class:b(x("company_sale_to")),src:f,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[8]||(t[8]=l=>_("agent")),class:"flex items-center gap-3"},[u(" Агент "),e("img",{class:b(x("agent")),src:f,alt:"table-arrow"},null,2)])])])]),e("tbody",null,[(d(!0),v(H,null,Z(a(m).sales.results,(l,Q)=>(d(),v("tr",null,[e("td",null,r(a(c)*(a(g)-1)+Q+1),1),e("td",null,r(l.name),1),e("td",null,r(l.sales_count),1),e("td",null,r(l.price_per_count),1),e("td",null,r(l.total),1),e("td",null,r(l.vat),1),e("td",null,r(l.total_with_vat),1),e("td",null,r(l.company_sale_to),1),e("td",null,r(l.agent.last_name+" "+l.agent.first_name+" "+l.agent.patronymic),1)]))),256))])])):T("",!0),((D=(z=a(m).sales)==null?void 0:z.results)==null?void 0:D.length)===0?(d(),v("div",Be," Товаров пока нет ")):T("",!0),(E=a(m).sales)!=null&&E.results?T("",!0):(d(),v("div",Te,[je,i(de)]))]),e("div",Fe,[i(a(me),{"page-count":a(A),"page-range":3,"margin-pages":2,"click-handler":K,"prev-text":"<","next-text":">","container-class":"pagination","page-class":"page-item","force-page":a(g)},null,8,["page-count","force-page"]),e("div",Re,[Pe,G(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>N(c)?c.value=l:null),onChange:O,class:"w-fit p-2.5 rounded-md border bg-white dark:bg-bgWhite text-black"},[(d(!0),v(H,null,Z(a(J),l=>(d(),v("option",{value:l},r(l),9,Ae))),256))],544),[[re,a(c)]])])])])]),a(U)?(d(),ue(_e,{key:0,type:"resize",onShowModal:t[15]||(t[15]=()=>{})},{default:L(()=>[e("button",{class:"absolute top-3 right-3",onClick:P}," x "),e("div",Ie,[We,e("form",{onSubmit:t[14]||(t[14]=ie(l=>{S(),U.value=!1},["prevent"])),class:"flex items-center gap-5 flex-col"},[i(j,{modelValue:a(y),"onUpdate:modelValue":t[10]||(t[10]=l=>N(y)?y.value=l:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Минимальная цена"},null,8,["modelValue"]),i(j,{modelValue:a(k),"onUpdate:modelValue":t[11]||(t[11]=l=>N(k)?k.value=l:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Максимальная цена"},null,8,["modelValue"]),i(j,{modelValue:a(C),"onUpdate:modelValue":t[12]||(t[12]=l=>N(C)?C.value=l:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Минимальное количество"},null,8,["modelValue"]),i(j,{modelValue:a(V),"onUpdate:modelValue":t[13]||(t[13]=l=>N(V)?V.value=l:null),class:"w-full bg-transparent bg-opacity-0 rounded-lg outline-none",type:"number",label:"Максимальное количество"},null,8,["modelValue"]),i(n,{class:"mt-2 bg-golden rounded-full !p-3 !text-black dark:!text-white"},{default:L(()=>[u(" Сохранить ")]),_:1})],32)])]),_:1})):T("",!0)])}}});export{tt as default};
