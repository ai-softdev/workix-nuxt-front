import{_ as ae}from"./TheButton.vue.qzwimFuC.js";import{_ as ne}from"./nuxt-link.0BSeoS-Q.js";import{N as u,O as d,a3 as r,Z as l,an as _,a4 as y,J as F,a2 as I,a5 as G,$ as v,_ as c,j as se,a as C,H as ie,b as q,L as k,V as L,aa as X,ab as re,u as m,x as K,ao as ue,P as de,a6 as oe}from"./swiper-vue.yO-n0JsZ.js";import{b as ce,c as ge}from"./entry.D8NOg32x.js";import{_ as me}from"./TheTextContent.vue.DJ99356g.js";import{_ as Y}from"./TheBreadcrumbs.vue.D1vQYOeq.js";import{u as fe}from"./sales.DBqSBt_V.js";import{T as ve}from"./ThePreloader.Dttt05B-.js";import{u as be}from"./companies.CAUw7Ubg.js";import{u as xe}from"./auth.C1MqO99w.js";import{_ as j}from"./TheInput.vue.7qlRdbvh.js";import{_ as ke}from"./TheModal.vue.CfyleZWN.js";import"./nuxt-storage.CgJyI38a.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const S=""+globalThis.__publicAssetsURL("icons/table-arrow.svg");var he=(g,n)=>{const e=g.__vccOpts||g;for(const[x,b]of n)e[x]=b;return e};const Ce={data(){return{innerValue:1}},props:{modelValue:{type:Number},pageCount:{type:Number,required:!0},initialPage:{type:Number,default:1},forcePage:{type:Number},clickHandler:{type:Function,default:()=>{}},pageRange:{type:Number,default:3},marginPages:{type:Number,default:1},prevText:{type:String,default:"Prev"},nextText:{type:String,default:"Next"},breakViewText:{type:String,default:"…"},containerClass:{type:String,default:"pagination"},pageClass:{type:String,default:"page-item"},pageLinkClass:{type:String,default:"page-link"},prevClass:{type:String,default:"page-item"},prevLinkClass:{type:String,default:"page-link"},nextClass:{type:String,default:"page-item"},nextLinkClass:{type:String,default:"page-link"},breakViewClass:{type:String},breakViewLinkClass:{type:String},activeClass:{type:String,default:"active"},disabledClass:{type:String,default:"disabled"},noLiSurround:{type:Boolean,default:!1},firstLastButton:{type:Boolean,default:!1},firstButtonText:{type:String,default:"First"},lastButtonText:{type:String,default:"Last"},hidePrevNext:{type:Boolean,default:!1}},computed:{selected:{get:function(){return this.modelValue||this.innerValue},set:function(g){this.innerValue=g}},pages:function(){let g={};if(this.pageCount<=this.pageRange)for(let n=0;n<this.pageCount;n++){let e={index:n,content:n+1,selected:n===this.selected-1};g[n]=e}else{const n=Math.floor(this.pageRange/2);let e=t=>{let f={index:t,content:t+1,selected:t===this.selected-1};g[t]=f},x=t=>{let f={disabled:!0,breakView:!0};g[t]=f};for(let t=0;t<this.marginPages;t++)e(t);let b=0;this.selected-n>0&&(b=this.selected-1-n);let a=b+this.pageRange-1;a>=this.pageCount&&(a=this.pageCount-1,b=a-this.pageRange+1);for(let t=b;t<=a&&t<=this.pageCount-1;t++)e(t);b>this.marginPages&&x(b-1),a+1<this.pageCount-this.marginPages&&x(a+1);for(let t=this.pageCount-1;t>=this.pageCount-this.marginPages;t--)e(t)}return g}},methods:{handlePageSelected(g){this.selected!==g&&(this.innerValue=g,this.$emit("update:modelValue",g),this.clickHandler(g))},prevPage(){this.selected<=1||this.handlePageSelected(this.selected-1)},nextPage(){this.selected>=this.pageCount||this.handlePageSelected(this.selected+1)},firstPageSelected(){return this.selected===1},lastPageSelected(){return this.selected===this.pageCount||this.pageCount===0},selectFirstPage(){this.selected<=1||this.handlePageSelected(1)},selectLastPage(){this.selected>=this.pageCount||this.handlePageSelected(this.pageCount)}},beforeMount(){this.innerValue=this.initialPage},beforeUpdate(){this.forcePage!==void 0&&this.forcePage!==this.selected&&(this.selected=this.forcePage)}},ye=["tabindex","innerHTML"],_e=["tabindex","innerHTML"],pe=["onClick","onKeyup"],we=["tabindex","innerHTML"],Pe=["tabindex","innerHTML"],Le=["innerHTML"],Se=["innerHTML"],Ve=["onClick","onKeyup"],Te=["innerHTML"],Ne=["innerHTML"];function Me(g,n,e,x,b,a){return e.noLiSurround?(u(),d("div",{key:1,class:r(e.containerClass)},[e.firstLastButton?(u(),d("a",{key:0,onClick:n[8]||(n[8]=t=>a.selectFirstPage()),onKeyup:n[9]||(n[9]=_(t=>a.selectFirstPage(),["enter"])),class:r([e.pageLinkClass,a.firstPageSelected()?e.disabledClass:""]),tabindex:"0",innerHTML:e.firstButtonText},null,42,Le)):y("",!0),a.firstPageSelected()&&e.hidePrevNext?y("",!0):(u(),d("a",{key:1,onClick:n[10]||(n[10]=t=>a.prevPage()),onKeyup:n[11]||(n[11]=_(t=>a.prevPage(),["enter"])),class:r([e.prevLinkClass,a.firstPageSelected()?e.disabledClass:""]),tabindex:"0",innerHTML:e.prevText},null,42,Se)),(u(!0),d(F,null,I(a.pages,t=>(u(),d(F,null,[t.breakView?(u(),d("a",{key:t.index,class:r([e.pageLinkClass,e.breakViewLinkClass,t.disabled?e.disabledClass:""]),tabindex:"0"},[G(g.$slots,"breakViewContent",{},()=>[v(c(e.breakViewText),1)])],2)):t.disabled?(u(),d("a",{key:t.index,class:r([e.pageLinkClass,t.selected?e.activeClass:"",e.disabledClass]),tabindex:"0"},c(t.content),3)):(u(),d("a",{key:t.index,onClick:f=>a.handlePageSelected(t.index+1),onKeyup:_(f=>a.handlePageSelected(t.index+1),["enter"]),class:r([e.pageLinkClass,t.selected?e.activeClass:""]),tabindex:"0"},c(t.content),43,Ve))],64))),256)),a.lastPageSelected()&&e.hidePrevNext?y("",!0):(u(),d("a",{key:2,onClick:n[12]||(n[12]=t=>a.nextPage()),onKeyup:n[13]||(n[13]=_(t=>a.nextPage(),["enter"])),class:r([e.nextLinkClass,a.lastPageSelected()?e.disabledClass:""]),tabindex:"0",innerHTML:e.nextText},null,42,Te)),e.firstLastButton?(u(),d("a",{key:3,onClick:n[14]||(n[14]=t=>a.selectLastPage()),onKeyup:n[15]||(n[15]=_(t=>a.selectLastPage(),["enter"])),class:r([e.pageLinkClass,a.lastPageSelected()?e.disabledClass:""]),tabindex:"0",innerHTML:e.lastButtonText},null,42,Ne)):y("",!0)],2)):(u(),d("ul",{key:0,class:r(e.containerClass)},[e.firstLastButton?(u(),d("li",{key:0,class:r([e.pageClass,a.firstPageSelected()?e.disabledClass:""])},[l("a",{onClick:n[0]||(n[0]=t=>a.selectFirstPage()),onKeyup:n[1]||(n[1]=_(t=>a.selectFirstPage(),["enter"])),class:r(e.pageLinkClass),tabindex:a.firstPageSelected()?-1:0,innerHTML:e.firstButtonText},null,42,ye)],2)):y("",!0),a.firstPageSelected()&&e.hidePrevNext?y("",!0):(u(),d("li",{key:1,class:r([e.prevClass,a.firstPageSelected()?e.disabledClass:""])},[l("a",{onClick:n[2]||(n[2]=t=>a.prevPage()),onKeyup:n[3]||(n[3]=_(t=>a.prevPage(),["enter"])),class:r(e.prevLinkClass),tabindex:a.firstPageSelected()?-1:0,innerHTML:e.prevText},null,42,_e)],2)),(u(!0),d(F,null,I(a.pages,t=>(u(),d("li",{key:t.index,class:r([e.pageClass,t.selected?e.activeClass:"",t.disabled?e.disabledClass:"",t.breakView?e.breakViewClass:""])},[t.breakView?(u(),d("a",{key:0,class:r([e.pageLinkClass,e.breakViewLinkClass]),tabindex:"0"},[G(g.$slots,"breakViewContent",{},()=>[v(c(e.breakViewText),1)])],2)):t.disabled?(u(),d("a",{key:1,class:r(e.pageLinkClass),tabindex:"0"},c(t.content),3)):(u(),d("a",{key:2,onClick:f=>a.handlePageSelected(t.index+1),onKeyup:_(f=>a.handlePageSelected(t.index+1),["enter"]),class:r(e.pageLinkClass),tabindex:"0"},c(t.content),43,pe))],2))),128)),a.lastPageSelected()&&e.hidePrevNext?y("",!0):(u(),d("li",{key:2,class:r([e.nextClass,a.lastPageSelected()?e.disabledClass:""])},[l("a",{onClick:n[4]||(n[4]=t=>a.nextPage()),onKeyup:n[5]||(n[5]=_(t=>a.nextPage(),["enter"])),class:r(e.nextLinkClass),tabindex:a.lastPageSelected()?-1:0,innerHTML:e.nextText},null,42,we)],2)),e.firstLastButton?(u(),d("li",{key:3,class:r([e.pageClass,a.lastPageSelected()?e.disabledClass:""])},[l("a",{onClick:n[6]||(n[6]=t=>a.selectLastPage()),onKeyup:n[7]||(n[7]=_(t=>a.selectLastPage(),["enter"])),class:r(e.pageLinkClass),tabindex:a.lastPageSelected()?-1:0,innerHTML:e.lastButtonText},null,42,Pe)],2)):y("",!0)],2))}var Be=he(Ce,[["render",Me]]);const He={class:"flex items-center gap-x-4 max-md:mt-10 max-md:flex-col max-md:items-start max-md:gap-y-4"},Ke={class:"flex items-center gap-x-4"},Re=l("div",null,[l("svg",{width:"15px",height:"15px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[l("path",{class:"dark:stroke-white stroke-black",d:"M14 12C14 14.7614 11.7614 17 9 17H7C4.23858 17 2 14.7614 2 12C2 9.23858 4.23858 7 7 7H7.5M10 12C10 9.23858 12.2386 7 15 7H17C19.7614 7 22 9.23858 22 12C22 14.7614 19.7614 17 17 17H16.5","stroke-width":"2","stroke-linecap":"round"})])],-1),qe={class:"w-fit sales-up-table rounded-lg border mt-10 overflow-hidden"},Fe={class:"p-4 flex items-center gap-3"},Ue={class:"w-4/12 max-md:w-full relative flex items-center"},je=l("div",{class:"absolute rotate-90 ml-2"},[l("svg",{class:"dark:stroke-white stroke-black",width:"25px",height:"25px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[l("path",{d:"M14.9536 14.9458L21 21M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z","stroke-width":"1.2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),Ie={class:"w-full sales-table"},We={key:0},De={class:"bg-gray-200 dark:bg-bgWhite"},ze=l("th",null," № ",-1),Oe={key:1,class:"min-h-[300px] min-w-[89vw] bg-gray-200 dark:bg-bgWhite text-center flex items-center justify-center"},Ze={key:2,class:"relative min-h-[400px] min-w-[89vw]"},Ae=l("div",{class:"bg-black w-full h-full absolute top-0 left-0 opacity-40 rounded-lg"},null,-1),Ee={class:"w-full flex items-center justify-end border-t gap-4 pr-10 pb-5 pt-5 max-md:pr-3 max-md:flex-col max-md:items-end"},Je={class:"flex items-center gap-3"},Ge=l("p",null,"Строк на странице:",-1),Xe=["value"],Ye={class:"flex flex-col gap-5"},Qe=l("p",null," Фильтры: ",-1),mt=se({__name:"index",setup(g){const n=xe(),e=be(),x=ce(),b=ge(),a=fe(),t=C(!1),f=C(Number(x.query.page)||1),p=C(Number(x.query.limit)||5),V=C(x.query.itemName||""),N=C(Number(x.query.min_price)||""),M=C(Number(x.query.max_price)||""),B=C(Number(x.query.min_count)||""),H=C(Number(x.query.max_count)||""),Q=C([5,10,20,30,50]),T=C([]),U=C(""),R=()=>{b.push({query:{page:f.value,limit:p.value,itemName:V.value||void 0,min_price:N.value||"",max_price:M.value||"",min_count:B.value||"",max_count:H.value||"",order_by:U.value||""}})},$=o=>{f.value=o,R()},ee=()=>{R()},te=()=>{f.value=1,R()},D=()=>{t.value=!t.value},z=C(0),w=o=>{const s=T.value.findIndex(h=>h===o||h===`-${o}`);s!==-1?T.value[s]=T.value[s].startsWith("-")?o:`-${o}`:T.value.push(o),R()},P=o=>T.value.includes(o)?"rotate-0":(T.value.includes(`-${o}`),"rotate-180");return ie(()=>{a.loadSalesList({page:f.value,limit:p.value,name:V.value,min_price:N.value,max_price:M.value,min_count:B.value,max_count:H.value,order_by:U.value})}),q(T.value,o=>{U.value=o.join(",")}),q(()=>a.sales,o=>{z.value=Math.ceil(a.sales.count/p.value)}),q(()=>x.query,o=>{f.value=Number(o.page)||1,p.value=Number(o.limit)||5,V.value=o.itemName||"",a.loadSalesList({page:f.value,limit:p.value,name:V.value,min_price:N.value,max_price:M.value,min_count:B.value,max_count:H.value,order_by:U.value})}),q(()=>n.user,o=>{var s,h;((h=(s=n==null?void 0:n.user)==null?void 0:s.role)==null?void 0:h.name_en)==="admin"&&(window.history.length>1?b.push("/base/profile"):b.push("/"))}),q(()=>e.company,o=>{var h;((h=e.company.modules)==null?void 0:h.find(W=>W.name_en==="sales"))||(window.history.length>1?b.push("/base/profile"):b.push("/"))}),(o,s)=>{var O,Z,A,E,J;const h=ae,W=ne;return u(),d("div",null,[k(me,null,{default:L(()=>[v(c(o.$t("Страница продаж")),1)]),_:1}),l("div",null,[l("div",He,[l("div",Ke,[k(Y,{"breadcrumb-link":"/base/profile"},{default:L(()=>[v(c(o.$t("Профиль")),1)]),_:1}),Re,k(Y,null,{default:L(()=>[v(c(o.$t("Продажи")),1)]),_:1})]),k(W,{to:"/base/sales/item-create",class:"ml-auto"},{default:L(()=>[k(h,{class:"border p-3 rounded-lg !text-black dark:!text-white"},{default:L(()=>[v(" Добавить товар ")]),_:1})]),_:1})]),l("div",qe,[l("div",Fe,[k(h,{onClick:D,class:"border p-3 rounded-lg !text-black dark:!text-white"},{default:L(()=>[v(" Фильтры ")]),_:1}),l("div",Ue,[je,X(l("input",{"onUpdate:modelValue":s[0]||(s[0]=i=>K(V)?V.value=i:null),onInput:te,type:"text",class:"w-full rounded-lg dark:bg-gray-500 outline-none pl-10 h-[50px]",placeholder:"Найти товар..."},null,544),[[re,m(V)]])])]),l("div",Ie,[(Z=(O=m(a).sales)==null?void 0:O.results)!=null&&Z.length?(u(),d("table",We,[l("thead",De,[l("tr",null,[ze,l("th",null,[l("button",{onClick:s[1]||(s[1]=i=>w("name")),class:"flex items-center gap-3"},[v(" Наименование "),l("img",{class:r(P("name")),src:S,alt:"table-arrow"},null,2)])]),l("th",null,[l("button",{onClick:s[2]||(s[2]=i=>w("sales_count")),class:"flex items-center gap-3"},[v(" Кол-во продаж "),l("img",{class:r(P("sales_count")),src:S,alt:"table-arrow"},null,2)])]),l("th",null,[l("button",{onClick:s[3]||(s[3]=i=>w("price_per_count")),class:"flex items-center gap-3"},[v(" Цена за единицу "),l("img",{class:r(P("price_per_count")),src:S,alt:"table-arrow"},null,2)])]),l("th",null,[l("button",{onClick:s[4]||(s[4]=i=>w("total")),class:"flex items-center gap-3"},[v(" Сумма "),l("img",{class:r(P("total")),src:S,alt:"table-arrow"},null,2)])]),l("th",null,[l("button",{onClick:s[5]||(s[5]=i=>w("vat")),class:"flex items-center gap-3"},[v(" НДС "),l("img",{class:r(P("vat")),src:S,alt:"table-arrow"},null,2)])]),l("th",null,[l("button",{onClick:s[6]||(s[6]=i=>w("total_with_vat")),class:"flex items-center gap-3"},[v(" Сумма с НДС "),l("img",{class:r(P("total_with_vat")),src:S,alt:"table-arrow"},null,2)])]),l("th",null,[l("button",{onClick:s[7]||(s[7]=i=>w("company_sale_to")),class:"flex items-center gap-3"},[v(" Наименование компании "),l("img",{class:r(P("company_sale_to")),src:S,alt:"table-arrow"},null,2)])]),l("th",null,[l("button",{onClick:s[8]||(s[8]=i=>w("agent")),class:"flex items-center gap-3"},[v(" Агент "),l("img",{class:r(P("agent")),src:S,alt:"table-arrow"},null,2)])])])]),l("tbody",null,[(u(!0),d(F,null,I(m(a).sales.results,(i,le)=>(u(),d("tr",null,[l("td",null,c(m(p)*(m(f)-1)+le+1),1),l("td",null,c(i.name),1),l("td",null,c(i.sales_count),1),l("td",null,c(i.price_per_count),1),l("td",null,c(i.total),1),l("td",null,c(i.vat),1),l("td",null,c(i.total_with_vat),1),l("td",null,c(i.company_sale_to),1),l("td",null,c(i.agent.last_name+" "+i.agent.first_name+" "+i.agent.patronymic),1)]))),256))])])):y("",!0),((E=(A=m(a).sales)==null?void 0:A.results)==null?void 0:E.length)===0?(u(),d("div",Oe," Товаров пока нет ")):y("",!0),(J=m(a).sales)!=null&&J.results?y("",!0):(u(),d("div",Ze,[Ae,k(ve)]))]),l("div",Ee,[k(m(Be),{"page-count":m(z),"page-range":3,"margin-pages":2,"click-handler":$,"prev-text":"<","next-text":">","container-class":"pagination","page-class":"page-item","force-page":m(f)},null,8,["page-count","force-page"]),l("div",Je,[Ge,X(l("select",{"onUpdate:modelValue":s[9]||(s[9]=i=>K(p)?p.value=i:null),onChange:ee,class:"w-fit p-2.5 rounded-md bg-[#8881] dark:bg-bgWhite text-black"},[(u(!0),d(F,null,I(m(Q),i=>(u(),d("option",{value:i},c(i),9,Xe))),256))],544),[[ue,m(p)]])])])])]),m(t)?(u(),de(ke,{key:0,type:"resize",onShowModal:s[15]||(s[15]=()=>{})},{default:L(()=>[l("button",{class:"absolute top-3 right-3",onClick:D}," x "),l("div",Ye,[Qe,l("form",{onSubmit:s[14]||(s[14]=oe(i=>{R(),t.value=!1},["prevent"])),class:"flex items-center gap-5 flex-col"},[k(j,{modelValue:m(N),"onUpdate:modelValue":s[10]||(s[10]=i=>K(N)?N.value=i:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Минимальная цена"},null,8,["modelValue"]),k(j,{modelValue:m(M),"onUpdate:modelValue":s[11]||(s[11]=i=>K(M)?M.value=i:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Максимальная цена"},null,8,["modelValue"]),k(j,{modelValue:m(B),"onUpdate:modelValue":s[12]||(s[12]=i=>K(B)?B.value=i:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Минимальное количество"},null,8,["modelValue"]),k(j,{modelValue:m(H),"onUpdate:modelValue":s[13]||(s[13]=i=>K(H)?H.value=i:null),class:"w-full bg-transparent bg-opacity-0 rounded-lg outline-none",type:"number",label:"Максимальное количество"},null,8,["modelValue"]),k(h,{class:"mt-2 !text-black dark:!text-white"},{default:L(()=>[v(" Сохранить ")]),_:1})],32)])]),_:1})):y("",!0)])}}});export{mt as default};
