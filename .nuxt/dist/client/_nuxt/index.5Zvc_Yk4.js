import{_ as ne}from"./TheButton.vue.D1qj47gJ.js";import{_ as se}from"./nuxt-link.vdwnkbCB.js";import{N as u,O as d,a3 as r,Z as t,an as _,a4 as y,J as q,a2 as I,a5 as G,$ as f,_ as c,j as ie,a as C,H as re,b as R,L as k,V as w,aa as X,ab as ue,u as m,x as K,ao as de,P as oe,a6 as ce}from"./swiper-vue.yO-n0JsZ.js";import{b as ge,c as me}from"./entry.BzAtAm_p.js";import{_ as fe}from"./TheTextContent.vue.DJ99356g.js";import{_ as Y}from"./TheBreadcrumbs.vue.CWPKOqme.js";import{u as ve}from"./sales.CenTHQmk.js";import{T as be}from"./ThePreloader.Dttt05B-.js";import{u as xe}from"./companies.CsHqSRw_.js";import{u as ke}from"./auth.CBOA74pJ.js";import{_ as j}from"./TheInput.vue.7qlRdbvh.js";import{_ as he}from"./TheModal.vue.CfyleZWN.js";import"./nuxt-storage.CgJyI38a.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const S=""+globalThis.__publicAssetsURL("icons/table-arrow.svg");var Ce=(g,n)=>{const e=g.__vccOpts||g;for(const[x,b]of n)e[x]=b;return e};const ye={data(){return{innerValue:1}},props:{modelValue:{type:Number},pageCount:{type:Number,required:!0},initialPage:{type:Number,default:1},forcePage:{type:Number},clickHandler:{type:Function,default:()=>{}},pageRange:{type:Number,default:3},marginPages:{type:Number,default:1},prevText:{type:String,default:"Prev"},nextText:{type:String,default:"Next"},breakViewText:{type:String,default:"…"},containerClass:{type:String,default:"pagination"},pageClass:{type:String,default:"page-item"},pageLinkClass:{type:String,default:"page-link"},prevClass:{type:String,default:"page-item"},prevLinkClass:{type:String,default:"page-link"},nextClass:{type:String,default:"page-item"},nextLinkClass:{type:String,default:"page-link"},breakViewClass:{type:String},breakViewLinkClass:{type:String},activeClass:{type:String,default:"active"},disabledClass:{type:String,default:"disabled"},noLiSurround:{type:Boolean,default:!1},firstLastButton:{type:Boolean,default:!1},firstButtonText:{type:String,default:"First"},lastButtonText:{type:String,default:"Last"},hidePrevNext:{type:Boolean,default:!1}},computed:{selected:{get:function(){return this.modelValue||this.innerValue},set:function(g){this.innerValue=g}},pages:function(){let g={};if(this.pageCount<=this.pageRange)for(let n=0;n<this.pageCount;n++){let e={index:n,content:n+1,selected:n===this.selected-1};g[n]=e}else{const n=Math.floor(this.pageRange/2);let e=l=>{let v={index:l,content:l+1,selected:l===this.selected-1};g[l]=v},x=l=>{let v={disabled:!0,breakView:!0};g[l]=v};for(let l=0;l<this.marginPages;l++)e(l);let b=0;this.selected-n>0&&(b=this.selected-1-n);let a=b+this.pageRange-1;a>=this.pageCount&&(a=this.pageCount-1,b=a-this.pageRange+1);for(let l=b;l<=a&&l<=this.pageCount-1;l++)e(l);b>this.marginPages&&x(b-1),a+1<this.pageCount-this.marginPages&&x(a+1);for(let l=this.pageCount-1;l>=this.pageCount-this.marginPages;l--)e(l)}return g}},methods:{handlePageSelected(g){this.selected!==g&&(this.innerValue=g,this.$emit("update:modelValue",g),this.clickHandler(g))},prevPage(){this.selected<=1||this.handlePageSelected(this.selected-1)},nextPage(){this.selected>=this.pageCount||this.handlePageSelected(this.selected+1)},firstPageSelected(){return this.selected===1},lastPageSelected(){return this.selected===this.pageCount||this.pageCount===0},selectFirstPage(){this.selected<=1||this.handlePageSelected(1)},selectLastPage(){this.selected>=this.pageCount||this.handlePageSelected(this.pageCount)}},beforeMount(){this.innerValue=this.initialPage},beforeUpdate(){this.forcePage!==void 0&&this.forcePage!==this.selected&&(this.selected=this.forcePage)}},_e=["tabindex","innerHTML"],pe=["tabindex","innerHTML"],we=["onClick","onKeyup"],Pe=["tabindex","innerHTML"],Le=["tabindex","innerHTML"],Se=["innerHTML"],Ve=["innerHTML"],Te=["onClick","onKeyup"],Ne=["innerHTML"],Me=["innerHTML"];function Be(g,n,e,x,b,a){return e.noLiSurround?(u(),d("div",{key:1,class:r(e.containerClass)},[e.firstLastButton?(u(),d("a",{key:0,onClick:n[8]||(n[8]=l=>a.selectFirstPage()),onKeyup:n[9]||(n[9]=_(l=>a.selectFirstPage(),["enter"])),class:r([e.pageLinkClass,a.firstPageSelected()?e.disabledClass:""]),tabindex:"0",innerHTML:e.firstButtonText},null,42,Se)):y("",!0),a.firstPageSelected()&&e.hidePrevNext?y("",!0):(u(),d("a",{key:1,onClick:n[10]||(n[10]=l=>a.prevPage()),onKeyup:n[11]||(n[11]=_(l=>a.prevPage(),["enter"])),class:r([e.prevLinkClass,a.firstPageSelected()?e.disabledClass:""]),tabindex:"0",innerHTML:e.prevText},null,42,Ve)),(u(!0),d(q,null,I(a.pages,l=>(u(),d(q,null,[l.breakView?(u(),d("a",{key:l.index,class:r([e.pageLinkClass,e.breakViewLinkClass,l.disabled?e.disabledClass:""]),tabindex:"0"},[G(g.$slots,"breakViewContent",{},()=>[f(c(e.breakViewText),1)])],2)):l.disabled?(u(),d("a",{key:l.index,class:r([e.pageLinkClass,l.selected?e.activeClass:"",e.disabledClass]),tabindex:"0"},c(l.content),3)):(u(),d("a",{key:l.index,onClick:v=>a.handlePageSelected(l.index+1),onKeyup:_(v=>a.handlePageSelected(l.index+1),["enter"]),class:r([e.pageLinkClass,l.selected?e.activeClass:""]),tabindex:"0"},c(l.content),43,Te))],64))),256)),a.lastPageSelected()&&e.hidePrevNext?y("",!0):(u(),d("a",{key:2,onClick:n[12]||(n[12]=l=>a.nextPage()),onKeyup:n[13]||(n[13]=_(l=>a.nextPage(),["enter"])),class:r([e.nextLinkClass,a.lastPageSelected()?e.disabledClass:""]),tabindex:"0",innerHTML:e.nextText},null,42,Ne)),e.firstLastButton?(u(),d("a",{key:3,onClick:n[14]||(n[14]=l=>a.selectLastPage()),onKeyup:n[15]||(n[15]=_(l=>a.selectLastPage(),["enter"])),class:r([e.pageLinkClass,a.lastPageSelected()?e.disabledClass:""]),tabindex:"0",innerHTML:e.lastButtonText},null,42,Me)):y("",!0)],2)):(u(),d("ul",{key:0,class:r(e.containerClass)},[e.firstLastButton?(u(),d("li",{key:0,class:r([e.pageClass,a.firstPageSelected()?e.disabledClass:""])},[t("a",{onClick:n[0]||(n[0]=l=>a.selectFirstPage()),onKeyup:n[1]||(n[1]=_(l=>a.selectFirstPage(),["enter"])),class:r(e.pageLinkClass),tabindex:a.firstPageSelected()?-1:0,innerHTML:e.firstButtonText},null,42,_e)],2)):y("",!0),a.firstPageSelected()&&e.hidePrevNext?y("",!0):(u(),d("li",{key:1,class:r([e.prevClass,a.firstPageSelected()?e.disabledClass:""])},[t("a",{onClick:n[2]||(n[2]=l=>a.prevPage()),onKeyup:n[3]||(n[3]=_(l=>a.prevPage(),["enter"])),class:r(e.prevLinkClass),tabindex:a.firstPageSelected()?-1:0,innerHTML:e.prevText},null,42,pe)],2)),(u(!0),d(q,null,I(a.pages,l=>(u(),d("li",{key:l.index,class:r([e.pageClass,l.selected?e.activeClass:"",l.disabled?e.disabledClass:"",l.breakView?e.breakViewClass:""])},[l.breakView?(u(),d("a",{key:0,class:r([e.pageLinkClass,e.breakViewLinkClass]),tabindex:"0"},[G(g.$slots,"breakViewContent",{},()=>[f(c(e.breakViewText),1)])],2)):l.disabled?(u(),d("a",{key:1,class:r(e.pageLinkClass),tabindex:"0"},c(l.content),3)):(u(),d("a",{key:2,onClick:v=>a.handlePageSelected(l.index+1),onKeyup:_(v=>a.handlePageSelected(l.index+1),["enter"]),class:r(e.pageLinkClass),tabindex:"0"},c(l.content),43,we))],2))),128)),a.lastPageSelected()&&e.hidePrevNext?y("",!0):(u(),d("li",{key:2,class:r([e.nextClass,a.lastPageSelected()?e.disabledClass:""])},[t("a",{onClick:n[4]||(n[4]=l=>a.nextPage()),onKeyup:n[5]||(n[5]=_(l=>a.nextPage(),["enter"])),class:r(e.nextLinkClass),tabindex:a.lastPageSelected()?-1:0,innerHTML:e.nextText},null,42,Pe)],2)),e.firstLastButton?(u(),d("li",{key:3,class:r([e.pageClass,a.lastPageSelected()?e.disabledClass:""])},[t("a",{onClick:n[6]||(n[6]=l=>a.selectLastPage()),onKeyup:n[7]||(n[7]=_(l=>a.selectLastPage(),["enter"])),class:r(e.pageLinkClass),tabindex:a.lastPageSelected()?-1:0,innerHTML:e.lastButtonText},null,42,Le)],2)):y("",!0)],2))}var He=Ce(ye,[["render",Be]]);const Ke={class:"flex items-center gap-x-4 max-md:mt-10 max-md:flex-col max-md:items-start max-md:gap-y-4"},Fe={class:"flex items-center gap-x-4"},Re=t("div",null,[t("svg",{width:"15px",height:"15px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{class:"dark:stroke-white stroke-black",d:"M14 12C14 14.7614 11.7614 17 9 17H7C4.23858 17 2 14.7614 2 12C2 9.23858 4.23858 7 7 7H7.5M10 12C10 9.23858 12.2386 7 15 7H17C19.7614 7 22 9.23858 22 12C22 14.7614 19.7614 17 17 17H16.5","stroke-width":"2","stroke-linecap":"round"})])],-1),qe={class:"ml-auto flex items-center gap-3"},Ue={class:"w-fit sales-up-table rounded-lg border mt-10 overflow-hidden"},je={class:"p-4 flex items-center gap-3"},Ie={class:"w-4/12 max-md:w-full relative flex items-center"},We=t("div",{class:"absolute rotate-90 ml-2"},[t("svg",{class:"dark:stroke-white stroke-black",width:"25px",height:"25px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M14.9536 14.9458L21 21M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z","stroke-width":"1.2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),De={class:"w-full sales-table"},ze={key:0},Oe={class:"bg-gray-200 dark:bg-bgWhite"},Ze=t("th",null," № ",-1),Ae={key:1,class:"min-h-[300px] min-w-[89vw] bg-gray-200 dark:bg-bgWhite text-center flex items-center justify-center"},Ee={key:2,class:"relative min-h-[400px] min-w-[89vw]"},Je=t("div",{class:"bg-black w-full h-full absolute top-0 left-0 opacity-40 rounded-lg"},null,-1),Ge={class:"w-full flex items-center justify-end border-t gap-4 pr-10 pb-5 pt-5 max-md:pr-3 max-md:flex-col max-md:items-end"},Xe={class:"flex items-center gap-3"},Ye=t("p",null,"Строк на странице:",-1),Qe=["value"],$e={class:"flex flex-col gap-5"},et=t("p",null," Фильтры: ",-1),vt=ie({__name:"index",setup(g){const n=ke(),e=xe(),x=ge(),b=me(),a=ve(),l=C(!1),v=C(Number(x.query.page)||1),p=C(Number(x.query.limit)||5),V=C(x.query.itemName||""),N=C(Number(x.query.min_price)||""),M=C(Number(x.query.max_price)||""),B=C(Number(x.query.min_count)||""),H=C(Number(x.query.max_count)||""),Q=C([5,10,20,30,50]),T=C([]),U=C(""),F=()=>{b.push({query:{page:v.value,limit:p.value,itemName:V.value||void 0,min_price:N.value||"",max_price:M.value||"",min_count:B.value||"",max_count:H.value||"",order_by:U.value||""}})},$=o=>{v.value=o,F()},ee=()=>{F()},te=()=>{v.value=1,F()},D=()=>{l.value=!l.value},z=C(0),P=o=>{const s=T.value.findIndex(h=>h===o||h===`-${o}`);s!==-1?T.value[s]=T.value[s].startsWith("-")?o:`-${o}`:T.value.push(o),F()},L=o=>T.value.includes(o)?"rotate-0":(T.value.includes(`-${o}`),"rotate-180"),le=()=>{a.loadSalesListFile()};return re(()=>{a.loadSalesList({page:v.value,limit:p.value,name:V.value,min_price:N.value,max_price:M.value,min_count:B.value,max_count:H.value,order_by:U.value})}),R(T.value,o=>{U.value=o.join(",")}),R(()=>a.sales,o=>{z.value=Math.ceil(a.sales.count/p.value)}),R(()=>x.query,o=>{v.value=Number(o.page)||1,p.value=Number(o.limit)||5,V.value=o.itemName||"",a.loadSalesList({page:v.value,limit:p.value,name:V.value,min_price:N.value,max_price:M.value,min_count:B.value,max_count:H.value,order_by:U.value})}),R(()=>n.user,o=>{var s,h;((h=(s=n==null?void 0:n.user)==null?void 0:s.role)==null?void 0:h.name_en)==="admin"&&(window.history.length>1?b.push("/base/profile"):b.push("/"))}),R(()=>e.company,o=>{var h;((h=e.company.modules)==null?void 0:h.find(W=>W.name_en==="sales"))||(window.history.length>1?b.push("/base/profile"):b.push("/"))}),(o,s)=>{var O,Z,A,E,J;const h=ne,W=se;return u(),d("div",null,[k(fe,null,{default:w(()=>[f(c(o.$t("Страница продаж")),1)]),_:1}),t("div",null,[t("div",Ke,[t("div",Fe,[k(Y,{"breadcrumb-link":"/base/profile"},{default:w(()=>[f(c(o.$t("Профиль")),1)]),_:1}),Re,k(Y,null,{default:w(()=>[f(c(o.$t("Продажи")),1)]),_:1})]),t("div",qe,[k(W,{to:"/base/sales/item-create",class:"ml-auto"},{default:w(()=>[k(h,{class:"border p-3 rounded-lg !text-black dark:!text-white"},{default:w(()=>[f(" Добавить товар ")]),_:1})]),_:1}),k(h,{onClick:le,class:"border p-3 rounded-lg !text-black dark:!text-white"},{default:w(()=>[f(" Экспортировать список ")]),_:1})])]),t("div",Ue,[t("div",je,[k(h,{onClick:D,class:"border p-3 rounded-lg !text-black dark:!text-white"},{default:w(()=>[f(" Фильтры ")]),_:1}),t("div",Ie,[We,X(t("input",{"onUpdate:modelValue":s[0]||(s[0]=i=>K(V)?V.value=i:null),onInput:te,type:"text",class:"w-full rounded-lg dark:bg-gray-500 outline-none pl-10 h-[50px]",placeholder:"Найти товар..."},null,544),[[ue,m(V)]])])]),t("div",De,[(Z=(O=m(a).sales)==null?void 0:O.results)!=null&&Z.length?(u(),d("table",ze,[t("thead",Oe,[t("tr",null,[Ze,t("th",null,[t("button",{onClick:s[1]||(s[1]=i=>P("name")),class:"flex items-center gap-3"},[f(" Наименование "),t("img",{class:r(L("name")),src:S,alt:"table-arrow"},null,2)])]),t("th",null,[t("button",{onClick:s[2]||(s[2]=i=>P("sales_count")),class:"flex items-center gap-3"},[f(" Кол-во продаж "),t("img",{class:r(L("sales_count")),src:S,alt:"table-arrow"},null,2)])]),t("th",null,[t("button",{onClick:s[3]||(s[3]=i=>P("price_per_count")),class:"flex items-center gap-3"},[f(" Цена за единицу "),t("img",{class:r(L("price_per_count")),src:S,alt:"table-arrow"},null,2)])]),t("th",null,[t("button",{onClick:s[4]||(s[4]=i=>P("total")),class:"flex items-center gap-3"},[f(" Сумма "),t("img",{class:r(L("total")),src:S,alt:"table-arrow"},null,2)])]),t("th",null,[t("button",{onClick:s[5]||(s[5]=i=>P("vat")),class:"flex items-center gap-3"},[f(" НДС "),t("img",{class:r(L("vat")),src:S,alt:"table-arrow"},null,2)])]),t("th",null,[t("button",{onClick:s[6]||(s[6]=i=>P("total_with_vat")),class:"flex items-center gap-3"},[f(" Сумма с НДС "),t("img",{class:r(L("total_with_vat")),src:S,alt:"table-arrow"},null,2)])]),t("th",null,[t("button",{onClick:s[7]||(s[7]=i=>P("company_sale_to")),class:"flex items-center gap-3"},[f(" Наименование компании "),t("img",{class:r(L("company_sale_to")),src:S,alt:"table-arrow"},null,2)])]),t("th",null,[t("button",{onClick:s[8]||(s[8]=i=>P("agent")),class:"flex items-center gap-3"},[f(" Агент "),t("img",{class:r(L("agent")),src:S,alt:"table-arrow"},null,2)])])])]),t("tbody",null,[(u(!0),d(q,null,I(m(a).sales.results,(i,ae)=>(u(),d("tr",null,[t("td",null,c(m(p)*(m(v)-1)+ae+1),1),t("td",null,c(i.name),1),t("td",null,c(i.sales_count),1),t("td",null,c(i.price_per_count),1),t("td",null,c(i.total),1),t("td",null,c(i.vat),1),t("td",null,c(i.total_with_vat),1),t("td",null,c(i.company_sale_to),1),t("td",null,c(i.agent.last_name+" "+i.agent.first_name+" "+i.agent.patronymic),1)]))),256))])])):y("",!0),((E=(A=m(a).sales)==null?void 0:A.results)==null?void 0:E.length)===0?(u(),d("div",Ae," Товаров пока нет ")):y("",!0),(J=m(a).sales)!=null&&J.results?y("",!0):(u(),d("div",Ee,[Je,k(be)]))]),t("div",Ge,[k(m(He),{"page-count":m(z),"page-range":3,"margin-pages":2,"click-handler":$,"prev-text":"<","next-text":">","container-class":"pagination","page-class":"page-item","force-page":m(v)},null,8,["page-count","force-page"]),t("div",Xe,[Ye,X(t("select",{"onUpdate:modelValue":s[9]||(s[9]=i=>K(p)?p.value=i:null),onChange:ee,class:"w-fit p-2.5 rounded-md bg-[#8881] dark:bg-bgWhite text-black"},[(u(!0),d(q,null,I(m(Q),i=>(u(),d("option",{value:i},c(i),9,Qe))),256))],544),[[de,m(p)]])])])])]),m(l)?(u(),oe(he,{key:0,type:"resize",onShowModal:s[15]||(s[15]=()=>{})},{default:w(()=>[t("button",{class:"absolute top-3 right-3",onClick:D}," x "),t("div",$e,[et,t("form",{onSubmit:s[14]||(s[14]=ce(i=>{F(),l.value=!1},["prevent"])),class:"flex items-center gap-5 flex-col"},[k(j,{modelValue:m(N),"onUpdate:modelValue":s[10]||(s[10]=i=>K(N)?N.value=i:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Минимальная цена"},null,8,["modelValue"]),k(j,{modelValue:m(M),"onUpdate:modelValue":s[11]||(s[11]=i=>K(M)?M.value=i:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Максимальная цена"},null,8,["modelValue"]),k(j,{modelValue:m(B),"onUpdate:modelValue":s[12]||(s[12]=i=>K(B)?B.value=i:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Минимальное количество"},null,8,["modelValue"]),k(j,{modelValue:m(H),"onUpdate:modelValue":s[13]||(s[13]=i=>K(H)?H.value=i:null),class:"w-full bg-transparent bg-opacity-0 rounded-lg outline-none",type:"number",label:"Максимальное количество"},null,8,["modelValue"]),k(h,{class:"mt-2 !text-black dark:!text-white"},{default:w(()=>[f(" Сохранить ")]),_:1})],32)])]),_:1})):y("",!0)])}}});export{vt as default};
