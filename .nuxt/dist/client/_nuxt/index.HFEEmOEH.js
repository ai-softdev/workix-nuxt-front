import{_ as Q}from"./TheButton.vue.Durdm0Er.js";import{_ as $}from"./nuxt-link.SnOP0Svj.js";import{N as s,O as i,a3 as r,Z as n,an as k,a4 as h,J as M,a2 as R,a5 as O,$ as p,_ as o,j as ee,a as C,H as te,b as B,L as v,V as P,aa as Z,ab as le,u as g,x as N,ao as ae,P as ne,a6 as se}from"./swiper-vue.yO-n0JsZ.js";import{b as ie,c as ue}from"./entry.CcBVENWO.js";import{_ as re}from"./TheTextContent.vue.DJ99356g.js";import{_ as E}from"./TheBreadcrumbs.vue.CtpZLPGf.js";import{u as de}from"./sales.DOAw8YSL.js";import{T as oe}from"./ThePreloader.Dttt05B-.js";import{u as ce}from"./companies.eNgPn44f.js";import{u as ge}from"./auth.rl7qtudn.js";import{_ as K}from"./TheInput.vue.7qlRdbvh.js";import{_ as me}from"./TheModal.vue.CfyleZWN.js";import"./nuxt-storage.CgJyI38a.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";var fe=(c,a)=>{const e=c.__vccOpts||c;for(const[b,f]of a)e[b]=f;return e};const be={data(){return{innerValue:1}},props:{modelValue:{type:Number},pageCount:{type:Number,required:!0},initialPage:{type:Number,default:1},forcePage:{type:Number},clickHandler:{type:Function,default:()=>{}},pageRange:{type:Number,default:3},marginPages:{type:Number,default:1},prevText:{type:String,default:"Prev"},nextText:{type:String,default:"Next"},breakViewText:{type:String,default:"…"},containerClass:{type:String,default:"pagination"},pageClass:{type:String,default:"page-item"},pageLinkClass:{type:String,default:"page-link"},prevClass:{type:String,default:"page-item"},prevLinkClass:{type:String,default:"page-link"},nextClass:{type:String,default:"page-item"},nextLinkClass:{type:String,default:"page-link"},breakViewClass:{type:String},breakViewLinkClass:{type:String},activeClass:{type:String,default:"active"},disabledClass:{type:String,default:"disabled"},noLiSurround:{type:Boolean,default:!1},firstLastButton:{type:Boolean,default:!1},firstButtonText:{type:String,default:"First"},lastButtonText:{type:String,default:"Last"},hidePrevNext:{type:Boolean,default:!1}},computed:{selected:{get:function(){return this.modelValue||this.innerValue},set:function(c){this.innerValue=c}},pages:function(){let c={};if(this.pageCount<=this.pageRange)for(let a=0;a<this.pageCount;a++){let e={index:a,content:a+1,selected:a===this.selected-1};c[a]=e}else{const a=Math.floor(this.pageRange/2);let e=t=>{let m={index:t,content:t+1,selected:t===this.selected-1};c[t]=m},b=t=>{let m={disabled:!0,breakView:!0};c[t]=m};for(let t=0;t<this.marginPages;t++)e(t);let f=0;this.selected-a>0&&(f=this.selected-1-a);let l=f+this.pageRange-1;l>=this.pageCount&&(l=this.pageCount-1,f=l-this.pageRange+1);for(let t=f;t<=l&&t<=this.pageCount-1;t++)e(t);f>this.marginPages&&b(f-1),l+1<this.pageCount-this.marginPages&&b(l+1);for(let t=this.pageCount-1;t>=this.pageCount-this.marginPages;t--)e(t)}return c}},methods:{handlePageSelected(c){this.selected!==c&&(this.innerValue=c,this.$emit("update:modelValue",c),this.clickHandler(c))},prevPage(){this.selected<=1||this.handlePageSelected(this.selected-1)},nextPage(){this.selected>=this.pageCount||this.handlePageSelected(this.selected+1)},firstPageSelected(){return this.selected===1},lastPageSelected(){return this.selected===this.pageCount||this.pageCount===0},selectFirstPage(){this.selected<=1||this.handlePageSelected(1)},selectLastPage(){this.selected>=this.pageCount||this.handlePageSelected(this.pageCount)}},beforeMount(){this.innerValue=this.initialPage},beforeUpdate(){this.forcePage!==void 0&&this.forcePage!==this.selected&&(this.selected=this.forcePage)}},ve=["tabindex","innerHTML"],xe=["tabindex","innerHTML"],he=["onClick","onKeyup"],ke=["tabindex","innerHTML"],Ce=["tabindex","innerHTML"],ye=["innerHTML"],_e=["innerHTML"],Pe=["onClick","onKeyup"],pe=["innerHTML"],we=["innerHTML"];function Le(c,a,e,b,f,l){return e.noLiSurround?(s(),i("div",{key:1,class:r(e.containerClass)},[e.firstLastButton?(s(),i("a",{key:0,onClick:a[8]||(a[8]=t=>l.selectFirstPage()),onKeyup:a[9]||(a[9]=k(t=>l.selectFirstPage(),["enter"])),class:r([e.pageLinkClass,l.firstPageSelected()?e.disabledClass:""]),tabindex:"0",innerHTML:e.firstButtonText},null,42,ye)):h("",!0),l.firstPageSelected()&&e.hidePrevNext?h("",!0):(s(),i("a",{key:1,onClick:a[10]||(a[10]=t=>l.prevPage()),onKeyup:a[11]||(a[11]=k(t=>l.prevPage(),["enter"])),class:r([e.prevLinkClass,l.firstPageSelected()?e.disabledClass:""]),tabindex:"0",innerHTML:e.prevText},null,42,_e)),(s(!0),i(M,null,R(l.pages,t=>(s(),i(M,null,[t.breakView?(s(),i("a",{key:t.index,class:r([e.pageLinkClass,e.breakViewLinkClass,t.disabled?e.disabledClass:""]),tabindex:"0"},[O(c.$slots,"breakViewContent",{},()=>[p(o(e.breakViewText),1)])],2)):t.disabled?(s(),i("a",{key:t.index,class:r([e.pageLinkClass,t.selected?e.activeClass:"",e.disabledClass]),tabindex:"0"},o(t.content),3)):(s(),i("a",{key:t.index,onClick:m=>l.handlePageSelected(t.index+1),onKeyup:k(m=>l.handlePageSelected(t.index+1),["enter"]),class:r([e.pageLinkClass,t.selected?e.activeClass:""]),tabindex:"0"},o(t.content),43,Pe))],64))),256)),l.lastPageSelected()&&e.hidePrevNext?h("",!0):(s(),i("a",{key:2,onClick:a[12]||(a[12]=t=>l.nextPage()),onKeyup:a[13]||(a[13]=k(t=>l.nextPage(),["enter"])),class:r([e.nextLinkClass,l.lastPageSelected()?e.disabledClass:""]),tabindex:"0",innerHTML:e.nextText},null,42,pe)),e.firstLastButton?(s(),i("a",{key:3,onClick:a[14]||(a[14]=t=>l.selectLastPage()),onKeyup:a[15]||(a[15]=k(t=>l.selectLastPage(),["enter"])),class:r([e.pageLinkClass,l.lastPageSelected()?e.disabledClass:""]),tabindex:"0",innerHTML:e.lastButtonText},null,42,we)):h("",!0)],2)):(s(),i("ul",{key:0,class:r(e.containerClass)},[e.firstLastButton?(s(),i("li",{key:0,class:r([e.pageClass,l.firstPageSelected()?e.disabledClass:""])},[n("a",{onClick:a[0]||(a[0]=t=>l.selectFirstPage()),onKeyup:a[1]||(a[1]=k(t=>l.selectFirstPage(),["enter"])),class:r(e.pageLinkClass),tabindex:l.firstPageSelected()?-1:0,innerHTML:e.firstButtonText},null,42,ve)],2)):h("",!0),l.firstPageSelected()&&e.hidePrevNext?h("",!0):(s(),i("li",{key:1,class:r([e.prevClass,l.firstPageSelected()?e.disabledClass:""])},[n("a",{onClick:a[2]||(a[2]=t=>l.prevPage()),onKeyup:a[3]||(a[3]=k(t=>l.prevPage(),["enter"])),class:r(e.prevLinkClass),tabindex:l.firstPageSelected()?-1:0,innerHTML:e.prevText},null,42,xe)],2)),(s(!0),i(M,null,R(l.pages,t=>(s(),i("li",{key:t.index,class:r([e.pageClass,t.selected?e.activeClass:"",t.disabled?e.disabledClass:"",t.breakView?e.breakViewClass:""])},[t.breakView?(s(),i("a",{key:0,class:r([e.pageLinkClass,e.breakViewLinkClass]),tabindex:"0"},[O(c.$slots,"breakViewContent",{},()=>[p(o(e.breakViewText),1)])],2)):t.disabled?(s(),i("a",{key:1,class:r(e.pageLinkClass),tabindex:"0"},o(t.content),3)):(s(),i("a",{key:2,onClick:m=>l.handlePageSelected(t.index+1),onKeyup:k(m=>l.handlePageSelected(t.index+1),["enter"]),class:r(e.pageLinkClass),tabindex:"0"},o(t.content),43,he))],2))),128)),l.lastPageSelected()&&e.hidePrevNext?h("",!0):(s(),i("li",{key:2,class:r([e.nextClass,l.lastPageSelected()?e.disabledClass:""])},[n("a",{onClick:a[4]||(a[4]=t=>l.nextPage()),onKeyup:a[5]||(a[5]=k(t=>l.nextPage(),["enter"])),class:r(e.nextLinkClass),tabindex:l.lastPageSelected()?-1:0,innerHTML:e.nextText},null,42,ke)],2)),e.firstLastButton?(s(),i("li",{key:3,class:r([e.pageClass,l.lastPageSelected()?e.disabledClass:""])},[n("a",{onClick:a[6]||(a[6]=t=>l.selectLastPage()),onKeyup:a[7]||(a[7]=k(t=>l.selectLastPage(),["enter"])),class:r(e.pageLinkClass),tabindex:l.lastPageSelected()?-1:0,innerHTML:e.lastButtonText},null,42,Ce)],2)):h("",!0)],2))}var Se=fe(be,[["render",Le]]);const Ve={class:"flex items-center gap-x-4 max-md:mt-10 max-md:flex-col max-md:items-start max-md:gap-y-4"},Te={class:"flex items-center gap-x-4"},Ne=n("div",null,[n("svg",{width:"15px",height:"15px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[n("path",{class:"dark:stroke-white stroke-black",d:"M14 12C14 14.7614 11.7614 17 9 17H7C4.23858 17 2 14.7614 2 12C2 9.23858 4.23858 7 7 7H7.5M10 12C10 9.23858 12.2386 7 15 7H17C19.7614 7 22 9.23858 22 12C22 14.7614 19.7614 17 17 17H16.5","stroke-width":"2","stroke-linecap":"round"})])],-1),Me={class:"w-fit sales-up-table rounded-lg border mt-10 overflow-hidden"},He={class:"p-4 flex items-center gap-3"},Be={class:"w-4/12 max-md:w-full relative flex items-center"},Ke=n("div",{class:"absolute rotate-90 ml-2"},[n("svg",{class:"dark:stroke-white stroke-black",width:"25px",height:"25px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[n("path",{d:"M14.9536 14.9458L21 21M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z","stroke-width":"1.2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),Re={class:"w-full sales-table"},qe={key:0},Fe=n("thead",{class:"bg-gray-200 dark:bg-bgWhite"},[n("tr",null,[n("th",null,"№"),n("th",null,"Наименование"),n("th",null,"Кол-во продаж"),n("th",null,"Цена за единицу"),n("th",null,"Сумма"),n("th",null,"НДС"),n("th",null,"Сумма с НДС"),n("th",null,"Наименование компании"),n("th",null,"Агент")])],-1),Ue={key:1,class:"min-h-[300px] min-w-[89vw] bg-gray-200 dark:bg-bgWhite text-center flex items-center justify-center"},je={key:2,class:"relative min-h-[400px] min-w-[89vw]"},Ie=n("div",{class:"bg-black w-full h-full absolute top-0 left-0 opacity-40 rounded-lg"},null,-1),We={class:"w-full flex items-center justify-end border-t gap-4 pr-10 pb-5 pt-5 max-md:pr-3 max-md:flex-col max-md:items-end"},ze={class:"flex items-center gap-3"},De=n("p",null,"Строк на странице:",-1),Oe=["value"],Ze={class:"flex flex-col gap-5"},Ee=n("p",null," Фильтры: ",-1),ut=ee({__name:"index",setup(c){const a=ge(),e=ce(),b=ie(),f=ue(),l=de(),t=C(!1),m=C(Number(b.query.page)||1),y=C(Number(b.query.limit)||5),w=C(b.query.itemName||""),L=C(Number(b.query.min_price)||""),S=C(Number(b.query.max_price)||""),V=C(Number(b.query.min_count)||""),T=C(Number(b.query.max_count)||""),J=C([5,10,20,30,50]),H=()=>{f.push({query:{page:m.value,limit:y.value,itemName:w.value||void 0,min_price:L.value||"",max_price:S.value||"",min_count:V.value||"",max_count:T.value||""}})},A=x=>{m.value=x,H()},G=()=>{H()},X=()=>{m.value=1,H()},F=()=>{t.value=!t.value},U=C(0);return te(()=>{l.loadSalesList({page:m.value,limit:y.value,name:w.value,min_price:L.value,max_price:S.value,min_count:V.value,max_count:T.value})}),B(()=>l.sales,x=>{U.value=Math.ceil(l.sales.count/y.value)}),B(()=>b.query,x=>{m.value=Number(x.page)||1,y.value=Number(x.limit)||3,w.value=x.itemName||"",l.loadSalesList({page:m.value,limit:y.value,name:w.value,min_price:L.value,max_price:S.value,min_count:V.value,max_count:T.value})}),B(()=>a.user,x=>{var d,_;((_=(d=a==null?void 0:a.user)==null?void 0:d.role)==null?void 0:_.name_en)==="admin"&&(window.history.length>1?f.push("/base/profile"):f.push("/"))}),B(()=>e.company,x=>{var _;((_=e.company.modules)==null?void 0:_.find(q=>q.name_en==="sales"))||(window.history.length>1?f.push("/base/profile"):f.push("/"))}),(x,d)=>{var j,I,W,z,D;const _=Q,q=$;return s(),i("div",null,[v(re,null,{default:P(()=>[p(o(x.$t("Страница продаж")),1)]),_:1}),n("div",null,[n("div",Ve,[n("div",Te,[v(E,{"breadcrumb-link":"/base/profile"},{default:P(()=>[p(o(x.$t("Профиль")),1)]),_:1}),Ne,v(E,null,{default:P(()=>[p(o(x.$t("Продажи")),1)]),_:1})]),v(q,{to:"/base/sales/item-create",class:"ml-auto"},{default:P(()=>[v(_,{class:"border p-3 rounded-lg !text-black dark:!text-white"},{default:P(()=>[p(" Добавить товар ")]),_:1})]),_:1})]),n("div",Me,[n("div",He,[v(_,{onClick:F,class:"border p-3 rounded-lg !text-black dark:!text-white"},{default:P(()=>[p(" Фильтры ")]),_:1}),n("div",Be,[Ke,Z(n("input",{"onUpdate:modelValue":d[0]||(d[0]=u=>N(w)?w.value=u:null),onInput:X,type:"text",class:"w-full rounded-lg dark:bg-gray-500 outline-none pl-10 h-[50px]",placeholder:"Найти товар..."},null,544),[[le,g(w)]])])]),n("div",Re,[(I=(j=g(l).sales)==null?void 0:j.results)!=null&&I.length?(s(),i("table",qe,[Fe,n("tbody",null,[(s(!0),i(M,null,R(g(l).sales.results,(u,Y)=>(s(),i("tr",null,[n("td",null,o(g(y)*(g(m)-1)+Y+1),1),n("td",null,o(u.name),1),n("td",null,o(u.sales_count),1),n("td",null,o(u.price_per_count),1),n("td",null,o(u.total),1),n("td",null,o(u.vat),1),n("td",null,o(u.total_with_vat),1),n("td",null,o(u.company_sale_to),1),n("td",null,o(u.agent.last_name+" "+u.agent.first_name+" "+u.agent.patronymic),1)]))),256))])])):h("",!0),((z=(W=g(l).sales)==null?void 0:W.results)==null?void 0:z.length)===0?(s(),i("div",Ue," Товаров пока нет ")):h("",!0),(D=g(l).sales)!=null&&D.results?h("",!0):(s(),i("div",je,[Ie,v(oe)]))]),n("div",We,[v(g(Se),{"page-count":g(U),"page-range":3,"margin-pages":2,"click-handler":A,"prev-text":"<","next-text":">","container-class":"pagination","page-class":"page-item","force-page":g(m)},null,8,["page-count","force-page"]),n("div",ze,[De,Z(n("select",{"onUpdate:modelValue":d[1]||(d[1]=u=>N(y)?y.value=u:null),onChange:G,class:"w-fit p-2.5 rounded-md bg-[#8881] dark:bg-bgWhite text-black"},[(s(!0),i(M,null,R(g(J),u=>(s(),i("option",{value:u},o(u),9,Oe))),256))],544),[[ae,g(y)]])])])])]),g(t)?(s(),ne(me,{key:0,type:"resize",onShowModal:d[7]||(d[7]=()=>{})},{default:P(()=>[n("button",{class:"absolute top-3 right-3",onClick:F}," x "),n("div",Ze,[Ee,n("form",{onSubmit:d[6]||(d[6]=se(u=>{H(),t.value=!1},["prevent"])),class:"flex items-center gap-5 flex-col"},[v(K,{modelValue:g(L),"onUpdate:modelValue":d[2]||(d[2]=u=>N(L)?L.value=u:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Минимальная цена"},null,8,["modelValue"]),v(K,{modelValue:g(S),"onUpdate:modelValue":d[3]||(d[3]=u=>N(S)?S.value=u:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Максимальная цена"},null,8,["modelValue"]),v(K,{modelValue:g(V),"onUpdate:modelValue":d[4]||(d[4]=u=>N(V)?V.value=u:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Минимальное количество"},null,8,["modelValue"]),v(K,{modelValue:g(T),"onUpdate:modelValue":d[5]||(d[5]=u=>N(T)?T.value=u:null),class:"w-full bg-transparent bg-opacity-0 rounded-lg outline-none",type:"number",label:"Максимальное количество"},null,8,["modelValue"]),v(_,{class:"mt-2 !text-black dark:!text-white"},{default:P(()=>[p(" Сохранить ")]),_:1})],32)])]),_:1})):h("",!0)])}}});export{ut as default};
