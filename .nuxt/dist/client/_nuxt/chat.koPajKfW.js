import{d as l}from"./entry.Sth6lCst.js";import{a,n as s}from"./nuxt-storage.CgJyI38a.js";const c=l("chat",{state:()=>({chatList:{},userChat:{messages:[],name:"",description:""},messageLimit:null,messagesMakeRead:[],messageUpdate:{},messageReplied:{},messageText:"",searchElem:"",messageForwarded:{},showForwardInfo:!1,checkboxForwarded:!0,showSendWindow:!1,messagePinned:{},arrayPin:[],activeChatNav:!0,windowWidth:0,showPinnedWindow:!1,showGroupCreate:!1,showGroupCreateChoice:!1,showVoiceInfo:!1,showChatInfo:!1,showSettingChat:!1,showChatChangeInfo:!1,showChatChangeInfoModal:!1,showChatCropper:!1,showImageChange:!1,chatChangeInfo:{name:"",img:"",description:""},showChangeWindowChat:!1,showChatGallery:!1,showDragInfo:!1,showUploadWindow:!1,updateChatName:"",updateDescription:"",voiceTimer:0,recordingVoice:!1,isGroup:!1,clickerTimeout:null,flag:!0,displayChat:"all",file:"",src:"",signature:"",fileSizeInfo:!1,fileReadInfo:!1,fileChecked:!1,fileUpload:null,results:{coordinates:null,image:null},focusInput:null}),getters:{get_chat_list:e=>e.chatList,get_user_chat:e=>e.userChat,get_pinned_list:e=>e.arrayPin},actions:{async loadChatList(e){await a.get(`chat/chat-list?page=${e.page}&limit=${e.limit}`,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(t=>{this.chatList=t.data})},async loadUserChat(e){await a.get(`chat/${e.id}?limit=${e.limit}&page=${e.page}`,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(t=>{if(this.messageLimit=t.data.messages.length,t.data.messages){this.userChat=t.data;let i=t.data.messages.reverse(),r=[...i];i=i.map(o=>new Date(o.created_at).toLocaleDateString()),i=[...new Set(i)];let h=i.map(o=>({messages:r.filter(n=>new Date(n.created_at).toLocaleDateString()==o),date:o}));this.userChat.messages=h}})},async loadPinnedList(e){await a.get(`chat/message/pinned-list/${e.id}`,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(t=>{this.arrayPin=t.data})},async chatUpdate(e){let t=new FormData;this.updateChatName!==this.userChat.name&&t.set("name",e.update.name),this.updateDescription!==this.userChat.description&&t.set("description",e.update.description),this.fileUpload&&t.append("photo",e.update.photo,"image.webp"),await a.patch(`chat/update/${e.id}`,t,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}})},async chatDelete(e){await a.delete(`chat/delete/${e.id}`,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(t=>{})},async createMessage(e){let t=new FormData;!this.messageForwarded.id&&!this.file?t.set("text",e.text):!this.signature&&!this.messageForwarded.id?t.set("file",e.file):this.signature&&this.file?(t.set("text",e.text),t.set("file",e.file)):(t.set("text",e.text),t.set("message_id",e.message_id)),await a.post(`chat/message/create/${e.id}`,t,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(i=>{this.messageForwarded={id:null}})},async updateMessage(e){await a.patch(`chat/message/update/${e.id}`,{text:e.text},{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(t=>{})},async deleteMessage(e){await a.delete(`chat/message/delete/${e.id}`,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(t=>{})},async createChatUser(e){let t=new FormData;this.isGroup?(t.set("name",e.name),t.set("users",e.users),typeof e.photo!="string"&&t.set("photo",e.photo)):t.set("user_id",e.user_id),await a.post("chat/create",t,{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(i=>{this.loadChatList()})},async makeRead(e){await a.post("chat/message/make-read",{messages:e.messages},{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}}).then(t=>{this.loadChatList()})},async makePinned(e){await a.post("chat/message/make-pinned",{messages:e.messages},{headers:{Authorization:`Bearer ${s.localStorage.getData("token")}`}})}}});export{c as u};
