import{o as r,c as d,k as te,l as b,h as s,j as S,w as h,d as D,t as a,i as v,a as e,b as _,x as se,E as B,G as le,F as q,r as j,ae as z,g as Y,m as oe,q as ae,A as X,s as Z,az as ne,z as re,n as M,H as ie}from"./entry.BZGj2_QE.js";import{_ as de,a as ue}from"./password.DdJ5dBoj.js";import{_ as T}from"./TheButton.vue.CfQsQbrj.js";import{_ as k}from"./TheInput.vue.CDBIiN4b.js";import{_ as me}from"./TheModal.vue.BmiMYGjH.js";import{_ as ce}from"./TheTextContent.vue.AymrMYI2.js";import{_ as pe}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{u as Q}from"./users.w_XvSnP9.js";import{u as ee}from"./companies.C24PrRp1.js";import{u as P}from"./auth.CsVxvdSr.js";import"./vue-datepicker.DeX0hy3j.js";import{_ as _e}from"./nuxt-link.C5n4ipTb.js";import{_ as fe}from"./TheSearch.vue.Da8vBAHN.js";import{P as ge}from"./vuejs-paginate-next.es.BT0GwXnA.js";import{u as he}from"./index.CPkfy7ml.js";import"./nuxt-storage.B0R7N1yK.js";const xe=""+globalThis.__publicAssetsURL("icons/email.svg"),we={},be={class:"flex max-lg:flex-wrap justify-center gap-x-10 my-10 mx-auto w-full"};function ve(i,c){return r(),d("div",be,[te(i.$slots,"default")])}const N=pe(we,[["render",ve]]),ye={class:"p-6 !pb-0"},ke={class:"grid grid-cols-2 gap-4 mt-8 pb-6 border-b mb-6"},$e={class:"w-full max-lg:w-full"},Ue={class:"w-full max-lg:w-full"},Ce={class:"w-full max-lg:w-full"},Ve={class:"w-full max-lg:w-full flex flex-col"},Le={class:"text-md font-medium dark:text-white"},Ne={class:"grid grid-cols-2 gap-4"},Se={class:"w-full"},qe={class:"text-md font-medium dark:text-white flex items-center gap-2"},je=e("img",{src:xe,alt:"email"},null,-1),Ie={class:"w-full flex flex-col"},De={class:"text-md font-medium dark:text-white flex items-center gap-2"},Me=e("img",{src:de,alt:"phone"},null,-1),Be={class:"w-full"},Pe={class:"text-md font-medium dark:text-white flex items-center gap-2"},Ae=e("img",{src:ue,alt:"password"},null,-1),Re={class:"w-6/12 flex flex-col max-lg:w-full"},Fe={key:0,class:"mt-4"},Ge=["src"],Te={class:"text-md font-medium dark:text-white"},ze={class:"cursor-pointer bg-whiteSmoke hover:bg-gray-100 rounded-lg border-dashed border p-4 transition-all mt-2"},Ee={class:"w-6/12 max-lg:w-full relative"},We={class:"text-md dark:text-white font-medium"},Oe={key:0,class:"absolute z-10 bg-white dark:bg-gray-800 w-full rounded-lg mt-1 border border-gray-300 dark:border-gray-600 shadow-md max-h-40 overflow-y-auto"},He=["onMousedown"],Je={key:0,class:"w-6/12 max-lg:w-full"},Ke={class:"text-md dark:text-white font-medium"},Xe=["value"],Ye={class:"w-6/12 max-lg:w-full"},Ze={class:"text-md dark:text-white font-medium"},Qe=["disabled"],et=["value"],tt={__name:"UserCreate",props:{showCreateUser:{type:Boolean,default:!1}},setup(i){const c=P(),u=ee(),f=Q(),x=b(null),l=b({email:"",first_name:"",last_name:"",patronymic:"",password:"",phone:"",photo:"",position:"",head_user_id:"",date_of_birth:new Date().toDateString(),company_id:0,department_id:0,department:{},role_id:0,permissions:{}});function y(){f.loadPositionList(),f.loadUserList(),f.loadUserCreateList({page:1,limit:1e3}),u.loadDepartmentList()}function I(){var n;(n=l.value.department)!=null&&n.id&&(l.value.department_id=l.value.department.id),f.createAdmin(l.value),l.value={email:"",first_name:"",last_name:"",patronymic:"",password:"",phone:"",photo:"",position:"",head_user_id:"",date_of_birth:new Date().toDateString(),company_id:0,department_id:0,department:{},role_id:0,permissions:{}}}function A(){var n;(n=l.value.department)!=null&&n.id&&(l.value.department_id=l.value.department.id),f.createUser(l.value),l.value={email:"",first_name:"",last_name:"",patronymic:"",password:"",phone:"",photo:"",position:"",head_user_id:"",date_of_birth:new Date().toDateString(),company_id:0,department_id:0,department:{},role_id:0,permissions:{}}}const m=b(!1),$=b([]),R=()=>{l.value.position?$.value=f.get_position_list.filter(n=>n.name.toLowerCase().includes(l.value.position.toLowerCase())):$.value=f.get_position_list,m.value=!0},F=n=>{l.value.position=n,m.value=!1};function C(n){const t=n.target.files[0];t&&t.type.startsWith("image/")?(l.value.photo=t,x.value=URL.createObjectURL(t)):(l.value.photo=null,x.value=null)}const G=()=>{setTimeout(()=>{m.value=!1},200)};return(n,t)=>(r(),d("div",null,[s(c).current_user.permissions?(r(),S(T,{key:0,class:"max-md:w-full w-full text-sm",type:"golden",onClick:t[0]||(t[0]=o=>{var p;i.showCreateUser=!0,y(),((p=s(c).user.role)==null?void 0:p.name_en)==="admin"&&s(u).loadCompanyList({page:1,limit:1e3,query:""})})},{default:h(()=>[D(" + "+a(n.$t("Создать пользователя")),1)]),_:1})):v("",!0),i.showCreateUser?(r(),S(me,{key:1,onShowModal:t[15]||(t[15]=o=>{i.showCreateUser=!i.showCreateUser,i.showCreateUser?l.value={}:l.value={}}),"show-create-user":i.showCreateUser},{default:h(()=>[e("div",ye,[_(ce,{class:"!text-start font-bold !text-3xl"},{default:h(()=>[D(a(n.$t("Создание пользователя")),1)]),_:1}),e("form",{enctype:"multipart/form-data",onSubmit:t[14]||(t[14]=se(o=>{var p;return((p=s(c).user.role)==null?void 0:p.name_en)==="admin"?I():A()},["prevent"]))},[e("div",ke,[e("div",$e,[_(k,{type:"text",label:n.$t("Имя"),modelValue:s(l).first_name,"onUpdate:modelValue":t[1]||(t[1]=o=>s(l).first_name=o)},null,8,["label","modelValue"])]),e("div",Ue,[_(k,{type:"text",label:n.$t("Фамилия"),modelValue:s(l).last_name,"onUpdate:modelValue":t[2]||(t[2]=o=>s(l).last_name=o)},null,8,["label","modelValue"])]),e("div",Ce,[_(k,{type:"text",label:n.$t("Отчество"),modelValue:s(l).patronymic,"onUpdate:modelValue":t[3]||(t[3]=o=>s(l).patronymic=o)},null,8,["label","modelValue"])]),e("div",Ve,[e("p",Le,a(n.$t("Дата рождения")),1),_(k,{type:"date",class:"w-full rounded-lg outline-1",id:"date",placeholder:"Выбрать",modelValue:s(l).date_of_birth,"onUpdate:modelValue":t[4]||(t[4]=o=>s(l).date_of_birth=o)},null,8,["modelValue"])])]),e("div",Ne,[e("div",Se,[e("div",qe,[je,e("p",null,a(n.$t("Почта")),1)]),_(k,{type:"text",modelValue:s(l).email,"onUpdate:modelValue":t[5]||(t[5]=o=>s(l).email=o)},null,8,["modelValue"])]),e("div",Ie,[e("div",De,[Me,e("p",null,a(n.$t("Номер телефона")),1)]),_(k,{type:"tel",class:"w-full",id:"phone",placeholder:"+998 (__) ___-__-__",modelValue:s(l).phone,"onUpdate:modelValue":t[6]||(t[6]=o=>s(l).phone=o)},null,8,["modelValue"])]),e("div",Be,[e("div",Pe,[Ae,e("p",null,a(n.$t("Пароль")),1)]),_(k,{type:"password",modelValue:s(l).password,"onUpdate:modelValue":t[7]||(t[7]=o=>s(l).password=o)},null,8,["modelValue"])])]),_(N,null,{default:h(()=>[e("div",Re,[s(x)?(r(),d("div",Fe,[e("img",{src:s(x),alt:"Превью",class:"mx-auto w-32 h-32 object-cover rounded-lg shadow-icons"},null,8,Ge)])):v("",!0),e("p",Te,a(n.$t("Фото")),1),e("label",ze,[e("input",{type:"file",name:"file",label:"Фото",class:"dark:text-white cursor-pointer",onInput:C},null,32)])])]),_:1}),_(N,null,{default:h(()=>[e("div",Ee,[e("p",We,a(n.$t("Должность")),1),B(e("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=o=>s(l).position=o),class:"dark:text-white w-full dark:bg-gray-300 bg-whiteSmoke rounded-full p-2 dark:border-none text-black border focus:outline-golden mt-2 outline-1",onFocus:t[9]||(t[9]=o=>m.value=!0),onBlur:G,onInput:R},null,544),[[le,s(l).position]]),s(m)&&s($).length?(r(),d("ul",Oe,[(r(!0),d(q,null,j(s($),o=>(r(),d("li",{key:o.name,onMousedown:p=>F(o.name),class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer"},a(o.name),41,He))),128))])):v("",!0)])]),_:1}),_(N,null,{default:h(()=>{var o;return[s(c).user.role.name_en==="company_admin"?(r(),d("div",Je,[e("p",Ke,a(n.$t("Отдел")),1),B(e("select",{type:"text","onUpdate:modelValue":t[10]||(t[10]=p=>s(l).department=p),class:"dark:text-white w-full dark:bg-gray-300 bg-whiteSmoke rounded-full p-2 dark:border-none text-black border focus:outline-golden mt-2 outline-1"},[(r(!0),d(q,null,j((o=s(u))==null?void 0:o.get_all_department.results,p=>(r(),d("option",{value:p},a(p.name),9,Xe))),256))],512),[[z,s(l).department]])])):v("",!0)]}),_:1}),_(N,null,{default:h(()=>{var o,p,U,V,L;return[e("div",Ye,[e("p",Ze,a(n.$t("Руководитель")),1),(o=s(f))!=null&&o.get_position_list?v("",!0):(r(),S(k,{key:0,type:"text",name:"text",label:"Руководитель",class:"dark:text-white cursor-pointer",modelValue:s(l).head_user_id,"onUpdate:modelValue":t[11]||(t[11]=g=>s(l).head_user_id=g)},null,8,["modelValue"])),B(e("select",{"onUpdate:modelValue":t[12]||(t[12]=g=>s(l).head_user_id=g),class:"dark:text-white w-full dark:bg-gray-300 bg-whiteSmoke rounded-full p-2 dark:border-none text-black border focus:outline-golden mt-2 outline-1",disabled:!((U=(p=s(f))==null?void 0:p.get_user_create_list)!=null&&U.results)},[(r(!0),d(q,null,j((L=(V=s(f))==null?void 0:V.usersForCreate)==null?void 0:L.results,g=>(r(),d("option",{key:g.id,value:g.id},a(g.first_name)+" "+a(g.last_name),9,et))),128))],8,Qe),[[z,s(l).head_user_id]])])]}),_:1}),_(N,null,{default:h(()=>[_(T,{class:"w-4/12 rounded-full flex items-center justify-center !text-black hover:!bg-gray-200 gap-3 py-2 !bg-porcelain !border transition-all ease-in-out duration-300",t:"button",onClick:t[13]||(t[13]=o=>i.showCreateUser=!1)},{default:h(()=>[D(a(n.$t("Отменить")),1)]),_:1}),_(T,{class:"w-4/12 rounded-full flex items-center justify-center !text-black hover:!shadow-golden gap-3 py-2 !bg-golden !border transition-all ease-in-out duration-300",t:"submit",type:"success"},{default:h(()=>[D(a(n.$t("Создать")),1)]),_:1})]),_:1})],32)])]),_:1},8,["show-create-user"])):v("",!0)]))}},st=tt,lt={class:"flex items-center gap-x-2 pb-4 border-b"},ot={class:"flex items-center justify-center rounded-md px-1 w-[33px] h-[33px] shadow-md"},at=["src"],nt={class:"font-bold text-sm break-words"},rt={class:"mt-4 flex flex-col gap-2"},it={key:0,class:"flex items-start justify-between gap-10 min-h-10"},dt={class:"font-bold"},ut={class:"text-mediumGray text-right"},mt={key:1,class:"flex items-start justify-between gap-10 min-h-10"},ct={class:"font-bold"},pt={class:"text-mediumGray text-right"},_t={class:"flex items-center justify-between gap-10 mt-2"},ft={class:"font-bold"},gt={class:"text-mediumGray"},ht=Y({__name:"UserContentList",props:{userItem:{type:Object,required:!0}},setup(i){const c=P();return(u,f)=>{const x=_e;return r(),S(x,{to:`/base/users/${i.userItem.id}`,class:"transition-all bg-white shadow-cards hover:shadow-hoverCards border border-white hover:border-golden dark:border-none dark:shadow-none dark:bg-gray-700 dark:hover:bg-gray-800 py-6 px-5 rounded-3xl items-center"},{default:h(()=>[e("div",lt,[e("div",ot,[e("img",{class:"w-[22px] h-[22px] rounded-full",src:i.userItem.photo,alt:"logo"},null,8,at)]),e("h2",nt,a(i.userItem.first_name+" "+i.userItem.last_name),1)]),e("div",rt,[s(c).user.role_en==="admin"?(r(),d("div",it,[e("p",dt,a(u.$t("Роль | Должность"))+": ",1),e("p",ut," ("+a(i.userItem.role)+") ",1)])):(r(),d("div",mt,[e("p",ct,a(u.$t("Должность"))+": ",1),e("p",pt,a(i.userItem.position),1)]))]),e("div",_t,[e("p",ft,a(u.$t("Дата регистрации"))+": ",1),e("p",gt,a(new Date(i.userItem.created_at).toLocaleString().slice(0,10)),1)])]),_:1},8,["to"])}}}),xt={class:"flex flex-col gap-4"},wt={class:"text-lg flex gap-x-10"},bt={key:0,class:"dark:text-white text-3xl font-bold"},vt={key:1,class:"dark:text-white text-3xl font-bold"},yt={key:0,class:"flex gap-x-10"},kt={class:"w-full mt-4 max-[636px]:mt-0"},$t={class:"flex items-center justify-between max-[636px]:flex-col gap-x-10 max-lg:flex-wrap max-md:justify-center"},Ut={class:"text-mediumGray w-5/12 max-[636px]:w-full"},Ct={class:"w-5/12 max-[636px]:w-full max-[636px]:mt-5 flex items-center gap-3 h-10"},Vt={class:"mt-8 grid grid-cols-4 max-[1350px]:grid-cols-2 max-[636px]:grid-cols-1 gap-5 max-md:mt-10"},Lt={key:0},Nt={class:"text-center"},St={class:"w-full flex items-center justify-end border-t gap-4 pr-10 pb-5 pt-5 max-md:pr-3 max-md:flex-col max-md:items-end"},qt={class:"flex items-center gap-3"},jt=e("p",null,"Строк на странице:",-1),It=["value"],Dt={__name:"UserContent",props:{userChecked:{type:String,default:"user-list"},showUserInfo:{type:Boolean,default:!1}},setup(i){const c=P(),u=Q();b("");const f=oe(),x=ae(),l=b(Number(f.query.page)||1),y=b(Number(f.query.limit)||10),I=b(0),A=b([5,10,20,30,50]),m={page:1,limit:10,query:b(""),user_type:"user-list"},$=t=>{l.value=t,C()},R=()=>{C()},F=()=>{l.value=1,C()},C=()=>{x.push({query:{page:l.value,limit:y.value,itemName:m.query.value||void 0}})};X(()=>f.query,t=>{l.value=Number(t.page)||1,y.value=Number(t.limit)||10,m.query.value=t.itemName||"",u.loadUserList({page:l.value,limit:y.value,query:m.query.value})}),X(()=>u.user,t=>{I.value=Math.ceil(u.user.count/y.value)}),Z(()=>{ne({params:{page:m.page}})});const G=ee();re(()=>{var t,o;console.log(G.company,c.user),((t=c.user.role)==null?void 0:t.name_en)==="admin"?u.loadAdminList({page:m.page,limit:m.limit,query:m.query.value}):((o=c.user.role)==null?void 0:o.name_en)==="company_admin"&&u.loadUserList({page:m.page,limit:m.limit,query:m.query.value})});const n=t=>{var p;return((p=c.user.permissions)==null?void 0:p.find(U=>U.name_en===t))!==void 0};return(t,o)=>{var V,L,g,E,W,O,H,J,K;const p=st,U=ht;return r(),d("div",xt,[e("div",{class:M(["flex items-center justify-between gap-10 max-[768px]:flex-col max-[768px]:items-start",{"flex items-center justify-between":["company_admin","admin"].includes((V=s(c).user.role)==null?void 0:V.name_en)}])},[e("div",wt,[((L=s(c).user.role)==null?void 0:L.name_en)==="admin"?(r(),d("p",bt,a(t.$t("Список администраторов компании")),1)):(r(),d("p",vt,a(t.$t("Список всех пользователей компании")),1))]),n("user.create")?(r(),d("div",{key:0,class:M({"flex items-center justify-evenly":((g=s(c).user.role)==null?void 0:g.name_en)==="admin","w-2/12 max-lg:w-4/12 max-sm:w-full max-sm:mb-6 max-sm:mx-auto":s(c).user.role_en!=="admin"})},[((E=s(c))==null?void 0:E.user.role)==="Администратор сайта"?(r(),d("div",yt,[e("button",{class:M(["p-2 rounded-xl dark:text-white tracking-widest font-bold",{"bg-blueDarkSemiLight text-white":i.userChecked==="user-list"}]),onClick:o[0]||(o[0]=w=>{i.userChecked="user-list",s(u).loadUserList({page:s(u).page,limit:m.limit,user_type:i.userChecked})})},a(t.$t("Все пользователи")),3),e("button",{class:M(["p-2 rounded-xl dark:text-white tracking-widest font-bold",{"bg-blueDarkSemiLight text-white":i.userChecked==="admin-list"}]),onClick:o[1]||(o[1]=w=>{i.userChecked="admin-list",s(u).loadAdminList({page:s(u).page,limit:m.limit})})},a(t.$t("Администраторы компаний")),3)])):v("",!0),_(p)],2)):v("",!0)],2),e("div",kt,[e("div",$t,[e("p",Ut,a(t.$t("Данная страница хранит информацию о пользователях данной платформы")),1),e("div",Ct,[_(fe,{class:"w-full","model-value":m.query,"onUpdate:modelValue":o[2]||(o[2]=w=>m.query=w),onSearch:F},null,8,["model-value"])])]),e("div",Vt,[((W=s(u))==null?void 0:W.get_user_list.count)>0?(r(!0),d(q,{key:0},j((O=s(u))==null?void 0:O.get_user_list.results,w=>(r(),S(U,{"user-item":w,class:"max-md:w-full"},null,8,["user-item"]))),256)):v("",!0)]),(K=(J=(H=s(u))==null?void 0:H.get_user_list)==null?void 0:J.results)!=null&&K.length?v("",!0):(r(),d("div",Lt,[e("p",Nt,a(t.$t("По вашему запросу никого не найдено.")),1)]))]),e("div",St,[_(s(ge),{"page-count":s(I),"page-range":3,"margin-pages":2,"click-handler":$,"prev-text":"<","next-text":">","container-class":"pagination","page-class":"page-item","force-page":s(l)},null,8,["page-count","force-page"]),e("div",qt,[jt,B(e("select",{"onUpdate:modelValue":o[3]||(o[3]=w=>ie(y)?y.value=w:null),onChange:R,class:"w-fit p-2.5 rounded-md border bg-white dark:bg-bgWhite text-black"},[(r(!0),d(q,null,j(s(A),w=>(r(),d("option",{value:w},a(w),9,It))),256))],544),[[z,s(y)]])])])])}}},Mt=Dt,Zt=Y({__name:"index",setup(i){const c=P();return he({title:"Пользователи",description:"Список пользователей данной платформы"}),Z(()=>{c.loadCurrentUserWorker()}),(u,f)=>{const x=Mt;return r(),d("div",null,[_(x)])}}});export{Zt as default};
