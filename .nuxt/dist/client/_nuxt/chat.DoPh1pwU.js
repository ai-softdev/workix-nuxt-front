import{c as F,b as L,e as K,_ as Q}from"./entry.OZksbJ94.js";import{_ as X}from"./client-only.Bgndt8mu.js";import{u as Y}from"./index.CYULIqW7.js";import{u as G}from"./users.IekKF1kV.js";import{u as k}from"./chat.DIOmPi1E.js";import{u as S}from"./auth.D6Ce92wc.js";import{N as n,O as p,Z as a,a5 as E,j as b,L as f,V as h,a4 as g,u as e,$ as w,_ as m,a as M,H as Z,P as y,M as ee,a2 as x,aa as P,ab as A,x as te,J as U,a3 as z,n as O,a6 as se,I as ae,b as I}from"./swiper-vue.D8OdYOtj.js";import{_ as J}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{_ as $}from"./TheButton.vue.Crm8UpP8.js";import{_ as R}from"./TheModal.vue.B87978z5.js";import{_ as le}from"./TheFileInput.vue.DV4_GWtM.js";import{h as re,_ as oe,a as ne,m as ie,f as de}from"./TheChatAvatar.vue.D_734nFh.js";import{l as ce,n as ue}from"./nuxt-storage.jjXK-e5k.js";import{_ as q}from"./nuxt-link.B8GQQyVd.js";import{T as B}from"./TheSceleton.vkxV5_CD.js";import{u as pe}from"./companies.C_qw9x8E.js";import"./ElemUI.CaMe4eMI.js";import"./documents.CBgzVLdS.js";const fe={},me={class:"p-2 cursor-pointer flex flex-col items-center"},he={class:"text-[12px] text-center tracking-widest"};function ge(_,l){return n(),p("div",me,[a("div",null,[E(_.$slots,"ChatNavHeaderSvg")]),a("p",he,[E(_.$slots,"ChatNavHeaderText")])])}const T=J(fe,[["render",ge]]),_e={class:"select-none"},xe=a("path",{d:"M22.5,10.05v10.5l-2.86-2.87H11.05a3.81,3.81,0,0,1-3.7-2.86,3.77,3.77,0,0,1-.12-1V10.05a3.82,3.82,0,0,1,3.82-3.82h7.63A3.82,3.82,0,0,1,22.5,10.05Z"},null,-1),Ce=a("path",{d:"M16.77,5.27v1H11.05a3.82,3.82,0,0,0-3.82,3.82v2.86H4.36L1.5,15.77V5.27A3.82,3.82,0,0,1,5.32,1.45H13A3.82,3.82,0,0,1,16.77,5.27Z"},null,-1),we=[xe,Ce],ve=a("path",{opacity:"0.5",d:"M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z"},null,-1),ye=a("path",{d:"M16.807 19.0112C15.4398 19.9504 13.7841 20.5 12 20.5C10.2159 20.5 8.56023 19.9503 7.193 19.0111C6.58915 18.5963 6.33109 17.8062 6.68219 17.1632C7.41001 15.8302 8.90973 15 12 15C15.0903 15 16.59 15.8303 17.3178 17.1632C17.6689 17.8062 17.4108 18.5964 16.807 19.0112Z"},null,-1),$e=a("path",{d:"M12 12C13.6569 12 15 10.6569 15 9C15 7.34315 13.6569 6 12 6C10.3432 6 9.00004 7.34315 9.00004 9C9.00004 10.6569 10.3432 12 12 12Z"},null,-1),ke=[ve,ye,$e],be=a("g",null,[a("g",null,[a("path",{d:`M382.167,150.945c9.702,10.875,16.557,24.306,20.381,39.921c3.629,14.822,4.44,31.308,2.414,49.006\r
                  c-0.751,6.546-1.861,13.96-3.479,21.802c12.532,12.135,28.95,19.839,50.296,19.838c59.22-0.005,80.529-59.3,86.105-108.006\r
                  c6.872-60.004-21.498-105.163-86.105-105.163c-50.698,0-79.079,27.82-85.628,68.798\r
                  C372.076,141.062,377.449,145.655,382.167,150.945z`}),a("path",{d:`M611.973,422.704c-0.645-18.899-2.861-37.887-6.161-56.495c-3.992-22.539-9.08-55.585-28.759-70.275\r
                  c-11.38-8.491-26.117-11.278-39.143-16.398c-6.343-2.492-12.024-4.967-17.354-7.784c-17.995,19.734-41.459,30.055-68.782,30.057\r
                  c-21.261,0-40.172-6.281-56.001-18.358c-3.644,11.272-8.522,22.623-15.044,32.994c5.728,3.449,11.923,6.204,19.451,9.162\r
                  c3.332,1.31,6.99,2.506,10.864,3.771c10.472,3.422,22.339,7.301,32.994,15.255c25.329,18.907,31.564,54.336,36.117,80.207\r
                  l0.49,2.792c2.355,13.266,4.084,26.299,5.197,38.961c20.215-2.071,40.327-5.61,60.047-9.774\r
                  c15.941-3.365,31.774-7.471,47.109-13.003C605.247,439.397,612.476,437.343,611.973,422.704z`}),a("path",{d:`M160.216,281.511c21.345,0.002,37.762-7.703,50.295-19.838c-1.618-7.841-2.728-15.256-3.479-21.802\r
                  c-2.026-17.697-1.214-34.184,2.414-49.006c3.823-15.614,10.679-29.046,20.381-39.921c4.718-5.291,10.09-9.884,16.014-13.805\r
                  c-6.549-40.978-34.93-68.798-85.628-68.798c-64.606,0-92.977,45.16-86.106,105.163\r
                  C79.687,222.212,100.996,281.507,160.216,281.511z`}),a("path",{d:`M167.957,344.634c10.655-7.954,22.524-11.833,32.994-15.255c3.875-1.265,7.531-2.461,10.864-3.771\r
                  c7.528-2.957,13.725-5.711,19.451-9.162c-6.52-10.369-11.4-21.722-15.043-32.994c-15.829,12.077-34.741,18.358-56.001,18.358\r
                  c-27.322-0.001-50.788-10.324-68.782-30.057c-5.329,2.817-11.012,5.291-17.354,7.784c-13.026,5.12-27.763,7.907-39.143,16.398\r
                  c-19.678,14.691-24.767,47.735-28.759,70.275c-3.3,18.607-5.516,37.595-6.161,56.495c-0.502,14.64,6.726,16.693,18.974,21.112\r
                  c15.334,5.531,31.17,9.637,47.109,13.003c19.72,4.165,39.833,7.704,60.047,9.774c1.112-12.662,2.841-25.693,5.197-38.961\r
                  l0.49-2.792C136.394,398.971,142.628,363.541,167.957,344.634z`}),a("path",{d:`M470.351,429.405l-0.493-2.805c-4.258-24.197-10.091-57.334-32.191-73.832c-9.321-6.957-19.872-10.404-30.078-13.74\r
                  c-4.019-1.313-7.812-2.554-11.427-3.974c-5.269-2.07-10.016-4.097-14.464-6.338c-18.684,24.932-44.58,38.059-75.383,38.062\r
                  c-30.795,0-56.687-13.128-75.371-38.062c-4.449,2.243-9.196,4.269-14.467,6.34c-3.61,1.418-7.406,2.659-11.424,3.972\r
                  c-10.207,3.335-20.761,6.784-30.079,13.74c-22.107,16.5-27.936,49.645-32.193,73.846l-0.493,2.795\r
                  c-3.557,20.086-5.68,39.572-6.308,57.914c-0.737,21.519,12.62,26.316,24.403,30.55l1.269,0.457\r
                  c14.17,5.112,30.021,9.492,48.457,13.388c37.646,7.946,68.197,11.74,96.138,11.938h0.072h0.072\r
                  c27.946-0.199,58.495-3.992,96.135-11.938c18.439-3.894,34.289-8.274,48.453-13.387l1.268-0.456\r
                  c11.786-4.233,25.147-9.029,24.41-30.553C476.03,468.931,473.906,449.447,470.351,429.405z`}),a("path",{d:`M221.005,243.009c5.577,48.709,26.883,108.009,86.103,108.006s80.529-59.297,86.106-108.006\r
                  c6.871-60.002-21.503-105.16-86.106-105.16C242.515,137.847,214.123,183.002,221.005,243.009z`})])],-1),Ne=[be],Me=b({__name:"ChatNavHeaderElem",props:{activeNav:{type:Boolean,default:!1}},setup(_){const l=k();return(i,o)=>(n(),p("div",_e,[a("div",{class:g(["flex items-center relative justify-between transition-all duration-200 after:w-[60px] after:h-[5px] after:bg-semiCyan after:rounded-t-full after:transition-all after:absolute after:bottom-0",{"after:left-[0%]":e(l).displayChat==="all","after:left-[36%] max-md:after:left-[45%] max-[625px]:after:left-[43%] max-[500px]:after:left-[42%] max-[488px]:after:left-[41.5%] max-[414px]:after:left-[40%] max-[385px]:after:left-[38%]":e(l).displayChat==="users","after:left-[75%] max-md:after:left-[91%] max-[700px]:after:left-[89%] max-[580px]:after:left-[87%] max-[500px]:after:left-[85%] max-[500px]:after:left-[83%] max-[390px]:after:left-[81%] max-[345px]:after:left-[79%]":e(l).displayChat==="groups"}])},[f(T,{class:g({"text-semiCyan":e(l).displayChat==="all"}),onClick:o[0]||(o[0]=s=>e(l).displayChat="all")},{ChatNavHeaderSvg:h(()=>[(n(),p("svg",{class:g(["fill-gray-500 dark:fill-gray-300",{"!fill-semiCyan":e(l).displayChat==="all"}]),fill:"none",width:"40px",height:"40px",viewBox:"0 0 24 24",id:"Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg"},we,2))]),ChatNavHeaderText:h(()=>[w(m(i.$t("Все")),1)]),_:1},8,["class"]),f(T,{class:g({"text-semiCyan":e(l).displayChat==="users"}),onClick:o[1]||(o[1]=s=>e(l).displayChat="users")},{ChatNavHeaderSvg:h(()=>[(n(),p("svg",{class:g(["fill-gray-600 dark:fill-white",{"!fill-semiCyan":e(l).displayChat==="users"}]),width:"40px",height:"40px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ke,2))]),ChatNavHeaderText:h(()=>[w(m(i.$t("Личные")),1)]),_:1},8,["class"]),f(T,{class:g({"text-semiCyan":e(l).displayChat==="groups"}),onClick:o[2]||(o[2]=s=>e(l).displayChat="groups")},{ChatNavHeaderSvg:h(()=>[(n(),p("svg",{class:g(["fill-gray-600 dark:fill-gray-300",{"!fill-semiCyan":e(l).displayChat==="groups"}]),height:"40px",width:"40px",version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 611.998 611.998","xml:space":"preserve"},Ne,2))]),ChatNavHeaderText:h(()=>[w(m(i.$t("Группы")),1)]),_:1},8,["class"])],2)]))}}),Le=a("svg",{class:"fill-gray-600 dark:fill-gray-300",height:"20px",width:"20px",version:"1.1",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 459.863 459.863","xml:space":"preserve"},[a("g",null,[a("g",null,[a("g",null,[a("path",{d:`M395.988,193.977c-18.629,24.992-45.641,41.956-77.406,44.25c26.626,31.04,43.84,70.378,47.152,113.55\r
                c1.243,16.197,0.369,24.083-0.932,30.599c16.064-2.497,30.815-6.128,43.488-10.794c42.626-15.694,51.573-38.891,51.573-55.586\r
                C459.863,265.521,434.565,220.849,395.988,193.977z`}),a("path",{d:`M276.72,199.407c10.642,5.952,22.36,9.093,34.525,9.093c45.83,0,81.115-44.3,81.115-96.677\r
                c0-52.382-35.29-96.677-81.115-96.677c-18.734,0-36.411,7.436-50.724,21.145c20.03,25.65,31.446,59.072,31.446,94.667\r
                C291.967,154.544,286.961,178.037,276.72,199.407z`}),a("path",{d:`M259.999,226.279c-24.558,31.058-57.739,46.482-91.839,46.482c-36.232,0-68.69-17.206-91.839-46.482\r
                C30.403,256.333,0,308.217,0,367.076c0,18.127,9.926,43.389,57.213,60.8c29.496,10.861,68.898,16.841,110.947,16.841\r
                c42.049,0,81.451-5.98,110.947-16.841c47.287-17.411,57.213-42.673,57.213-60.8C336.32,308.217,305.918,256.333,259.999,226.279z\r
                `}),a("path",{d:`M168.16,242.763c53.003,0,93.806-51.234,93.806-111.804c0-60.571-40.808-111.804-93.806-111.804\r
                c-52.995,0-93.806,51.223-93.806,111.804C74.354,191.541,115.169,242.763,168.16,242.763z`})])])])],-1),Ge={class:"text-sm"},Se={key:0},Be={class:"flex select-none text-sm justify-end gap-x-4"},He={class:"tracking-wider px-4 pt-4"},Ue={class:"text-sm text-gray-400 ml-2"},ze=a("div",{class:"w-full px-4 relative flex items-center"},[a("div",{class:"absolute rotate-90 ml-2"},[a("svg",{class:"dark:stroke-white stroke-black",width:"25px",height:"25px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M14.9536 14.9458L21 21M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z","stroke-width":"1.2","stroke-linecap":"round","stroke-linejoin":"round"})])]),a("input",{type:"text",class:"w-full dark:bg-gray-700 outline-none pl-10 h-[50px]",placeholder:"Поиск..."})],-1),Te={class:"w-full px-4 h-[50px] flex items-center justify-end text-sm gap-x-4"},H=!1,Ze=b({__name:"ChatGroupCreate",setup(_){const l=M([]),i=M(null),o=M(""),s=k();F(),S();const d=()=>{O(()=>{var u;(u=i.value)==null||u.focus()})};return Z(()=>{o.value.trim()}),(u,r)=>(n(),p("div",null,[f($,{class:"mb-2 flex items-center gap-x-4 mx-auto",type:"treeBtn",onClick:r[0]||(r[0]=c=>{e(s).showGroupCreate=!0,d()})},{default:h(()=>[Le,a("p",Ge,m(u.$t("Создать группу")),1)]),_:1}),e(s).showGroupCreate?(n(),y(R,{key:0,onClick:r[8]||(r[8]=c=>d()),onShowModal:r[9]||(r[9]=c=>{e(s).showGroupCreate=!1,e(s).showGroupCreateChoice=!1,o.value="",e(s).file="",e(s).src="",e(s).fileUpload=null,e(s).results={coordinates:null,image:null}}),type:"resize"},{default:h(()=>[a("div",{onClick:r[5]||(r[5]=c=>d()),class:"flex select-none gap-x-6 items-center"},[a("div",{class:"relative",onMouseenter:r[1]||(r[1]=c=>e(s).showImageChange=!0),onMouseleave:r[2]||(r[2]=c=>e(s).showImageChange=!1)},[f(ee,{name:"fade"},{default:h(()=>[f(le,{toward:"chat"})]),_:1}),e(s).results.image?(n(),p("div",Se,[f(e(re),{class:"w-[80px] h-[80px] rounded-full",image:e(s).results.image,coordinates:e(s).results.coordinates},null,8,["image","coordinates"])])):x("",!0)],32),a("div",null,[a("p",{class:g(["text-sm tracking-wider text-semiCyan transition-all",{"!text-red-400 transition-all":H}])},m(u.$t("Название группы")),3),P(a("input",{ref_key:"groupName",ref:i,"onUpdate:modelValue":r[3]||(r[3]=c=>te(o)?o.value=c:null),class:g(["border-b-2 bg-transparent border-b-semiCyan !outline-none transition-all",{"border-b-red-400 transition-all":H}]),onChange:r[4]||(r[4]=c=>H=!1),type:"text"},null,34),[[A,e(o)]])])]),a("div",Be,[f($,{type:"chat",onClick:r[6]||(r[6]=c=>{e(s).showGroupCreate=!1,e(s).showGroupCreateChoice=!1,e(s).isGroup=!1,e(s).file="",e(s).src="",o.value="",e(s).fileUpload=null,e(s).results={coordinates:null,image:null}})},{default:h(()=>[w(m(u.$t("Отмена")),1)]),_:1}),f($,{type:"chat",onClick:r[7]||(r[7]=()=>{!e(o).length||!e(o).trim()?(e(ce).error("Заполните поле",{autoClose:1500,theme:"auto"}),H=!0):(e(s).showGroupCreate=!1,e(s).showGroupCreateChoice=!0)})},{default:h(()=>[w(m(u.$t("Далее")),1)]),_:1})])]),_:1})):x("",!0),e(s).showGroupCreateChoice?(n(),y(R,{key:1,type:"resizeSendWindow",class:"",onShowModal:r[14]||(r[14]=c=>{e(s).showGroupCreateChoice=!1,e(s).showGroupCreate=!1,o.value="",e(s).file="",e(s).src="",e(s).fileUpload=null,e(s).results={coordinates:null,image:null}})},{default:h(()=>[a("p",He,[w(m(u.$t("Добавить участников"))+" ",1),a("span",Ue,m(e(l).length+"/1000"),1)]),ze,(n(!0),p(U,null,z(e(s).get_chat_list.results.filter(c=>!c.is_group),c=>(n(),y(oe,{item:c},null,8,["item"]))),256)),a("div",Te,[e(s).showSettingChat?(n(),y($,{key:1,type:"chat",onClick:r[11]||(r[11]=c=>{e(s).showGroupCreateChoice=!1})},{default:h(()=>[w(m(u.$t("Отмена")),1)]),_:1})):(n(),y($,{key:0,type:"chat",onClick:r[10]||(r[10]=c=>{e(s).showGroupCreateChoice=!1,e(s).showGroupCreate=!0,d()})},{default:h(()=>[w(m(u.$t("Назад")),1)]),_:1})),e(s).showSettingChat?(n(),y($,{key:3,type:"chat",onClick:r[13]||(r[13]=()=>{})},{default:h(()=>[w(m(u.$t("Добавить")),1)]),_:1})):(n(),y($,{key:2,type:"chat",onClick:r[12]||(r[12]=c=>{e(s).showGroupCreateChoice=!1,e(s).isGroup=!0,e(s).createChatUser({users:e(l).filter(t=>t.id).map(t=>t.id),name:e(o),photo:e(s).fileUpload}).then(t=>{e(s).isGroup=!1})})},{default:h(()=>[w(m(u.$t("Создать")),1)]),_:1}))])]),_:1})):x("",!0)]))}}),Ve={class:""},De={key:0,class:"mx-4"},We=b({__name:"ChatNavHeader",props:{activeNav:{type:Boolean,default:!1}},setup(_){const l=G(),i=k(),o=L();return(s,d)=>(n(),p("div",Ve,[a("form",{onSubmit:d[1]||(d[1]=se(u=>e(l).searchUser({search:e(i).searchElem}),["prevent"])),class:"px-4 mb-2 pb-4"},[P(a("input",{"onUpdate:modelValue":d[0]||(d[0]=u=>e(i).searchElem=u),class:g(["w-full hover:bg-active px-4 py-1 rounded-full max-md:w-9/12 max-md:mx-auto block text-sm bg-gray-100 focus:bg-gray-300 text-black tracking-widest dark:focus:opacity-100 transition-all dark:bg-gray-600 dark:text-white outline-none",{"max-md:hidden":!e(i).activeChatNav&&e(o).path!=="/base/chat"}]),type:"text",placeholder:"Поиск..."},null,2),[[A,e(i).searchElem]])],32),e(i).windowWidth<768||e(i).windowWidth>768?(n(),p("div",De,[f(Ze),f(Me)])):x("",!0)]))}}),je={class:"flex gap-x-2"},Ee={class:"text-sm break-words"},Ie={key:0,class:"text-black dark:text-white"},Re={key:1,class:"tracking-wider text-black dark:text-white"},Fe={key:2,class:"text-black dark:text-white"},Pe={class:"text-[12px] flex gap-x-1"},Ae={key:0},Oe={key:0,"fill-rule":"evenodd","clip-rule":"evenodd",d:"M15.4933 6.93502C15.8053 7.20743 15.8374 7.68122 15.565 7.99325L7.70786 16.9933C7.56543 17.1564 7.35943 17.25 7.14287 17.25C6.9263 17.25 6.72031 17.1564 6.57788 16.9933L3.43502 13.3933C3.16261 13.0812 3.19473 12.6074 3.50677 12.335C3.8188 12.0626 4.29259 12.0947 4.565 12.4068L7.14287 15.3596L14.435 7.00677C14.7074 6.69473 15.1812 6.66261 15.4933 6.93502Z"},Je={key:1,"fill-rule":"evenodd","clip-rule":"evenodd",d:"M20.5175 7.01946C20.8174 7.30513 20.829 7.77986 20.5433 8.07981L11.9716 17.0798C11.8201 17.2389 11.6065 17.3235 11.3872 17.3114C11.1679 17.2993 10.9649 17.1917 10.8318 17.0169L10.4035 16.4544C10.1526 16.1249 10.2163 15.6543 10.5458 15.4034C10.8289 15.1878 11.2161 15.2044 11.4787 15.4223L19.4571 7.04531C19.7428 6.74537 20.2175 6.73379 20.5175 7.01946Z"},qe=b({__name:"ChatNavContentUser",props:{dragClass:{type:Boolean,default:!1}},setup(_){G();const l=k(),i=S(),o=L();function s(d){let u=new WebSocket(`wss://buildwithus.ai-softdev.com/ws/chat/${d}?token=${ue.localStorage.getData("token")}`);u.onmessage=r=>{let c=JSON.parse(r.data.message);console.log(c)}}return(d,u)=>{var c;const r=q;return n(!0),p(U,null,z((c=e(l).get_chat_list.results)==null?void 0:c.filter(t=>e(l).displayChat==="all"||t.is_group===!0&&e(l).displayChat==="groups"||t.is_group===!1&&e(l).displayChat==="users"),t=>(n(),y(r,{to:`/base/chat/${t.id}`,onClick:v=>{e(l).activeChatNav=!1,s(t.id),e(l).showPinnedWindow=!1,e(l).messageUpdate={},e(l).messageForwarded={},e(l).messageReplied={},e(l).showChatInfo=!1,e(l).showGroupCreateChoice=!1},class:g(["flex justify-between px-4 gap-x-2 dark:hover:bg-gray-500 hover:bg-gray-300 cursor-pointer transition-all duration-200 py-2",{"dark:hover:!bg-semiCyan ":e(o).path===`/base/chat/${t.id}`,"hover:!bg-cyan":e(o).path===`/base/chat/${t.id}`,"!bg-blue-400":_.dragClass&&t.id===t.id}]),onDragenter:v=>t.id?_.dragClass=!0:_.dragClass=!1,onDragleave:u[0]||(u[0]=v=>_.dragClass=!1)},{default:h(()=>{var v,C,N,V,D,W,j;return[a("div",je,[f(ne,{chat:t},null,8,["chat"]),a("div",Ee,[((v=t.user)==null?void 0:v.id)!==e(i).user.id&&((C=t.user)!=null&&C.id)?(n(),p("p",Ie,m(e(i).user.id!==((N=t.user)==null?void 0:N.id)?t.user.first_name+" "+t.user.last_name:e(i).user.first_name+" "+e(i).user.last_name),1)):!((V=t.user)!=null&&V.id)&&!t.is_group?(n(),p("p",Re,m(d.$t("Избранное")),1)):t.is_group?(n(),p("p",Fe,m(t.name),1)):x("",!0),t.last_message.text&&!t.last_message.file_name?(n(),p("p",{key:3,class:g(["text-gray-400",{"text-gray-500 dark:text-white":e(o).path===`/base/chat/${t.id}`}])},m(((D=t.last_message.text)==null?void 0:D.length)>15?t.last_message.text.slice(0,15)+"...":t.last_message.text),3)):t.last_message.text&&t.last_message.file_name?(n(),p("p",{key:4,class:g(["text-gray-400",{"text-gray-500 dark:text-white":e(o).path===`/base/chat/${t.id}`}])},[a("span",null,m(t.last_message.file_name.length>20?t.last_message.file_name.slice(0,15)+"...":t.last_message.file_name),1),w(m(", "+t.last_message.text),1)],2)):!t.last_message.text&&t.last_message.file_name?(n(),p("p",{key:5,class:g(["text-gray-400",{"text-gray-500 dark:text-white":e(o).path===`/base/chat/${t.id}`}])},m(t.last_message.file_name.length>20?t.last_message.file_name.slice(0,20)+"...":t.last_message.file_name),3)):x("",!0)])]),a("div",Pe,[(W=t.user)!=null&&W.id?(n(),p("div",Ae,[t.last_message.sender.id===e(i).user.id?(n(),p("svg",{key:0,class:g(["fill-semiCyan",{"fill-white":e(o).path===`/base/chat/${t.id}`}]),width:"20px",height:"20px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[((j=t.last_message.text)==null?void 0:j.length)>0?(n(),p("path",Oe)):x("",!0),t.last_message.read!==!1?(n(),p("path",Je)):x("",!0)],2)):x("",!0)])):x("",!0),a("p",{class:g(["text-gray-400",{"text-white":e(o).path===`/base/chat/${t.id}`}])},m(t.last_message.created_at?new Date(t.last_message.created_at).toLocaleTimeString().slice(0,5):""),3)])]}),_:2},1032,["to","onClick","onDragenter","class"]))),256)}}}),Ke={class:"h-[80%] max-md:h-[80%] overflow-y-auto mt-4 max-md:w-full"},Qe={key:0,class:"flex flex-col mb-20"},Xe={class:"flex justify-center relative flex-col items-center mb-2"},Ye={class:"absolute left-6 max-md:left-10 flex items-center"},et={class:"ml-4 flex flex-col dark:opacity-20 gap-y-2"},tt={key:1,class:""},st=["src"],at={class:"text-sm break-words"},lt=b({__name:"ChatNavContent",setup(_){const l=G(),i=k(),o=S(),s=L();return(d,u)=>{const r=q;return n(),p("div",Ke,[e(i).searchElem===""?(n(),p("div",Qe,[e(l).get_user_list.results?(n(),y(qe,{key:0})):(n(),p(U,{key:1},z(4,c=>a("div",Xe,[f(B,{class:"dark:opacity-20 opacity-60",width:"90%",height:"70px","border-radius":"10px"}),a("div",Ye,[f(B,{class:"dark:opacity-20",width:"50px",height:"50px","border-radius":"100%"}),a("div",et,[f(B,{class:"",width:"150px",height:"10px","border-radius":"4px"}),f(B,{class:"",width:"150px",height:"10px","border-radius":"4px"})])])])),64))])):x("",!0),e(i).searchElem!==""?(n(),p("div",tt,[(n(!0),p(U,null,z(e(l).get_user_search.results,c=>{var t;return n(),y(r,{to:`/base/chat/${(t=e(i).get_user_chat)==null?void 0:t.id}`,onClick:v=>{var C;c.id!==((C=e(i).get_user_chat.user)==null?void 0:C.id)&&e(i).createChatUser({user_id:c.id}),e(i).showPinnedWindow=!1,e(i).searchElem="",e(i).activeChatNav=!1},class:g(["flex items-center px-4 gap-x-2 dark:hover:bg-gray-500 hover:bg-gray-300 cursor-pointer transition-all duration-200 p-1",{"dark:hover:!bg-semiCyan":e(s).path===`/base/chat/${c.id}`,"hover:!bg-cyan":e(s).path===`/base/chat/${c.id}`}])},{default:h(()=>[a("img",{class:"w-[50px] h-[50px] rounded-full",src:e(o).get_server_domain+c.photo_url,alt:""},null,8,st),a("p",at,m(c.first_name+" "+c.last_name),1)]),_:2},1032,["to","onClick","class"])}),256))])):x("",!0)])}}}),rt={class:"h-full"},ot=b({__name:"ChatNav",props:{activeNav:{type:Boolean,default:!0}},setup(_){F(),L(),G();const l=k();return S(),Z(()=>{l.windowWidth=window.innerWidth}),(i,o)=>(n(),p("div",rt,[f(We,{class:"pt-6"}),f(lt,{class:"",onDragenter:o[0]||(o[0]=s=>e(l).showDragInfo=!1)})]))}}),nt=J(ot,[["__scopeId","data-v-a2cc5a54"]]),it={key:0,class:"fixed top-0 left-0 right-0 bottom-0 backdrop-blur z-[1000]"},dt={class:"p-20 w-full h-full max-md:w-screen max-md:h-screen max-md:p-0"},ct={class:"absolute bottom-2 left-0 right-0 flex justify-center"},ut={class:"bg-gray-800 bg-opacity-40 p-4 flex gap-x-10 text-sm rounded-lg"},pt=a("svg",{class:"fill-gray-300 hover:fill-white transition-all",width:"30px",height:"30px",viewBox:"0 0 56 56",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M 7.7265 25.1056 C 8.2656 24.8477 8.5000 24.4493 8.4765 23.7930 C 8.4062 22.9493 7.4452 21.7774 7.4452 18.6603 C 7.4452 13.6446 10.6796 10.1290 15.7421 10.1290 L 15.8124 10.1290 L 15.8124 13.3399 C 15.8124 15.1915 17.2656 15.6134 18.6718 14.5587 L 25.0702 9.8946 C 26.1484 9.1212 26.1484 8.2071 25.0702 7.4103 L 18.6718 2.7227 C 17.2421 1.6444 15.8124 2.0665 15.8124 3.9649 L 15.8124 7.4103 L 15.7187 7.4103 C 8.9921 7.4103 4.5156 11.9337 4.5156 18.6368 C 4.5156 21.1446 5.0312 23.2071 5.7578 24.4493 C 6.1562 25.1290 7.0000 25.4571 7.7265 25.1056 Z M 45.4609 54.3556 C 49.4689 54.3556 51.4844 52.4337 51.4844 48.3321 L 51.4844 25.1524 C 51.4844 21.0508 49.4689 19.1290 45.4609 19.1290 L 22.2343 19.1290 C 18.2265 19.1290 16.2109 21.0508 16.2109 25.1524 L 16.2109 48.3321 C 16.2109 52.4337 18.2265 54.3556 22.2343 54.3556 Z M 45.3905 50.5821 L 22.3046 50.5821 C 20.6874 50.5821 19.9843 49.9259 19.9843 48.2618 L 19.9843 25.2227 C 19.9843 23.5587 20.6874 22.9024 22.3046 22.9024 L 45.3905 22.9024 C 47.0080 22.9024 47.7107 23.5587 47.7107 25.2227 L 47.7107 48.2618 C 47.7107 49.9259 47.0080 50.5821 45.3905 50.5821 Z"})],-1),ft=b({__name:"ChatCropper",setup(_){const l=k();let i=new FormData;function o({coordinates:s,image:d}){l.results={coordinates:s,image:d}}return(s,d)=>(n(),p("div",null,[e(l).src&&e(l).showChatCropper===!0?(n(),p("div",it,[a("div",dt,[f(e(de),{ref:"cropper",class:"w-screen h-screen",src:e(l).src,backgroundClass:"!bg-transparent",foregroundClass:"bg-black rounded-lg",onChange:o,"stencil-component":e(ie),"stencil-props":{previewClass:"border-dashed border w-full h-full"}},null,8,["src","stencil-component"])]),a("div",ct,[a("div",ut,[f($,{onClick:d[0]||(d[0]=u=>{e(l).showChatCropper=!1,e(l).file="",e(l).src="",e(l).results={image:null,coordinates:null,file:null}})},{default:h(()=>[w(m(s.$t("Отмена")),1)]),_:1}),f($,null,{default:h(()=>[pt]),_:1}),f($,{class:"!text-semiCyan",onClick:d[1]||(d[1]=()=>{const{canvas:u}=this.$refs.cropper.getResult();u&&(u==null||u.toBlob(r=>{e(l).fileUpload=r,e(i).append("file",r)})),console.log(u),e(l).showChatCropper=!1})},{default:h(()=>[w(m(s.$t("Установить фотография")),1)]),_:1})])])])):x("",!0)]))}}),mt={class:"!mx-0 !py-0"},ht={class:"dark:border-t-gray-500 dark:shadow-gray-500 dark:bg-gray-800 bg-gray-300 flex w-full border-t border-t-gray-100 dark:text-white rounded-lg shadow-md"},gt={class:"w-11/12 relative overflow-hidden max-lg:w-9/12 max-md:w-full h-screen"},_t={key:0,class:"flex items-center justify-center my-auto w-full h-full text-center rounded-full px-2"},xt={class:"bg-black text-white bg-opacity-40 px-10 py-2 rounded-full"},Vt=b({__name:"chat",setup(_){const l=M(0),i=M(!0),o=L(),s=K(),d=k(),u=G(),r=S(),c=pe();return d.loadChatList({page:1,limit:100}),u.loadUserList({query:"",user_type:"user-list",page:1,limit:1e4}),Z(()=>{var t;l.value=window.innerWidth,o.path==="/base/chat"?i.value=!0:o.path===`/base/chat/${(t=d.userChat)==null?void 0:t.id}`&&(i.value=!1)}),ae(()=>{d.showGroupCreateChoice=!1,d.showGroupCreate=!1,d.file="",d.src="",d.fileUpload=null,d.results={coordinates:null,image:null}}),I(()=>r.user,t=>{var v,C;((C=(v=r==null?void 0:r.user)==null?void 0:v.role)==null?void 0:C.name_en)==="admin"&&(window.history.length>1?s.push("/base/profile"):s.push("/"))}),I(()=>c.company,t=>{var C;((C=c.company.modules)==null?void 0:C.find(N=>N.name_en==="chat"))||(window.history.length>1?s.push("/base/profile"):s.push("/"))}),Y({title:"Чат",description:"Интерактивный чат для пользователей"}),(t,v)=>{const C=Q,N=X;return n(),p("div",mt,[a("div",ht,[a("div",{class:g(["max-md:absolute h-screen overflow-hidden relative z-[12] rounded-l-lg dark:bg-gray-700 bg-gray-200 transition-all duration-300 w-[320px]",{"max-md:w-0":!e(d).activeChatNav||e(o).path===`/base/chat/${e(o).params.id}`,"max-md:w-full ":e(o).path==="/base/chat","w-[320px]":!e(u).get_user_list.results||!e(d).activeChatNav}])},[f(nt,{class:""})],2),a("div",gt,[f(N,null,{default:h(()=>[f(C),f(ft)]),_:1}),e(o).path==="/base/chat"?(n(),p("div",_t,[a("p",xt,m(t.$t("Выберите пользователя для того чтобы открыть чат")),1)])):x("",!0)])])])}}});export{Vt as default};
