import{j,a as u,H as I,b as k,N as x,O as R,Z as l,a6 as B}from"./swiper-vue.C62siAhS.js";import{u as N}from"./documents.DAZWF3YJ.js";import{b as U}from"./entry.Deb27Hxd.js";import{u as K}from"./auth.basOWA_E.js";import"./nuxt-storage.BcgQIRf3.js";const L={class:"flex flex-col gap-5"},V=l("p",null," –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª—é—á: ",-1),F=l("button",{type:"submit"},"CHECK",-1),W=j({__name:"[slug]",setup(D){const C=U(),f=u(!1);function r(e){return new Promise((o,n)=>{if(a.querySelector(`script[src="${e}"]`)){o();return}const t=a.createElement("script");t.src=e,t.async=!0,t.onload=()=>o(),t.onerror=()=>n(new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ ${e}`)),a.head.appendChild(t)})}async function h(){try{await r("/e-imzo/e-imzo.js"),await r("/e-imzo/e-imzo-client.js"),await r("/e-imzo/micro-ajax.js"),await r("/e-imzo/e-imzo-init.js"),console.log("‚úÖ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã"),E()}catch(e){console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ E-IMZO",e)}}I(async()=>{await h()});async function E(){try{await r("/e-imzo/e-imzo.js"),await r("/e-imzo/e-imzo-client.js"),await r("/e-imzo/micro-ajax.js"),await r("/e-imzo/e-imzo-init.js"),window.EIMZOClient?(console.log("‚úÖ EIMZOClient –∑–∞–≥—Ä—É–∂–µ–Ω:",window.EIMZOClient),console.log("üìú –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã EIMZOClient:",Object.keys(window.EIMZOClient)),v()):console.error("‚ùå EIMZOClient –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏")}catch(e){console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∫—Ä–∏–ø—Ç–æ–≤:",e)}}async function v(){if(!window.EIMZOClient){console.error("EIMZOClient –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω");return}f.value=!0;try{EIMZOClient.checkVersion(function(e,o){var n=EIMZO_MAJOR*100+EIMZO_MINOR,t=parseInt(e)*100+parseInt(o);t<n?console.log("installedVersion < newVersion"):EIMZOClient.installApiKeys(function(){O()},function(s,i){console.log(i?"da":"net")})},function(e,o){console.log(o?"da2":"net2")}),console.log("üìÑ –î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–Ω –∏ –æ–±–Ω–æ–≤–ª—ë–Ω")}catch(e){console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞:",e)}finally{f.value=!1}}function O(){EIMZOClient.listAllUserKeys(function(e,o){var n="itm-"+e.serialNumber+"-"+o;return n},function(e,o){return M(e,o)},function(e,o){var n=a.querySelector('select[name="key"]');n.innerHTML="",e.forEach(function(t){n.appendChild(t)})},function(e,o){e?uiShowMessage(errorCAPIWS+" : "+e):console.log(o)})}var M=function(e,o){var n=new Date;o.expired=dates.compare(n,o.validTo)>0;var t=a.createElement("option");return t.value=e,t.text=o.CN,o.expired&&(t.style.color="gray",t.text=t.text+" (—Å—Ä–æ–∫ –∏—Å—Ç–µ–∫)"),t.setAttribute("vo",JSON.stringify(o)),t.setAttribute("id",e),t};u("");let d=u(null);const p=u(null),_=e=>{b()},b=function(){console.log("–ù–∞—á–∞–ª–æ –ø–æ–¥–ø–∏—Å–∏");let e=p.value,o=d.value;EIMZOClient.createPkcs7(o,e,null,function(n){Z(n,function(t){console.log("–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å –≤—Ä–µ–º–µ–Ω–µ–º",t),S(t,!1,e,function(s){console.log(s)})})},(n,t)=>{console.log("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–∏–∏")},!1,!0)},Z=function(e,o){microAjax("http://127.0.0.1:9999"+"/frontend/timestamp/pkcs7",function(t,s){if(s.status!=200){console.log("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ timestamp –∫ –ø–æ–¥–ø–∏—Å–∏");return}var i;try{var t=JSON.parse(t);if(t.status!=1){console.log(t.status," - ",s.message);return}i=t.pkcs7b64}catch(w){console.log("–û—à–∏–±–∫–∞",s.status," - ",s.statusText,w)}o(i)},e)},S=function(e,o,n,t,s){var i;console.log(o),console.log(i),microAjax("http://127.0.0.1:8000/my_app/verify/",function(c,m){if(m.status!=200){console.log(m.status," - ",m.statusText);return}var y;try{var c=JSON.parse(c);if(c.status!=1)return;y=c.pkcs7Info}catch{}t(y)},"pkcs7wtst="+encodeURIComponent(e)+(o?"&data64="+encodeURIComponent(i):""))};function z(e){let o=a.getElementById(e.target.value),n=JSON.parse(o.getAttribute("vo"));console.log("üîë –í—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–Ω–Ω—ã–µ:",n),EIMZOClient.loadKey(n,function(t){d.value=t},(t,s)=>{console.log("error")})}const a=N(),g=K();I(()=>{a.loadDocument({slug:C.params.slug})});async function A(){try{const e=g.get_server_domain+a.documentItem.file,o=await fetch(e);if(!o.ok)throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞");const n=await o.blob(),t=new FileReader;t.onloadend=()=>{const s=t.result.split(",")[1];p.value=s},t.readAsDataURL(n)}catch(e){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:",e)}}return k(()=>a.documentItem,e=>{console.log(g.get_server_domain+a.documentItem.file),A()}),(e,o)=>(x(),R("div",L,[l("div",null,[V,l("select",{name:"key",onChange:o[0]||(o[0]=n=>z(n))},null,32),l("form",{id:"myForm",onSubmit:B(_,["prevent"])},[l("input",{type:"file",onChange:o[1]||(o[1]=(...n)=>e.handleFileChange&&e.handleFileChange(...n)),class:"w-full dark:bg-gray-700 outline-none pl-10 h-[50px]"},null,32),F],32)])]))}});export{W as default};
