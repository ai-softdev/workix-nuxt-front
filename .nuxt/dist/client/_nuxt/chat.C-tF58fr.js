import{c as P,b as M,e as J,_ as q}from"./entry.Dy8EJx_g.js";import{_ as K}from"./client-only.Czp7w5av.js";import{u as Q}from"./index.B3Es73M7.js";import{u as G}from"./users.De0_UaD4.js";import{u as N}from"./chat.DUa8cj1E.js";import{u as S}from"./auth.Mhh5ZJSY.js";import{j as $,N as i,O as p,Z as n,a5 as V,a4 as x,L as h,V as f,u as e,$ as g,_ as m,a as L,k as X,H as Z,P as b,a2 as _,n as F,M as Y,aa as A,ab as O,x as ee,J as H,a3 as I,a6 as te,ac as se,I as ae,b as W}from"./swiper-vue.CGVHF6NK.js";import{_ as y}from"./TheButton.vue.QP7bXPCy.js";import{_ as z}from"./TheModal.vue.DS_Yqxkb.js";import{_ as oe}from"./TheFileInput.vue.HLY0bZgN.js";import{h as le,_ as re,a as ne,m as ie,f as de}from"./TheChatAvatar.vue.COZNJfR_.js";import{l as ue,n as pe}from"./nuxt-storage.LTSgK-Sl.js";import{T}from"./TheSceleton.B55_wRiz.js";import{_ as ce}from"./nuxt-link.1aTga26B.js";import{_ as he}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{u as me}from"./companies.D_SstxnZ.js";import"./ElemUI.CoXhQqPn.js";import"./documents.BZrbI0Sk.js";const fe=""+globalThis.__publicAssetsURL("icons/chat-search.svg"),ge={class:"text-[12px] text-center"},D=$({__name:"ChatNavHeaderSlot",props:{active:{type:Boolean,default:!1}},setup(C){return(a,d)=>(i(),p("div",{class:x(["p-2 cursor-pointer flex flex-col items-center justify-center gap-2.5 rounded-xl transition-all ease-in-out duration-300",{"bg-azure bg-opacity-10":C.active}])},[n("div",null,[V(a.$slots,"ChatNavHeaderSvg")]),n("p",ge,[V(a.$slots,"ChatNavHeaderText")])],2))}}),_e={class:"select-none"},Ce={class:"grid grid-cols-3 gap-2 transition-all duration-200 pb-3 border-b"},ve=n("svg",{width:"25",height:"26",viewBox:"0 0 25 26",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[n("path",{d:"M5.61123 12.1009C5.53872 11.6336 5.50109 11.1549 5.50109 10.6673C5.50109 5.51266 9.70726 1.33398 14.8958 1.33398C20.0844 1.33398 24.2905 5.51266 24.2905 10.6673C24.2905 11.8318 24.076 12.9464 23.6839 13.9742C23.6024 14.1877 23.5616 14.2945 23.5432 14.3778C23.5249 14.4604 23.5177 14.5185 23.5158 14.6031C23.5138 14.6884 23.5253 14.7824 23.5485 14.9703L24.0181 18.7856C24.069 19.1986 24.0944 19.4051 24.0257 19.5552C23.9655 19.6868 23.8586 19.7912 23.7258 19.8484C23.5741 19.9136 23.3682 19.8834 22.9565 19.8231L19.2404 19.2784C19.0463 19.2499 18.9493 19.2357 18.8609 19.2363C18.7735 19.2367 18.7131 19.2431 18.6274 19.2611C18.541 19.2793 18.4305 19.3207 18.2096 19.4034C17.1791 19.7895 16.0623 20.0007 14.8958 20.0007C14.4079 20.0007 13.9288 19.9637 13.461 19.8925M7.40465 24.6673C10.8637 24.6673 13.6678 21.7945 13.6678 18.2507C13.6678 14.7068 10.8637 11.834 7.40465 11.834C3.9456 11.834 1.14149 14.7068 1.14149 18.2507C1.14149 18.963 1.2548 19.6482 1.46395 20.2885C1.55236 20.5591 1.59656 20.6945 1.61108 20.7869C1.62622 20.8835 1.62887 20.9376 1.62323 21.0351C1.61783 21.1286 1.59445 21.2342 1.5477 21.4453L0.834473 24.6673L4.32841 24.1901C4.51912 24.1641 4.61447 24.1511 4.69774 24.1517C4.78541 24.1522 4.83195 24.157 4.91793 24.1742C4.99959 24.1904 5.12099 24.2332 5.36379 24.319C6.00349 24.5447 6.6901 24.6673 7.40465 24.6673Z",stroke:"black","stroke-width":"1.4","stroke-linecap":"round","stroke-linejoin":"round"})],-1),we=n("svg",{width:"25",height:"26",viewBox:"0 0 25 26",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[n("path",{d:"M4.70349 21.6788C5.4132 20.0067 7.07021 18.834 9.00114 18.834H16.0011C17.9321 18.834 19.5891 20.0067 20.2988 21.6788M17.1678 10.084C17.1678 12.6613 15.0784 14.7507 12.5011 14.7507C9.92381 14.7507 7.83447 12.6613 7.83447 10.084C7.83447 7.50665 9.92381 5.41732 12.5011 5.41732C15.0784 5.41732 17.1678 7.50665 17.1678 10.084ZM24.1678 13.0007C24.1678 19.4439 18.9444 24.6673 12.5011 24.6673C6.05781 24.6673 0.834473 19.4439 0.834473 13.0007C0.834473 6.55733 6.05781 1.33398 12.5011 1.33398C18.9444 1.33398 24.1678 6.55733 24.1678 13.0007Z",stroke:"black","stroke-width":"1.4","stroke-linecap":"round","stroke-linejoin":"round"})],-1),xe=n("svg",{width:"29",height:"28",viewBox:"0 0 29 28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[n("path",{d:"M26.1678 24.5V22.1667C26.1678 19.9922 24.6805 18.1651 22.6678 17.647M18.5845 3.83922C20.2947 4.53151 21.5011 6.20819 21.5011 8.16667C21.5011 10.1251 20.2947 11.8019 18.5845 12.4941M20.3345 24.5C20.3345 22.3256 20.3345 21.2385 19.9792 20.3808C19.5056 19.2374 18.5971 18.3289 17.4536 17.8552C16.596 17.5 15.5089 17.5 13.3345 17.5H9.83447C7.66007 17.5 6.57288 17.5 5.71529 17.8552C4.57181 18.3289 3.66334 19.2374 3.1897 20.3808C2.83447 21.2385 2.83447 22.3256 2.83447 24.5M16.2511 8.16667C16.2511 10.744 14.1618 12.8333 11.5845 12.8333C9.00714 12.8333 6.91781 10.744 6.91781 8.16667C6.91781 5.58934 9.00714 3.5 11.5845 3.5C14.1618 3.5 16.2511 5.58934 16.2511 8.16667Z",stroke:"black","stroke-width":"1.4","stroke-linecap":"round","stroke-linejoin":"round"})],-1),be=$({__name:"ChatNavHeaderElem",props:{activeNav:{type:Boolean,default:!1}},setup(C){const a=N();return(d,r)=>(i(),p("div",_e,[n("div",Ce,[h(D,{active:e(a).displayChat==="all",onClick:r[0]||(r[0]=s=>e(a).displayChat="all")},{ChatNavHeaderSvg:f(()=>[ve]),ChatNavHeaderText:f(()=>[g(m(d.$t("Все")),1)]),_:1},8,["active"]),h(D,{active:e(a).displayChat==="users",onClick:r[1]||(r[1]=s=>e(a).displayChat="users")},{ChatNavHeaderSvg:f(()=>[we]),ChatNavHeaderText:f(()=>[g(m(d.$t("Личные")),1)]),_:1},8,["active"]),h(D,{active:e(a).displayChat==="groups",onClick:r[2]||(r[2]=s=>e(a).displayChat="groups")},{ChatNavHeaderSvg:f(()=>[xe]),ChatNavHeaderText:f(()=>[g(m(d.$t("Группы")),1)]),_:1},8,["active"])])]))}}),ye={key:0},ke={class:"flex select-none text-sm justify-end gap-x-4"},$e={class:"tracking-wider px-4 pt-4"},Ne={class:"text-sm text-gray-400 ml-2"},Le=n("div",{class:"w-full px-4 relative flex items-center"},[n("div",{class:"absolute rotate-90 ml-2"},[n("svg",{class:"dark:stroke-white stroke-black",width:"25px",height:"25px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[n("path",{d:"M14.9536 14.9458L21 21M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z","stroke-width":"1.2","stroke-linecap":"round","stroke-linejoin":"round"})])]),n("input",{type:"text",class:"w-full dark:bg-gray-700 outline-none pl-10 h-[50px]",placeholder:"Поиск..."})],-1),Me={class:"w-full px-4 h-[50px] flex items-center justify-end text-sm gap-x-4"},j=!1,Ge=$({__name:"ChatGroupCreate",setup(C){const a=L([]),d=L(null),r=L(""),s=N(),c=P();S();const u=()=>{F(()=>{var o;(o=d.value)==null||o.focus()})};s.get_chat_list.results&&Array.isArray(s.get_chat_list.results)&&(s.get_chat_list.results=s.get_chat_list.results.map(o=>({...o,value:!1})));const v=X(()=>s.get_chat_list.results.filter(o=>o.value).map(o=>o.user.id).join(","));return Z(()=>{r.value.trim()}),(o,t)=>(i(),p("div",null,[h(y,{class:"mb-6 !flex !items-center !justify-center gap-x-4 !p-2.5 hover:!bg-golden text-center w-full border !border-gainsboro rounded-full !text-black !transition-all ease-in-out duration-300",onClick:t[0]||(t[0]=l=>{e(s).showGroupCreate=!0,u()})},{default:f(()=>[g(" + "+m(o.$t("Создать группу")),1)]),_:1}),e(s).showGroupCreate?(i(),b(z,{key:0,onClick:t[8]||(t[8]=l=>u()),onShowModal:t[9]||(t[9]=l=>{e(s).showGroupCreate=!1,e(s).showGroupCreateChoice=!1,r.value="",e(s).file="",e(s).src="",e(s).fileUpload=null,e(s).results={coordinates:null,image:null}}),type:"resize"},{default:f(()=>[n("div",{onClick:t[5]||(t[5]=l=>u()),class:"flex select-none gap-x-6 items-center"},[n("div",{class:"relative",onMouseenter:t[1]||(t[1]=l=>e(s).showImageChange=!0),onMouseleave:t[2]||(t[2]=l=>e(s).showImageChange=!1)},[h(Y,{name:"fade"},{default:f(()=>[h(oe,{toward:"chat"})]),_:1}),e(s).results.image?(i(),p("div",ye,[h(e(le),{class:"w-[80px] h-[80px] rounded-full",image:e(s).results.image,coordinates:e(s).results.coordinates},null,8,["image","coordinates"])])):_("",!0)],32),n("div",null,[n("p",{class:x(["text-sm tracking-wider text-semiCyan transition-all",{"!text-red-400 transition-all":j}])},m(o.$t("Название группы")),3),A(n("input",{ref_key:"groupName",ref:d,"onUpdate:modelValue":t[3]||(t[3]=l=>ee(r)?r.value=l:null),class:x(["border-b-2 bg-transparent border-b-semiCyan !outline-none transition-all",{"border-b-red-400 transition-all":j}]),onChange:t[4]||(t[4]=l=>j=!1),type:"text"},null,34),[[O,e(r)]])])]),n("div",ke,[h(y,{type:"chat",onClick:t[6]||(t[6]=l=>{e(s).showGroupCreate=!1,e(s).showGroupCreateChoice=!1,e(s).isGroup=!1,e(s).file="",e(s).src="",r.value="",e(s).fileUpload=null,e(s).results={coordinates:null,image:null}})},{default:f(()=>[g(m(o.$t("Отмена")),1)]),_:1}),h(y,{type:"chat",onClick:t[7]||(t[7]=()=>{!e(r).length||!e(r).trim()?(e(ue).error("Заполните поле",{autoClose:1500,theme:"auto"}),j=!0):(e(s).showGroupCreate=!1,e(s).showGroupCreateChoice=!0)})},{default:f(()=>[g(m(o.$t("Далее")),1)]),_:1})])]),_:1})):_("",!0),e(s).showGroupCreateChoice?(i(),b(z,{key:1,type:"resizeSendWindow",class:"",onShowModal:t[14]||(t[14]=l=>{e(s).showGroupCreateChoice=!1,e(s).showGroupCreate=!1,r.value="",e(s).file="",e(s).src="",e(s).fileUpload=null,e(s).results={coordinates:null,image:null}})},{default:f(()=>[n("p",$e,[g(m(o.$t("Добавить участников"))+" ",1),n("span",Ne,m(e(a).length+"/1000"),1)]),Le,(i(!0),p(H,null,I(e(s).get_chat_list.results.filter(l=>!l.is_group),l=>(i(),b(re,{key:l.user.id,item:l,onUpdate:o.handleUpdate},null,8,["item","onUpdate"]))),128)),n("div",Me,[e(s).showSettingChat?(i(),b(y,{key:1,type:"chat",onClick:t[11]||(t[11]=l=>{e(s).showGroupCreateChoice=!1})},{default:f(()=>[g(m(o.$t("Отмена")),1)]),_:1})):(i(),b(y,{key:0,type:"chat",onClick:t[10]||(t[10]=l=>{e(s).showGroupCreateChoice=!1,e(s).showGroupCreate=!0,u()})},{default:f(()=>[g(m(o.$t("Назад")),1)]),_:1})),e(s).showSettingChat?(i(),b(y,{key:3,type:"chat",onClick:t[13]||(t[13]=()=>{})},{default:f(()=>[g(m(o.$t("Добавить")),1)]),_:1})):(i(),b(y,{key:2,type:"chat",onClick:t[12]||(t[12]=l=>{e(s).showGroupCreateChoice=!1,e(s).isGroup=!0,e(s).createChatGroup({name:e(r),users_str:e(v),photo:e(s).fileUpload},e(c)).then(()=>{e(s).isGroup=!1})})},{default:f(()=>[g(m(o.$t("Создать")),1)]),_:1}))])]),_:1})):_("",!0)]))}}),Se={class:"px-4 pt-4"},Ue=n("img",{src:fe,alt:"chat-search"},null,-1),Be=[Ue],Te={key:0,class:"mt-6"},je=$({__name:"ChatNavHeader",props:{activeNav:{type:Boolean,default:!1}},setup(C){const a=G(),d=N(),r=M();return(s,c)=>(i(),p("div",Se,[n("form",{onSubmit:c[2]||(c[2]=te(u=>e(a).searchUser({search:e(d).searchElem}),["prevent"])),class:"relative"},[n("label",{onClick:c[0]||(c[0]=u=>e(a).searchUser({search:e(d).searchElem})),for:"search-chat",class:"absolute top-2.5 right-3"},Be),A(n("input",{id:"search-chat","onUpdate:modelValue":c[1]||(c[1]=u=>e(d).searchElem=u),class:x(["w-full hover:bg-gray-50 focus:border-golden px-4 py-2.5 border rounded-full max-md:w-9/12 max-md:mx-auto block text-sm bg-white focus:bg-gray-50 text-black dark:focus:opacity-100 transition-all dark:bg-gray-600 dark:text-white outline-none",{"max-md:hidden":!e(d).activeChatNav&&e(r).path!=="/base/chat"}]),type:"text",placeholder:"Поиск..."},null,2),[[O,e(d).searchElem]])],32),e(d).windowWidth<768||e(d).windowWidth>768?(i(),p("div",Te,[h(Ge),h(be)])):_("",!0)]))}}),He={class:"flex gap-x-2"},Ie={class:"text-sm break-words"},De={key:0,class:"text-black dark:text-white font-bold"},Ze={key:1,class:"text-black font-bold dark:text-white"},Ee={key:2,class:"text-black dark:text-white font-bold"},Re={class:"text-[12px] flex gap-x-1"},Ve={key:0},We={key:0,"fill-rule":"evenodd","clip-rule":"evenodd",d:"M15.4933 6.93502C15.8053 7.20743 15.8374 7.68122 15.565 7.99325L7.70786 16.9933C7.56543 17.1564 7.35943 17.25 7.14287 17.25C6.9263 17.25 6.72031 17.1564 6.57788 16.9933L3.43502 13.3933C3.16261 13.0812 3.19473 12.6074 3.50677 12.335C3.8188 12.0626 4.29259 12.0947 4.565 12.4068L7.14287 15.3596L14.435 7.00677C14.7074 6.69473 15.1812 6.66261 15.4933 6.93502Z"},ze={key:1,"fill-rule":"evenodd","clip-rule":"evenodd",d:"M20.5175 7.01946C20.8174 7.30513 20.829 7.77986 20.5433 8.07981L11.9716 17.0798C11.8201 17.2389 11.6065 17.3235 11.3872 17.3114C11.1679 17.2993 10.9649 17.1917 10.8318 17.0169L10.4035 16.4544C10.1526 16.1249 10.2163 15.6543 10.5458 15.4034C10.8289 15.1878 11.2161 15.2044 11.4787 15.4223L19.4571 7.04531C19.7428 6.74537 20.2175 6.73379 20.5175 7.01946Z"},Pe=$({__name:"ChatNavContentUser",props:{dragClass:{type:Boolean,default:!1}},setup(C){G();const a=N(),d=S(),r=M();function s(c){let u=new WebSocket(`wss://buildwithus.ai-softdev.com/ws/chat/${c}?token=${pe.localStorage.getData("token")}`);u.onmessage=v=>{let o=JSON.parse(v.data.message);console.log(o)}}return(c,u)=>{var o;const v=ce;return i(!0),p(H,null,I((o=e(a).get_chat_list.results)==null?void 0:o.filter(t=>e(a).displayChat==="all"||t.is_group===!0&&e(a).displayChat==="groups"||t.is_group===!1&&e(a).displayChat==="users"),t=>(i(),b(v,{to:`/base/chat/${t.id}`,onClick:l=>{e(a).activeChatNav=!1,s(t.id),e(a).showPinnedWindow=!1,e(a).messageUpdate={},e(a).messageForwarded={},e(a).messageReplied={},e(a).showChatInfo=!1,e(a).showGroupCreateChoice=!1},class:x(["flex justify-between px-4 gap-x-2 dark:hover:bg-gray-500 hover:bg-azure hover:!bg-opacity-10 cursor-pointer transition-all duration-200 py-2",{"dark:hover:!bg-semiCyan ":e(r).path===`/base/chat/${t.id}`,"hover:!bg-cyan":e(r).path===`/base/chat/${t.id}`,"!bg-blue-400":C.dragClass&&t.id===t.id}]),onDragenter:l=>t.id?C.dragClass=!0:C.dragClass=!1,onDragleave:u[0]||(u[0]=l=>C.dragClass=!1)},{default:f(()=>{var l,w,k,U,B,E,R;return[n("div",He,[h(ne,{chat:t},null,8,["chat"]),n("div",Ie,[((l=t.user)==null?void 0:l.id)!==e(d).user.id&&((w=t.user)!=null&&w.id)?(i(),p("p",De,m(e(d).user.id!==((k=t.user)==null?void 0:k.id)?t.user.first_name+" "+t.user.last_name:e(d).user.first_name+" "+e(d).user.last_name),1)):!((U=t.user)!=null&&U.id)&&!t.is_group?(i(),p("p",Ze,m(c.$t("Избранное")),1)):t.is_group?(i(),p("p",Ee,m(t.name),1)):_("",!0),t.last_message.text&&!t.last_message.file_name?(i(),p("p",{key:3,class:x(["text-gray-400",{"text-gray-500 dark:text-white":e(r).path===`/base/chat/${t.id}`}])},m(((B=t.last_message.text)==null?void 0:B.length)>15?t.last_message.text.slice(0,15)+"...":t.last_message.text),3)):t.last_message.text&&t.last_message.file_name?(i(),p("p",{key:4,class:x(["text-gray-400",{"text-gray-500 dark:text-white":e(r).path===`/base/chat/${t.id}`}])},[n("span",null,m(t.last_message.file_name.length>20?t.last_message.file_name.slice(0,15)+"...":t.last_message.file_name),1),g(m(", "+t.last_message.text),1)],2)):!t.last_message.text&&t.last_message.file_name?(i(),p("p",{key:5,class:x(["text-gray-400",{"text-gray-500 dark:text-white":e(r).path===`/base/chat/${t.id}`}])},m(t.last_message.file_name.length>20?t.last_message.file_name.slice(0,20)+"...":t.last_message.file_name),3)):_("",!0)])]),n("div",Re,[(E=t.user)!=null&&E.id?(i(),p("div",Ve,[t.last_message.sender.id===e(d).user.id?(i(),p("svg",{key:0,class:x(["fill-semiCyan",{"fill-white":e(r).path===`/base/chat/${t.id}`}]),width:"20px",height:"20px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[((R=t.last_message.text)==null?void 0:R.length)>0?(i(),p("path",We)):_("",!0),t.last_message.read!==!1?(i(),p("path",ze)):_("",!0)],2)):_("",!0)])):_("",!0),n("p",{class:x(["text-gray-400",{"text-white":e(r).path===`/base/chat/${t.id}`}])},m(t.last_message.created_at?new Date(t.last_message.created_at).toLocaleTimeString().slice(0,5):""),3)])]}),_:2},1032,["to","onClick","onDragenter","class"]))),256)}}}),Fe={class:"h-[80%] max-md:h-[80%] overflow-y-auto mt-4 max-md:w-full"},Ae={key:0,class:"flex flex-col mb-20"},Oe={class:"flex justify-center relative flex-col items-center mb-2"},Je={class:"absolute left-6 max-md:left-10 flex items-center"},qe={class:"ml-4 flex flex-col dark:opacity-20 gap-y-2"},Ke={key:1,class:""},Qe=["onClick"],Xe=["src"],Ye={class:"text-sm break-words font-bold"},et=$({__name:"ChatNavContent",setup(C){const a=G(),d=N();S();const r=M();return(s,c)=>(i(),p("div",Fe,[e(d).searchElem===""?(i(),p("div",Ae,[e(a).get_user_list.results?(i(),b(Pe,{key:0})):(i(),p(H,{key:1},I(4,u=>n("div",Oe,[h(T,{class:"dark:opacity-20 opacity-60",width:"90%",height:"70px","border-radius":"10px"}),n("div",Je,[h(T,{class:"dark:opacity-20",width:"50px",height:"50px","border-radius":"100%"}),n("div",qe,[h(T,{class:"",width:"150px",height:"10px","border-radius":"4px"}),h(T,{class:"",width:"150px",height:"10px","border-radius":"4px"})])])])),64))])):_("",!0),e(d).searchElem!==""?(i(),p("div",Ke,[(i(!0),p(H,null,I(e(a).get_user_search.results,u=>(i(),p("div",{onClick:v=>{var o;u.id!==((o=e(d).get_user_chat.user)==null?void 0:o.id)&&e(d).createChatUser({user_id:u.id},s.$router),e(d).showPinnedWindow=!1,e(d).searchElem="",e(d).activeChatNav=!1},class:x(["flex items-center px-4 gap-x-2 dark:hover:bg-gray-500 hover:bg-azure !bg-opacity-10 cursor-pointer transition-all duration-200 p-1",{"dark:hover:!bg-semiCyan":e(r).path===`/base/chat/${u.id}`,"hover:!bg-cyan":e(r).path===`/base/chat/${u.id}`}])},[n("img",{class:"w-[50px] h-[50px] rounded-full",src:u.photo,alt:"use-photo"},null,8,Xe),n("p",Ye,m(u.first_name+" "+u.last_name),1)],10,Qe))),256))])):_("",!0)]))}}),tt={class:"h-full"},st=$({__name:"ChatNav",props:{activeNav:{type:Boolean,default:!0}},setup(C){P(),M(),G();const a=N();return S(),Z(()=>{a.windowWidth=window.innerWidth}),(d,r)=>(i(),p("div",tt,[h(je),h(et,{class:"",onDragenter:r[0]||(r[0]=s=>e(a).showDragInfo=!1)})]))}}),at=he(st,[["__scopeId","data-v-da89c0b2"]]),ot={key:0,class:"fixed top-0 left-0 right-0 bottom-0 backdrop-blur z-[12000]"},lt={class:"p-20 w-full h-full max-md:w-screen max-md:h-screen max-md:p-0"},rt={class:"absolute bottom-2 left-0 right-0 flex justify-center"},nt={class:"bg-gray-800 bg-opacity-40 p-4 flex gap-x-10 text-sm rounded-lg"},it=n("svg",{class:"fill-gray-300 hover:fill-white transition-all",width:"30px",height:"30px",viewBox:"0 0 56 56",xmlns:"http://www.w3.org/2000/svg"},[n("path",{d:"M 7.7265 25.1056 C 8.2656 24.8477 8.5000 24.4493 8.4765 23.7930 C 8.4062 22.9493 7.4452 21.7774 7.4452 18.6603 C 7.4452 13.6446 10.6796 10.1290 15.7421 10.1290 L 15.8124 10.1290 L 15.8124 13.3399 C 15.8124 15.1915 17.2656 15.6134 18.6718 14.5587 L 25.0702 9.8946 C 26.1484 9.1212 26.1484 8.2071 25.0702 7.4103 L 18.6718 2.7227 C 17.2421 1.6444 15.8124 2.0665 15.8124 3.9649 L 15.8124 7.4103 L 15.7187 7.4103 C 8.9921 7.4103 4.5156 11.9337 4.5156 18.6368 C 4.5156 21.1446 5.0312 23.2071 5.7578 24.4493 C 6.1562 25.1290 7.0000 25.4571 7.7265 25.1056 Z M 45.4609 54.3556 C 49.4689 54.3556 51.4844 52.4337 51.4844 48.3321 L 51.4844 25.1524 C 51.4844 21.0508 49.4689 19.1290 45.4609 19.1290 L 22.2343 19.1290 C 18.2265 19.1290 16.2109 21.0508 16.2109 25.1524 L 16.2109 48.3321 C 16.2109 52.4337 18.2265 54.3556 22.2343 54.3556 Z M 45.3905 50.5821 L 22.3046 50.5821 C 20.6874 50.5821 19.9843 49.9259 19.9843 48.2618 L 19.9843 25.2227 C 19.9843 23.5587 20.6874 22.9024 22.3046 22.9024 L 45.3905 22.9024 C 47.0080 22.9024 47.7107 23.5587 47.7107 25.2227 L 47.7107 48.2618 C 47.7107 49.9259 47.0080 50.5821 45.3905 50.5821 Z"})],-1),dt=$({__name:"ChatCropper",setup(C){const a=N();let d=new FormData;const r=L(0);function s({coordinates:o,image:t}){a.results={coordinates:o,image:t}}function c(){if(!a.src)return;const o=new Image;o.src=a.src,o.onload=()=>{const t=document.createElement("canvas"),l=t.getContext("2d");r.value=(r.value+90)%360,r.value===90||r.value===270?(t.width=o.height,t.height=o.width):(t.width=o.width,t.height=o.height),l==null||l.save(),l==null||l.translate(t.width/2,t.height/2),l==null||l.rotate(r.value*Math.PI/180),l==null||l.drawImage(o,-o.width/2,-o.height/2),l==null||l.restore(),a.src=t.toDataURL()}}const u=L(null);async function v(){var k;const o=(k=u.value)==null?void 0:k.getResult(),t=o==null?void 0:o.canvas;if(!t)return;const l=await new Promise(U=>t.toBlob(B=>U(B),"image/png")),w=new File([l],"avatar.png",{type:"image/png"});a.fileUpload=w,d.append("file",w),a.showChatCropper=!1,console.log("fileUpload →",a.fileUpload)}return(o,t)=>(i(),b(se,{to:"body"},[e(a).src&&e(a).showChatCropper===!0?(i(),p("div",ot,[n("div",lt,[h(e(de),{ref_key:"cropperRef",ref:u,class:"w-screen h-screen",src:e(a).src,backgroundClass:"!bg-transparent",foregroundClass:"bg-black rounded-lg",onChange:s,"stencil-component":e(ie),"stencil-props":{previewClass:"border-dashed border w-full h-full"}},null,8,["src","stencil-component"])]),n("div",rt,[n("div",nt,[h(y,{onClick:t[0]||(t[0]=l=>{e(a).showChatCropper=!1,e(a).file="",e(a).src="",e(a).results={image:null,coordinates:null,file:null}})},{default:f(()=>[g(m(o.$t("Отмена")),1)]),_:1}),h(y,{onClick:c},{default:f(()=>[it]),_:1}),h(y,{class:"!text-semiCyan",onClick:v},{default:f(()=>[g(m(o.$t("Установить фотографию")),1)]),_:1})])])])):_("",!0)]))}}),ut={class:"!mx-0 !p-10 max-[768px]:!p-0"},pt={class:"bg-white border flex w-full border-t border-t-gray-100 dark:text-white rounded-3xl shadow-chat overflow-hidden"},ct={class:"w-11/12 relative overflow-hidden max-lg:w-9/12 max-md:w-full h-screen"},ht={key:0,class:"flex items-center justify-center my-auto w-full h-full text-center rounded-full px-2"},mt={class:"bg-black bg-opacity-5 px-10 py-2 rounded-full"},Tt=$({__name:"chat",setup(C){const a=L(0),d=L(!0),r=M(),s=J(),c=N(),u=G(),v=S(),o=me();return c.loadChatList({page:1,limit:100}),u.loadUserList({query:"",user_type:"user-list",page:1,limit:1e4}),Z(()=>{var t;a.value=window.innerWidth,r.path==="/base/chat"?d.value=!0:r.path===`/base/chat/${(t=c.userChat)==null?void 0:t.id}`&&(d.value=!1)}),ae(()=>{c.showGroupCreateChoice=!1,c.showGroupCreate=!1,c.file="",c.src="",c.fileUpload=null,c.results={coordinates:null,image:null}}),W(()=>v.user,t=>{var l,w;((w=(l=v==null?void 0:v.user)==null?void 0:l.role)==null?void 0:w.name_en)==="admin"&&(window.history.length>1?s.push("/base/profile"):s.push("/"))}),W(()=>o.company,t=>{var w;((w=o.company.modules)==null?void 0:w.find(k=>k.name_en==="chat"))||(window.history.length>1?s.push("/base/profile"):s.push("/"))}),Q({title:"Чат",description:"Интерактивный чат для пользователей"}),(t,l)=>{const w=q,k=K;return i(),p("div",ut,[n("div",pt,[n("div",{class:x(["max-md:absolute h-screen overflow-hidden relative z-[12] rounded-l-3xl dark:bg-gray-700 border-r bg-white transition-all duration-300 w-[320px]",{"max-md:w-0":!e(c).activeChatNav||e(r).path===`/base/chat/${e(r).params.id}`,"max-md:w-full ":e(r).path==="/base/chat","w-[320px]":!e(u).get_user_list.results||!e(c).activeChatNav}])},[h(at)],2),n("div",ct,[h(k,null,{default:f(()=>[h(w),h(dt)]),_:1}),e(r).path==="/base/chat"?(i(),p("div",ht,[n("p",mt,m(t.$t("Выберите контакт для сообщения")),1)])):_("",!0)])])])}}});export{Tt as default};
