import{g as j,m as D,J as K,l,s as v,A as J,o as m,c as f,a as c,t as w,h as d,i as E,x as L}from"./entry.Dos5mvIN.js";import{u as T}from"./documents.DIdm1boA.js";import{u as U}from"./auth.aqacddpH.js";import"./nuxt-storage.Df5leMsQ.js";const F={class:"flex items-center gap-4 flex-col border p-3 mt-4 rounded-lg"},P={class:"text-xl font-medium"},q=c("select",{id:"select-key",name:"key",class:"p-3 border-white rounded-lg bg-bgWhite text-black"},null,-1),W={key:0,class:"text-red-500 mt-2"},$={key:1,class:"text-green-500 mt-2"},H=c("button",{type:"submit",class:"border py-3 px-4 rounded-lg text-xl bg-[#8881]"}," –ü–æ–¥–ø–∏—Å–∞—Ç—å ",-1),G=[H],oe=j({__name:"[slug]",setup(Q){const p=D(),b=K(),g=l(!1),x=l(""),i=l(!0),y=l("");function u(e){return new Promise((o,n)=>{if(document.querySelector(`script[src="${e}"]`)){o();return}const t=document.createElement("script");t.src=e,t.async=!0,t.onload=()=>o(),t.onerror=()=>n(new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ ${e}`)),document.head.appendChild(t)})}async function M(){try{await u("/e-imzo/e-imzo.js"),await u("/e-imzo/e-imzo-client.js"),await u("/e-imzo/micro-ajax.js"),await u("/e-imzo/e-imzo-init.js"),console.log("‚úÖ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã"),O()}catch(e){console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ E-IMZO",e)}}v(async()=>{await M()});async function O(){try{window.EIMZOClient?(console.log("‚úÖ EIMZOClient –∑–∞–≥—Ä—É–∂–µ–Ω:",window.EIMZOClient),console.log("üìú –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã EIMZOClient:",Object.keys(window.EIMZOClient)),C()):console.error("‚ùå EIMZOClient –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏")}catch(e){console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∫—Ä–∏–ø—Ç–æ–≤:",e)}}async function C(){if(!window.EIMZOClient){console.error("EIMZOClient –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω");return}g.value=!0;try{EIMZOClient.checkVersion(function(e,o){var n=EIMZO_MAJOR*100+EIMZO_MINOR,t=parseInt(e)*100+parseInt(o);t<n?console.log("installedVersion < newVersion"):EIMZOClient.installApiKeys(function(){k()},function(s,a){console.log(a?"da":"net")})},function(e,o){console.log(o?"da2":"net2")}),console.log("üìÑ –î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–Ω –∏ –æ–±–Ω–æ–≤–ª—ë–Ω")}catch(e){console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞:",e)}finally{g.value=!1}}function k(){EIMZOClient.listAllUserKeys(function(e,o){var n="itm-"+e.serialNumber+"-"+o;return n},function(e,o){return S(e,o)},function(e,o){var n=document.querySelector('select[name="key"]');n.innerHTML="",e.forEach(function(t){n.appendChild(t)}),n.options.length>0&&(console.log("options yes",n.options[0],n.options[0].value),n.value=n.options[0].value)},function(e,o){e?uiShowMessage(errorCAPIWS+" : "+e):console.log(o)})}var S=function(e,o){var n=new Date;o.expired=dates.compare(n,o.validTo)>0;var t=document.createElement("option");return t.value=e,t.text=o.CN,o.expired&&(t.style.color="gray",t.text=t.text+" (—Å—Ä–æ–∫ –∏—Å—Ç–µ–∫)"),t.setAttribute("vo",JSON.stringify(o)),t.setAttribute("id",e),t};l("");let h=l(null);const I=l(null),Z=e=>{A()},A=function(){console.log("–ù–∞—á–∞–ª–æ –ø–æ–¥–ø–∏—Å–∏");let e=I.value,o=h.value;EIMZOClient.createPkcs7(o,e,null,function(n){z(n,function(t){console.log("–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å –≤—Ä–µ–º–µ–Ω–µ–º",t),N(t,!1)})},(n,t)=>{console.log("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–∏–∏")},!1,!0)},z=function(e,o){microAjax("https://workix.uz/eimzo"+"/frontend/timestamp/pkcs7",function(t,s){if(s.status!=200){console.log("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ timestamp –∫ –ø–æ–¥–ø–∏—Å–∏");return}var a;try{var t=JSON.parse(t);if(t.status!=1){console.log(t.status," - ",s.message);return}a=t.pkcs7b64}catch(V){console.log("–û—à–∏–±–∫–∞",s.status," - ",s.statusText,V)}o(a)},e)},N=function(e,o,n,t,s){var a;console.log(o),console.log(a),r.documentSign({slug:p.params.slug,data:{signature:e}},b)};function B(){let e=document.getElementById("select-key");x.value=e,i.value=!1;let o=document.getElementById(e.value),n=JSON.parse(o.getAttribute("vo"));y.value=n,console.log("üîë –í—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–Ω–Ω—ã–µ:",n),EIMZOClient.loadKey(n,function(t){h.value=t},(t,s)=>{console.log("error"),i.value=!0})}const r=T(),_=U();v(()=>{r.loadDocument({slug:p.params.slug})});async function R(){try{const e=_.get_server_domain+r.documentItem.file,o=await fetch(e);if(!o.ok)throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞");const n=await o.blob(),t=new FileReader;t.onloadend=()=>{const s=t.result.split(",")[1];I.value=s},t.readAsDataURL(n)}catch(e){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:",e)}}return J(()=>r.documentItem,e=>{console.log(_.get_server_domain+r.documentItem.file),R()}),(e,o)=>(m(),f("div",F,[c("p",P,' –î–æ–∫—É–º–µ–Ω—Ç: "'+w(d(r).documentItem.title)+'" ',1),c("div",{class:"flex items-center gap-4 flex-col"},[q,c("button",{onClick:B,class:"border p-2 rounded-lg"}," –í—ã–±—Ä–∞—Ç—å –∫–ª—é—á ")]),d(i)?(m(),f("p",W,"–í—ã –Ω–µ –≤—ã–±—Ä–∞–ª–∏ –∫–ª—é—á")):E("",!0),d(i)?E("",!0):(m(),f("p",$,"–í—ã –≤—ã–±—Ä–∞–ª–∏ –∫–ª—é—á: "+w(d(y).CN),1)),c("form",{id:"myForm",onSubmit:L(Z,["prevent"]),class:"mt-4"},G,32)]))}});export{oe as default};
