import{a as o,n as i,l as r}from"./nuxt-storage.gLjAmBiV.js";import{d as n}from"./entry.Doav1j1v.js";const l=n("user-list",{state:()=>({user:{id:"",first_name:"",last_name:"",patronymic:"",password:"",email:"",photo_file:"",photo:"",position_id:"",position_name:"",position:[{id:"",name:""}],role_id:"",role_name:"",role_en:"",role:{id:"",name:""},phone:"",department:"",company:"",company_id:"",salary:"",date_of_birth:"",permissions:[]},roleList:[],userSearch:{},permissions:[],page:1}),getters:{get_user_list:e=>e.user,get_user_search:e=>e.userSearch,get_position_list:e=>e.user.position,get_role_list:e=>e.roleList,get_permission_list:e=>e.permissions},actions:{async loadAdminList(e){await o.get(`/admin/user/company-admin/list?query=${e.query}&page=${e.page}&limit=${e.limit}`,{headers:{Authorization:`Bearer ${i.localStorage.getData("token")}`}}).then(t=>{this.user=t.data})},async loadUserList(e){await o.get(`user/list?query=${e.query}&page=${e.page}&limit=${e.limit}`,{headers:{Authorization:`Bearer ${i.localStorage.getData("token")}`}}).then(t=>{this.user=t.data})},async loadUser(e){o.get(`user/${e.id}`,{headers:{Authorization:`Bearer ${i.localStorage.getData("token")}`}}).then(t=>{this.user=t.data}).catch(t=>{})},async searchUser(e){o.get(`user/list/my-company?search=${e.search}`,{headers:{Authorization:`Bearer ${i.localStorage.getData("token")}`}}).then(t=>{this.userSearch=t.data})},async createUser(e){let t=new FormData;t.set("first_name",e.first_name),t.set("last_name",e.last_name),t.set("email",e.email),t.set("password",e.password),t.set("date_of_birth",e.date_of_birth),t.set("photo",e.photo),t.set("phone",e.phone),t.set("position",e.position),t.set("role_id",e.role_id),t.set("patronymic",e.patronymic),t.set("company_id",e.company_id),t.set("department_id",e.department_id),typeof e.photo!="string"&&t.set("photo",e.photo),o.post("user/create",t,{headers:{Authorization:`Bearer ${i.localStorage.getData("token")}`}}).then(s=>{this.user=s.data,this.loadUserList({limit:5,page:1,query:""})}).catch(s=>{})},async createAdmin(e){let t=new FormData;t.set("first_name",e.first_name),t.set("last_name",e.last_name),t.set("email",e.email),t.set("password",e.password),t.set("date_of_birth",e.date_of_birth.toISOString()),t.set("photo",e.photo),t.set("phone",e.phone),t.set("position",e.position),t.set("role_id",e.role_id),t.set("company_id",e.company_id),t.set("department_id",e.department_id),typeof e.photo!="string"&&t.set("photo",e.photo),o.post("/admin/user/company-admin/create",t,{headers:{Authorization:`Bearer ${i.localStorage.getData("token")}`}}).then(s=>{this.user=s.data,this.loadUserList({limit:5,page:1,query:""})}).catch(s=>{})},async update_user(e){let t=new FormData;const s=this.user;e.user.first_name!==s.first_name&&t.set("first_name",e.user.first_name),e.user.last_name!==s.last_name&&t.set("last_name",e.user.last_name),e.user.phone!==s.phone&&t.set("phone",e.user.phone),e.user.password!==s.password&&t.set("password",e.user.password),e.user.salary!==s.salary&&t.set("salary",e.user.salary),e.user.email!==s.email&&t.set("email",e.user.email),e.user.date_of_birth!==s.date_of_birth&&t.set("date_of_birth",e.user.date_of_birth),e.user.passport!==s.passport&&t.set("password",e.user.password),e.user.department_id!==s.department_id&&t.set("department_id",e.user.department_id),e.user.position.id!==s.position.id&&t.set("position",e.user.position.id),e.update_type!=="current-user"&&e.user.permissions_ids!==s.permissions_id&&t.set("permissions_ids",e.permissions_ids),e.update_type!=="current-user"&&e.user.role_id!==s.role_id&&t.set("role_id",e.user.role_id),typeof e.user.photo=="string"&&e.user.photo!==s.photo&&t.set("photo",e.user.photo),await o.patch(`user/update/${e.id}`,t,{headers:{Authorization:`Bearer ${i.localStorage.getData("token")}`}}).then(a=>{this.user=a.data,r.success("Данные успешно обновлены",{autoClose:1500,theme:"auto"})}).catch(a=>{r.error(a,{autoClose:1500,theme:"auto"})})},async change_permissions(e){await o.post(`user/permission/change-user-permissions/${e.id}`,{permissions:e.permissions},{headers:{Authorization:`Bearer ${i.localStorage.getData("token")}`}}).then(t=>{this.user.permissions=t.data}).catch(t=>{r.error(t,{autoClose:1500,theme:"auto"})})},async deleteUser(e,t){o.delete(`user/delete/${e.user_id}`,{headers:{Authorization:`Bearer ${i.localStorage.getData("token")}`}}).then(s=>{this.user=s.data,t.push("/base/users"),r.success("Пользователь успешно удалён",{autoClose:1500,theme:"auto"})}).catch(s=>{r.error(s,{autoClose:1500,theme:"auto"})})},async loadPositionList(){o.get("user/position/list",{headers:{Authorization:`Bearer ${i.localStorage.getData("token")}`}}).then(e=>{this.user.position=e.data})},async loadRoleList(){o.get("user/role/role-list",{headers:{Authorization:`Bearer ${i.localStorage.getData("token")}`}}).then(e=>{this.roleList=e.data})},async loadPermissions(){o.get("user/permission/list",{headers:{Authorization:`Bearer ${i.localStorage.getData("token")}`}}).then(e=>{this.permissions=e.data})}}});export{l as u};
