import{_ as te}from"./TheButton.vue.BBk1r_zp.js";import{_ as le}from"./nuxt-link.DvGkiIsH.js";import{j as ae,a as i,H as se,b as q,N as c,O as f,L as o,V as p,$ as n,_ as u,Z as e,aa as A,ab as ne,u as s,x as N,a4 as x,J as E,a3 as J,a2 as P,an as oe,P as re,a6 as ue}from"./swiper-vue.CpIVhgAG.js";import{b as ie,c as me}from"./entry.BFeEAp4E.js";import{_ as de}from"./TheTextContent.vue.CGoTFFNB.js";import{_ as O}from"./TheBreadcrumbs.vue.hre5j55B.js";import{P as ce}from"./vuejs-paginate-next.es.BKWd1xsG.js";import{u as pe}from"./sales.DiAbZgAF.js";import{T as ge}from"./ThePreloader.DnRhgTaI.js";import{u as _e}from"./companies.LFvO6HcC.js";import{u as ve}from"./auth.D_LoM6S9.js";import{_ as T}from"./TheInput.vue.BI-9lKbR.js";import{_ as be}from"./TheModal.vue.D0U2_Fhe.js";import"./nuxt-storage.hATfV0XZ.js";import"./_plugin-vue_export-helper.DlAUqK2U.js";const w=""+globalThis.__publicAssetsURL("icons/table-arrow.svg"),fe={class:"flex items-center gap-x-4 max-md:mt-10 max-md:flex-col max-md:items-start max-md:gap-y-4"},xe={class:"flex items-center gap-x-4"},we=e("div",null,[e("svg",{width:"15px",height:"15px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{class:"dark:stroke-white stroke-black",d:"M14 12C14 14.7614 11.7614 17 9 17H7C4.23858 17 2 14.7614 2 12C2 9.23858 4.23858 7 7 7H7.5M10 12C10 9.23858 12.2386 7 15 7H17C19.7614 7 22 9.23858 22 12C22 14.7614 19.7614 17 17 17H16.5","stroke-width":"2","stroke-linecap":"round"})])],-1),he={class:"ml-auto flex items-center gap-3"},ke={class:"w-fit sales-up-table rounded-lg border mt-10 overflow-hidden"},ye={class:"p-4 flex items-center gap-3"},Ce={class:"w-4/12 max-md:w-full relative flex items-center"},Ve=e("div",{class:"absolute rotate-90 ml-2"},[e("svg",{class:"dark:stroke-white stroke-black",width:"25px",height:"25px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M14.9536 14.9458L21 21M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z","stroke-width":"1.2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),$e={class:"w-full sales-table"},Ne={key:0},Me={class:"bg-gray-200 dark:bg-bgWhite"},Se=e("th",null," № ",-1),qe={key:1,class:"min-h-[300px] min-w-[89vw] bg-gray-200 dark:bg-bgWhite text-center flex items-center justify-center"},Be={key:2,class:"relative min-h-[400px] min-w-[89vw]"},Le=e("div",{class:"bg-black w-full h-full absolute top-0 left-0 opacity-40 rounded-lg"},null,-1),Ue={class:"w-full flex items-center justify-end border-t gap-4 pr-10 pb-5 pt-5 max-md:pr-3 max-md:flex-col max-md:items-end"},Pe={class:"flex items-center gap-3"},Te=e("p",null,"Строк на странице:",-1),je=["value"],Fe={class:"flex flex-col gap-5"},He=e("p",null," Фильтры: ",-1),tt=ae({__name:"index",setup(Ie){const B=ve(),F=_e(),g=ie(),M=me(),m=pe(),L=i(!1),_=i(Number(g.query.page)||1),d=i(Number(g.query.limit)||5),h=i(g.query.itemName||""),y=i(Number(g.query.min_price)||""),C=i(Number(g.query.max_price)||""),V=i(Number(g.query.min_count)||""),$=i(Number(g.query.max_count)||""),G=i([5,10,20,30,50]),k=i([]),U=i(""),S=()=>{M.push({query:{page:_.value,limit:d.value,itemName:h.value||void 0,min_price:y.value||"",max_price:C.value||"",min_count:V.value||"",max_count:$.value||"",order_by:U.value||""}})},K=a=>{_.value=a,S()},X=()=>{S()},Y=()=>{_.value=1,S()},H=()=>{L.value=!L.value},I=i(0),v=a=>{const t=k.value.findIndex(r=>r===a||r===`-${a}`);t!==-1?k.value[t]=k.value[t].startsWith("-")?a:`-${a}`:k.value.push(a),S()},b=a=>k.value.includes(a)?"rotate-0":(k.value.includes(`-${a}`),"rotate-180"),Q=()=>{m.loadSalesListFile()};return se(()=>{m.loadSalesList({page:_.value,limit:d.value,name:h.value,min_price:y.value,max_price:C.value,min_count:V.value,max_count:$.value,order_by:U.value})}),q(k.value,a=>{U.value=a.join(",")}),q(()=>m.sales,a=>{I.value=Math.ceil(m.sales.count/d.value)}),q(()=>g.query,a=>{_.value=Number(a.page)||1,d.value=Number(a.limit)||5,h.value=a.itemName||"",m.loadSalesList({page:_.value,limit:d.value,name:h.value,min_price:y.value,max_price:C.value,min_count:V.value,max_count:$.value,order_by:U.value})}),q(()=>B.user,a=>{var t,r;((r=(t=B==null?void 0:B.user)==null?void 0:t.role)==null?void 0:r.name_en)==="admin"&&(window.history.length>1?M.push("/base/profile"):M.push("/"))}),q(()=>F.company,a=>{var r;((r=F.company.modules)==null?void 0:r.find(j=>j.name_en==="sales"))||(window.history.length>1?M.push("/base/profile"):M.push("/"))}),(a,t)=>{var R,W,D,z,Z;const r=te,j=le;return c(),f("div",null,[o(de,null,{default:p(()=>[n(u(a.$t("Страница продаж")),1)]),_:1}),e("div",null,[e("div",fe,[e("div",xe,[o(O,{"breadcrumb-link":"/base/profile"},{default:p(()=>[n(u(a.$t("Профиль")),1)]),_:1}),we,o(O,null,{default:p(()=>[n(u(a.$t("Продажи")),1)]),_:1})]),e("div",he,[o(j,{to:"/base/sales/item-create",class:"ml-auto"},{default:p(()=>[o(r,{class:"border p-3 rounded-lg !text-black dark:!text-white"},{default:p(()=>[n(" Добавить товар ")]),_:1})]),_:1}),o(r,{onClick:Q,class:"border p-3 rounded-lg !text-black dark:!text-white"},{default:p(()=>[n(" Экспортировать в файл ")]),_:1})])]),e("div",ke,[e("div",ye,[o(r,{onClick:H,class:"border p-3 rounded-lg !text-black dark:!text-white"},{default:p(()=>[n(" Фильтры ")]),_:1}),e("div",Ce,[Ve,A(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>N(h)?h.value=l:null),onInput:Y,type:"text",class:"w-full rounded-lg dark:bg-gray-500 outline-none pl-10 h-[50px]",placeholder:"Найти товар..."},null,544),[[ne,s(h)]])])]),e("div",$e,[(W=(R=s(m).sales)==null?void 0:R.results)!=null&&W.length?(c(),f("table",Ne,[e("thead",Me,[e("tr",null,[Se,e("th",null,[e("button",{onClick:t[1]||(t[1]=l=>v("name")),class:"flex items-center gap-3"},[n(" Наименование "),e("img",{class:x(b("name")),src:w,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[2]||(t[2]=l=>v("sales_count")),class:"flex items-center gap-3"},[n(" Кол-во продаж "),e("img",{class:x(b("sales_count")),src:w,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[3]||(t[3]=l=>v("price_per_count")),class:"flex items-center gap-3"},[n(" Цена за единицу "),e("img",{class:x(b("price_per_count")),src:w,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[4]||(t[4]=l=>v("total")),class:"flex items-center gap-3"},[n(" Сумма "),e("img",{class:x(b("total")),src:w,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[5]||(t[5]=l=>v("vat")),class:"flex items-center gap-3"},[n(" НДС "),e("img",{class:x(b("vat")),src:w,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[6]||(t[6]=l=>v("total_with_vat")),class:"flex items-center gap-3"},[n(" Сумма с НДС "),e("img",{class:x(b("total_with_vat")),src:w,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[7]||(t[7]=l=>v("company_sale_to")),class:"flex items-center gap-3"},[n(" Наименование компании "),e("img",{class:x(b("company_sale_to")),src:w,alt:"table-arrow"},null,2)])]),e("th",null,[e("button",{onClick:t[8]||(t[8]=l=>v("agent")),class:"flex items-center gap-3"},[n(" Агент "),e("img",{class:x(b("agent")),src:w,alt:"table-arrow"},null,2)])])])]),e("tbody",null,[(c(!0),f(E,null,J(s(m).sales.results,(l,ee)=>(c(),f("tr",null,[e("td",null,u(s(d)*(s(_)-1)+ee+1),1),e("td",null,u(l.name),1),e("td",null,u(l.sales_count),1),e("td",null,u(l.price_per_count),1),e("td",null,u(l.total),1),e("td",null,u(l.vat),1),e("td",null,u(l.total_with_vat),1),e("td",null,u(l.company_sale_to),1),e("td",null,u(l.agent.last_name+" "+l.agent.first_name+" "+l.agent.patronymic),1)]))),256))])])):P("",!0),((z=(D=s(m).sales)==null?void 0:D.results)==null?void 0:z.length)===0?(c(),f("div",qe," Товаров пока нет ")):P("",!0),(Z=s(m).sales)!=null&&Z.results?P("",!0):(c(),f("div",Be,[Le,o(ge)]))]),e("div",Ue,[o(s(ce),{"page-count":s(I),"page-range":3,"margin-pages":2,"click-handler":K,"prev-text":"<","next-text":">","container-class":"pagination","page-class":"page-item","force-page":s(_)},null,8,["page-count","force-page"]),e("div",Pe,[Te,A(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>N(d)?d.value=l:null),onChange:X,class:"w-fit p-2.5 rounded-md bg-[#8881] dark:bg-bgWhite text-black"},[(c(!0),f(E,null,J(s(G),l=>(c(),f("option",{value:l},u(l),9,je))),256))],544),[[oe,s(d)]])])])])]),s(L)?(c(),re(be,{key:0,type:"resize",onShowModal:t[15]||(t[15]=()=>{})},{default:p(()=>[e("button",{class:"absolute top-3 right-3",onClick:H}," x "),e("div",Fe,[He,e("form",{onSubmit:t[14]||(t[14]=ue(l=>{S(),L.value=!1},["prevent"])),class:"flex items-center gap-5 flex-col"},[o(T,{modelValue:s(y),"onUpdate:modelValue":t[10]||(t[10]=l=>N(y)?y.value=l:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Минимальная цена"},null,8,["modelValue"]),o(T,{modelValue:s(C),"onUpdate:modelValue":t[11]||(t[11]=l=>N(C)?C.value=l:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Максимальная цена"},null,8,["modelValue"]),o(T,{modelValue:s(V),"onUpdate:modelValue":t[12]||(t[12]=l=>N(V)?V.value=l:null),class:"bg-transparent bg-opacity-0 rounded-lg outline-none max-md:w-full",type:"number",label:"Минимальное количество"},null,8,["modelValue"]),o(T,{modelValue:s($),"onUpdate:modelValue":t[13]||(t[13]=l=>N($)?$.value=l:null),class:"w-full bg-transparent bg-opacity-0 rounded-lg outline-none",type:"number",label:"Максимальное количество"},null,8,["modelValue"]),o(r,{class:"mt-2 !text-black dark:!text-white"},{default:p(()=>[n(" Сохранить ")]),_:1})],32)])]),_:1})):P("",!0)])}}});export{tt as default};
